<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第10章 时间序列模型 | wcl</title>
<meta name="author" content="第10章 时间序列模型 | wcl">
<meta name="description" content="10.1 理论知识 平稳时间序列分析: 平稳的，非随机序列(非白噪声序列)  10.1.1 差分 一阶差分: \(\triangledown{x_t}=x_{t}-x_{t-1}\) 二阶差分: \(\triangledown^2{x_t}=\triangledown{x_t}-\triangledown{x_{t-1}}\) 一阶差分的差分 三阶差分:...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="第10章 时间序列模型 | wcl">
<meta property="og:type" content="book">
<meta property="og:url" content="https://github.com/wangchenglong99/wangchenglong99.github.io/时间序列模型.html">
<meta property="og:description" content="10.1 理论知识 平稳时间序列分析: 平稳的，非随机序列(非白噪声序列)  10.1.1 差分 一阶差分: \(\triangledown{x_t}=x_{t}-x_{t-1}\) 二阶差分: \(\triangledown^2{x_t}=\triangledown{x_t}-\triangledown{x_{t-1}}\) 一阶差分的差分 三阶差分:...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第10章 时间序列模型 | wcl">
<meta name="twitter:description" content="10.1 理论知识 平稳时间序列分析: 平稳的，非随机序列(非白噪声序列)  10.1.1 差分 一阶差分: \(\triangledown{x_t}=x_{t}-x_{t-1}\) 二阶差分: \(\triangledown^2{x_t}=\triangledown{x_t}-\triangledown{x_{t-1}}\) 一阶差分的差分 三阶差分:...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><style>
    /* pre {
      max-height: 300px;
      overflow-y: auto;
    }

    pre[class] {
      max-height: 100px;
    } */

    .scroll-200 {
      max-height: 200px;
      overflow-y: auto;
      background-color: inherit;
    }
    </style>
<link rel="shortcut icon" type="image/x-icon" href="icon/favicon.ico">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">wcl</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li class="book-part">数据</li>
<li><a class="" href="introduction.html">introduction</a></li>
<li><a class="" href="%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%E4%B8%8E%E6%A0%BC%E5%BC%8F.html"><span class="header-section-number">1</span> 数据编码与格式</a></li>
<li><a class="" href="%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%AD%98%E5%82%A8.html"><span class="header-section-number">2</span> 数据获取与存储</a></li>
<li><a class="" href="%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97.html"><span class="header-section-number">3</span> 数据清洗</a></li>
<li><a class="" href="%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C.html"><span class="header-section-number">4</span> 数据操作</a></li>
<li><a class="" href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97.html"><span class="header-section-number">5</span> 时间序列</a></li>
<li class="book-part">可视化</li>
<li><a class="" href="introduction-1.html">introduction</a></li>
<li><a class="" href="matplotlib.html"><span class="header-section-number">6</span> matplotlib</a></li>
<li><a class="" href="%E5%9B%BE%E8%A1%A8%E5%AE%9E%E4%BE%8B.html"><span class="header-section-number">7</span> 图表实例</a></li>
<li class="book-part">数据库</li>
<li><a class="" href="introduction-2.html">introduction</a></li>
<li><a class="" href="mysql%E9%80%9F%E6%9F%A5%E8%A1%A8.html"><span class="header-section-number">8</span> mysql速查表</a></li>
<li><a class="" href="pymysql.html"><span class="header-section-number">9</span> PyMysql</a></li>
<li class="book-part">机器学习</li>
<li><a class="" href="introduction-3.html">introduction</a></li>
<li><a class="active" href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html"><span class="header-section-number">10</span> 时间序列模型</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/wangchenglong99/wangchenglong99.github.io">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="时间序列模型" class="section level1" number="10">
<h1>
<span class="header-section-number">第10章</span> 时间序列模型<a class="anchor" aria-label="anchor" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h1>
<div id="理论知识" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> 理论知识<a class="anchor" aria-label="anchor" href="#%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86"><i class="fas fa-link"></i></a>
</h2>
<p>平稳时间序列分析: 平稳的，非随机序列(非白噪声序列)</p>
<div id="差分" class="section level3" number="10.1.1">
<h3>
<span class="header-section-number">10.1.1</span> 差分<a class="anchor" aria-label="anchor" href="#%E5%B7%AE%E5%88%86"><i class="fas fa-link"></i></a>
</h3>
<p>一阶差分: <span class="math inline">\(\triangledown{x_t}=x_{t}-x_{t-1}\)</span></p>
<p>二阶差分: <span class="math inline">\(\triangledown^2{x_t}=\triangledown{x_t}-\triangledown{x_{t-1}}\)</span> 一阶差分的差分</p>
<p>三阶差分: <span class="math inline">\(\triangledown^p{x_t}=\triangledown^{p-1}{x_t}-\triangledown^{p-1}{x_{t-1}}\)</span>必须先计算前一阶的差分</p>
<p><strong>k步差分</strong>：<span class="math inline">\(\triangledown_k{x_t}=x_t-x_{t-k}\)</span> 直接相隔k步计算差</p>
</div>
<div id="延迟算子" class="section level3" number="10.1.2">
<h3>
<span class="header-section-number">10.1.2</span> 延迟算子<a class="anchor" aria-label="anchor" href="#%E5%BB%B6%E8%BF%9F%E7%AE%97%E5%AD%90"><i class="fas fa-link"></i></a>
</h3>
<p>当前序列值乘上一个延迟算子，相当于把当前序列值的序列时间向过去拨了一个时刻</p>
<p>记B为延迟算子</p>
<p><span class="math display">\[x_{t-1}=Bx_t\]</span></p>
<p><span class="math display">\[x_{t-2}=Bx_{t-2}\]</span></p>
<ul>
<li>用延迟算子表示差分运算</li>
</ul>
<p><span class="math display">\[\triangledown^p{x_t}=(1-B)^px_t=\sum^p_{i=0}(-1)^pC^i_px_{t-i}\]</span></p>
<p><span class="math display">\[\triangledown_kx_t=x_t-x_{t-k}=(1-B^k)x_t\]</span></p>
</div>
<div id="平稳时间序列" class="section level3 tabset" number="10.1.3">
<h3>
<span class="header-section-number">10.1.3</span> 平稳时间序列<a class="anchor" aria-label="anchor" href="#%E5%B9%B3%E7%A8%B3%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><i class="fas fa-link"></i></a>
</h3>
<p>h(t)=</p>
<p>AR(p):p阶自回归模型</p>
<p><span class="math inline">\(x_t=\phi_0+\phi_1x_{t-1}+\phi_2x_{t-2}+\dots+\phi_px_{t-p}+\epsilon_t\)</span></p>
<p><span class="math inline">\(\phi_p\neq0\)</span></p>
<ul>
<li>
<p>严宽平稳的联系和区别：</p>
<ul>
<li>严平稳：时间序列的任意n个时刻的联合分布保持不变，即序列的所有统计性质都不会因为时间的推移而发生变化</li>
<li>宽平稳：时间序列任意时刻的均值保持不变，二阶矩存在且二阶矩只与时间有关</li>
<li>严平稳和宽平稳的关系：
<ul>
<li>如果二阶矩存在，严平稳一定是宽平稳<br>
</li>
<li>如果是正态分布，则宽平稳代表严平稳</li>
</ul>
</li>
</ul>
</li>
<li><p>平稳性的意义</p></li>
</ul>
<p>如果序列不平稳，那么序列就会有很多个随机变量，并且每个变量都只有一个样本，通常是没有办法进行分析的。
但是如果序列平稳，那么均值为常数，这样意味着含有可列多个随机变量的均值序列变成了一个常数序列，这样样本数也就变成了时间序列的个数，
这样减少了随机变量数，增加了待估参数的样本容量，降低了时序分析的难度，提高了对均值函数的估计精度</p>
<ul>
<li>
<p>平稳时间序列的统计性质</p>
<ul>
<li>常数均值:<span class="math inline">\(E(X_t)=\mu\)</span>
</li>
<li>自协方差函数：<span class="math inline">\(\gamma(t-s)=\gamma(t,s)=E[(X_t-\mu_t)(X_s-\mu_s)]\)</span>
</li>
<li>自相关函数:<span class="math inline">\(\rho(t,s)=\frac{\gamma(t,s)}{\sqrt{D(X_t)}\sqrt{D(X_s)}}\)</span>
</li>
<li>延迟k自协方差函数：<span class="math inline">\(\gamma(k)=\gamma(t,t+k)\)</span>
</li>
<li>方差：<span class="math inline">\(D(X_t)=\gamma(0)\)</span>为常数</li>
<li>延迟k自相关系数：<span class="math inline">\(\rho(k)=\frac{\gamma(t,t+k)}{\sqrt{\gamma(0)}\sqrt{\gamma(0)}}\space=\space\frac{\gamma(k)}{\gamma(0)}\)</span>
</li>
</ul>
</li>
</ul>
<div id="wold分解定理" class="section level4" number="10.1.3.1">
<h4>
<span class="header-section-number">10.1.3.1</span> Wold分解定理<a class="anchor" aria-label="anchor" href="#wold%E5%88%86%E8%A7%A3%E5%AE%9A%E7%90%86"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<p>Wold分解定理</p>
<p>对于任意一个离散平稳时间序列，都可以分解成两个不相关的平稳序列之和，其中一个为确定性的，另一个为随机性的</p>
</li>
</ul>
<p><span class="math inline">\(x_t=V_t+\xi_t\)</span></p>
<p><span class="math inline">\(V_t=\sum_{j=1}^{\infty}\phi_jx_{t-j}\)</span>,等价表达为历史序列值的线性函数</p>
<p><span class="math inline">\(\xi_t=\sum_{j=0}^{\infty}\theta_j\epsilon_{t-j}\)</span>,代表了不能有历史信息表达的部分，其中<span class="math inline">\(\theta_0=1,\sum_{j=0}^{\infty}\theta_j^2 \leq \infty,\epsilon独立，通常假定0均值正态分布\)</span></p>
<p>对任意平稳时间序列而言，做线性回归<span class="math inline">\(y_t=a_0+a_1y_{t-1}+a_2y_{t-2}+\dots+a_py_{t-p}+v_t\)</span></p>
<p>前面的是确定性部分，后面的<span class="math inline">\(v_t\)</span>是非确定性部分，它的方差决定了p期历史信息对未来的预测精度</p>
<p>如果方差极限趋向0，则<span class="math inline">\(y_t\)</span>为确定性序列
如果方差极限趋向<span class="math inline">\(var(y_t)\)</span>,则<span class="math inline">\(y_t\)</span>为纯随机性序列</p>
<p>绝大多数序列结语确定性序列和纯随机性序列中间，即<span class="math inline">\(0和var(y_t)\)</span>之间，序列中既包含部分确定性信息，又包含部分随机信息，这是我们把序列简称为随机序列</p>
</div>
<div id="平稳序列的特征根" class="section level4" number="10.1.3.2">
<h4>
<span class="header-section-number">10.1.3.2</span> 平稳序列的特征根<a class="anchor" aria-label="anchor" href="#%E5%B9%B3%E7%A8%B3%E5%BA%8F%E5%88%97%E7%9A%84%E7%89%B9%E5%BE%81%E6%A0%B9"><i class="fas fa-link"></i></a>
</h4>
<p>p阶线性差分方程：<span class="math inline">\(x_t+a_1x_{t-1}+\dots+a_px_{t-p}=h_t\)</span></p>
<p>一阶：
<span class="math display">\[x_t-0.8x_{t-1}=0\]</span>
<span class="math display">\[\lambda^1-0.8\times \lambda^0=0,得\lambda=0.8\]</span>
<span class="math display">\[1-0.8B=0,得B=1/0.8\]</span>方程的根是特征根的倒数</p>
<p>二阶:
<span class="math display">\[x_t-0.6x_{t-1}+0.05x_{t-2}=0\]</span>
<span class="math display">\[\lambda^2-0.6\lambda+0.05=0,得\lambda_1=0.5,\lambda_2=0.1\]</span>
<span class="math display">\[1-0.6B+0.05B^2=0 得B_1=2,B_2=10\]</span></p>
</div>
<div id="平稳序列特征根的性质" class="section level4" number="10.1.3.3">
<h4>
<span class="header-section-number">10.1.3.3</span> 平稳序列特征根的性质<a class="anchor" aria-label="anchor" href="#%E5%B9%B3%E7%A8%B3%E5%BA%8F%E5%88%97%E7%89%B9%E5%BE%81%E6%A0%B9%E7%9A%84%E6%80%A7%E8%B4%A8"><i class="fas fa-link"></i></a>
</h4>
<p>平稳序列必须满足特征根的绝对值都<strong>小于</strong>1</p>
<p>*平稳性检验</p>
<ul>
<li>图检验</li>
<li>DF检验：当<span class="math inline">\(\tau\)</span>值小于<span class="math inline">\(\tau_\alpha时\)</span>，拒绝原假设，序列平稳，即序列无单位根，即p值较小时。只能检验最高延迟一阶信息
<ul>
<li>无漂移项自回归结构：<span class="math inline">\(x_t=\phi_1x_{t-1}+\xi_t\)</span>
</li>
<li>有漂移项自回归结构：<span class="math inline">\(x_t=\phi_0+\phi_1x_{t-1}+\xi_t\)</span>
</li>
<li>带趋势回归结构：<span class="math inline">\(x_t=\alpha+\beta t+\phi_1x_{t-1}+\xi_t\)</span>
</li>
</ul>
</li>
<li>ADF检验：可以检验更高的延迟阶数
<ul>
<li>只要有一个单位根，则不平稳</li>
</ul>
</li>
<li>纯随机性检验</li>
</ul>
<p>如果序列值彼此之间没有任何相关性，那就意味着该序列是一个没有记忆的序列，过去的行为对将来的发展没有任何影响，这种序列称为纯随机序列，从统计分析的角度，纯随机序列是没有任何分析价值。</p>
<ul>
<li>纯随机序列(白噪声序列)定义：简记为<span class="math inline">\(X_t\sim WN(\mu,\sigma^2)\)</span>
<ol style="list-style-type: decimal">
<li>任取<span class="math inline">\(t\in T,有EX_t=\mu\)</span>
</li>
<li>任取<span class="math inline">\(t，s\in T\)</span>，有
<span class="math display">\[\gamma(t,s)=\begin{cases}\sigma^2 &amp; t=s\\0 &amp; t\neq s\end{cases}\]</span>
</li>
</ol>
</li>
<li>纯随机序列性质
<ol style="list-style-type: decimal">
<li>纯随机性</li>
<li>方差齐性：序列中每个随机变量的方差相等，如果不满足，则是异方差</li>
</ol>
</li>
<li>纯随机性检验
<ul>
<li>如果一个时间序列是纯随机的，得到一个观察期数为n的观察序列，那么该序列的延迟非零期的样本自相关系数将近似服从均值为零，方差为序列观察期数倒数的正态分布，即:
<span class="math display">\[    \hat{\rho_k} \sim N(0,\frac{1}{n}),\forall k \neq0\]</span>
</li>
<li>原假设：延迟期数小于或等于m期的序列值之间相互独立</li>
<li>备则假设：延迟期数小于或等于m期的序列值之间有相关性</li>
<li>Q统计量
<span class="math display">\[Q_{BP}=n\sum_{k=1}^m\hat{\rho_k}^2\]</span>
<span class="math display">\[Q_{LB}=n(n+2)\sum_{k=1}^{m}(\frac{\hat{\rho_k}^2}{n-k})\]</span>
n为观察期数，m为延迟阶数
这两种Q统计量都服从<span class="math inline">\(Q\sim \chi^2(m)\)</span>
</li>
<li>平稳序列的短期相关性，所以一般只需要检验前几期。另一方面，如果一个平稳序列显示出显著的短期相关性，那么该序列就一定不是白噪声序列</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="ar模型" class="section level3" number="10.1.4">
<h3>
<span class="header-section-number">10.1.4</span> AR模型<a class="anchor" aria-label="anchor" href="#ar%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>函数形式
<span class="math display">\[X_t=\phi_1X_{t-1}+\phi_2X_{t-2}+\dots+\phi_pX_{t-p}+\epsilon_t,或\Phi(B)X_t=\epsilon_t\]</span>
</li>
<li>统计性质
<ul>
<li>均值<span class="math inline">\(E(X_t)=\mu\)</span>
</li>
<li>方差：
<ul>
<li>AR(1）：<span class="math inline">\(G_0=1,G_1=\phi_1G_0,G_2=\phi_1G_1,方差\gamma_0=\frac{\sigma_\epsilon^2}{1-\phi_1^2}\)</span>
</li>
<li>AR(2) : <span class="math inline">\(G_0=1.G_1=\phi_1G_0,G_2=\Phi_1G_1+\phi_2G_0,方差\gamma_0=\frac{1-\phi_2}{(1+\phi_2)(1+\phi_1-\phi_2)(1-\phi_1-\phi_2)}\sigma_\epsilon^2\)</span>
<span class="math display">\[D(X_t)=\sum_0^\infty G_i^2\sigma_\epsilon^2\]</span>
</li>
</ul>
</li>
<li>自协方差
<ul>
<li>公式:<span class="math inline">\(\gamma_k=\phi_1\gamma_{k-1}+\phi_2\gamma_{k-2}\)</span>
</li>
<li>AR(1):<span class="math inline">\(\gamma_0=D(X),\gamma_1=\phi_1\gamma_0,\gamma_2=\phi_1\gamma_1\)</span>
</li>
<li>AR(2):<span class="math inline">\(\gamma_0=D(X),\gamma_1=\phi_1\gamma_0+\phi_2\gamma_1得\gamma_1=\frac{\phi_1}{1-\phi_2}\gamma_0\)</span>
</li>
</ul>
</li>
<li>自相关
<ul>
<li>自协方差函数除以<span class="math inline">\(\gamma_0\)</span>
</li>
</ul>
</li>
<li>偏自相关
<ul>
<li>yule-Walker方程:写自相关函数的方程</li>
<li>AR(1):<span class="math inline">\(\phi_{11}=\phi_1,其他为0\)</span>
</li>
<li>AR(2):<span class="math inline">\(\phi_{11}=\rho_1=\frac{\phi_1}{1-\phi_2},\phi_{22}=\phi_2,其他为0\)</span>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="ma模型" class="section level3" number="10.1.5">
<h3>
<span class="header-section-number">10.1.5</span> MA模型<a class="anchor" aria-label="anchor" href="#ma%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>均值：<span class="math inline">\(E(X_t)=\mu\)</span>
</li>
<li>方差: <span class="math inline">\(D(X_t)=(1+\theta_0+\dots+\theta_q)\sigma_\epsilon^2\)</span>
</li>
<li>协方差
<ul>
<li>MA(1)<span class="math inline">\(\begin{cases}(1+\theta_1^2+\dots+\theta_q^2)\sigma_\epsilon^2&amp; q = 0\\-\theta_1\sigma_\epsilon^2 &amp; q = 1\end{cases}\)</span>
</li>
<li>MA(2)<span class="math inline">\(\begin{cases}(1+\theta_1^2+\dots+\theta_q^2)\sigma_\epsilon^2&amp; q = 0\\(-\theta_1+\theta_1\theta_2)\sigma_\epsilon^2 &amp; q = 1\\ -\theta_2\sigma_\epsilon^2&amp;q=2\end{cases}\)</span>
</li>
</ul>
</li>
<li>自相关
<ul>
<li>除以方差</li>
</ul>
</li>
<li>偏自相关
<ul>
<li>yule-walker方程</li>
<li>MA(1)<span class="math inline">\(\begin{cases}\phi_{11}=\rho_1=\frac{-\theta_1}{1+\theta_1^2}&amp; k = 1\\ \phi_{22}=\frac{\theta_1^2}{1+\theta_1^2+\theta_1^4} &amp; k= 2\\ \phi_{33}=\frac{-\theta_1^3}{1+\theta_1^2+\theta_1^4+\theta_1^6}&amp;k=3\end{cases}\)</span>
</li>
</ul>
<span class="math inline">\(\phi_{kk}=\frac{-\theta_1^k}{\sum_0^\infty\theta_1^{2j}}\)</span>
</li>
</ul>
</div>
<div id="arma模型" class="section level3" number="10.1.6">
<h3>
<span class="header-section-number">10.1.6</span> ARMA模型<a class="anchor" aria-label="anchor" href="#arma%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>均值</p></li>
<li>
<p>方差：</p>
<ul>
<li>格林公式：<span class="math inline">\(\begin{cases}G_0=1 &amp; j = 0\\G_k=\sum_{j=1}^k\phi_j^\prime G_{k-j}-\theta_k^\prime &amp; j &gt; 0\end{cases}\)</span>
</li>
<li>ARMA(2,2):<span class="math inline">\(G_0=1,G_1=\phi_1G_0-\theta_1,G_2=\phi_1G_1+\phi_2G_0-\theta_2,G_3=\phi_1G_2+\phi_2G_1\)</span>
</li>
</ul>
</li>
<li>
<p>自协方差</p>
<ul>
<li><span class="math inline">\(y_k=\sigma_\epsilon^2\sum_{i=0}^\infty G_iG_{i+k}\)</span></li>
</ul>
</li>
<li>
<p>自相关</p>
<ul>
<li><span class="math inline">\(\rho_k=\frac{\gamma_k}{\gamma_0}=\frac{\sum_{j=0}^\infty G_jG_{j+k}}{\sum_{j=0}^{\infty}G_j^2}\)</span></li>
</ul>
</li>
<li><p>ARMA(1,1)
<span class="math display">\[G_0=1,G_k=(\phi_1-\theta_1)\phi_1^{k-1}\]</span>
<span class="math display">\[\gamma_0=\frac{1+\theta_1^2-2\theta_1\phi_1}{1-\phi_1^2}\sigma_\epsilon^2\]</span>
<span class="math display">\[\gamma_1=\frac{(\phi_1-\theta)(1-\theta_1\phi_1)}{1-\phi_1^2}\sigma_\epsilon^2\]</span>
<span class="math display">\[\gamma_2=\phi_1\gamma_1\]</span>
<span class="math display">\[\rho_1=\frac{(\phi_1-\theta_1)(1-\theta_1\phi_1)}{1+\theta_1^2-2*\theta_1\phi_1}\]</span>
<span class="math display">\[\rho_2=\phi_1\rho_1\]</span></p></li>
<li>
<p>偏自相关</p>
<ul>
<li>yule-walker方程</li>
</ul>
</li>
</ul>
</div>
<div id="crammer分解定理" class="section level3" number="10.1.7">
<h3>
<span class="header-section-number">10.1.7</span> Crammer分解定理<a class="anchor" aria-label="anchor" href="#crammer%E5%88%86%E8%A7%A3%E5%AE%9A%E7%90%86"><i class="fas fa-link"></i></a>
</h3>
<p>任何一个时间序列<span class="math inline">\({x_t}\)</span>都可以视为两部分的叠加，其中，一部分是由时间t的多项式决定的确定性成分，另一部分是由白噪声序列决定的随机性成分，即
<span class="math inline">\(x_t=\mu_t+\epsilon_t=\sum_{j=0}^d\beta_jt^j+\Psi(B)a_t\)</span></p>
<p>Crammer分解定理说明任何一个序列的波动都可以视为同时受到确定性影响和随机性影响的作用，平稳序列要求这两方面的影响都是稳定的，而非平稳的产生的激励就在于它所受到的这两方面的影响至少有一方面是不稳定的</p>
</div>
<div id="arima模型" class="section level3" number="10.1.8">
<h3>
<span class="header-section-number">10.1.8</span> ARIMA模型<a class="anchor" aria-label="anchor" href="#arima%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h3>
<p><span class="math inline">\(\Phi(B)\triangledown^dx_t=\Theta(B)\epsilon_t\)</span></p>
<p>广义自回归多项式:<span class="math inline">\(\phi(B)=\Phi(B)\triangledown^d\)</span></p>
<p>ARIMA(p,d,q)模型不平稳，并且序列方差不满足方差齐性</p>
<p><span class="math inline">\(x_t=\epsilon_t+\Psi_1\epsilon_{t-1}+\Psi_2\epsilon_{t-2}-\dots\)</span></p>
<p>广义自相关函数<span class="math inline">\(\Phi^*(B)=\Phi(B)(1-B)^d=1-\tilde{\phi_1}B-\tilde{\phi_2}B^2-\dots\)</span></p>
<p><span class="math inline">\(\Psi_1=\tilde{\phi_1}-\theta_1\)</span></p>
<p><span class="math inline">\(\Psi_2=\tilde{\phi_1}\Psi_1+\tilde{\phi_2}-\theta_2\)</span></p>
<p>疏系数模型: <span class="math inline">\(ARIMA((p_1,p_2),d,q)\)</span></p>
</div>
</div>
<div id="实践操作" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> 实践操作<a class="anchor" aria-label="anchor" href="#%E5%AE%9E%E8%B7%B5%E6%93%8D%E4%BD%9C"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb548"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb548-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb548-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb548-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-3" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb548-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-4" tabindex="-1"></a><span class="im">import</span> statsmodels.tsa.api <span class="im">as</span> tsa</span>
<span id="cb548-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-5" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb548-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-6" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb548-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-7" tabindex="-1"></a><span class="im">import</span> statsmodels</span>
<span id="cb548-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-8" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb548-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-9" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.api <span class="im">import</span> qqplot</span>
<span id="cb548-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb548-10" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span></code></pre></div>
<div class="sourceCode" id="cb549"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb549-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb549-1" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb549-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb549-2" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb549-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb549-3" tabindex="-1"></a><span class="im">from</span> IPython.core.interactiveshell <span class="im">import</span> InteractiveShell</span>
<span id="cb549-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb549-4" tabindex="-1"></a>InteractiveShell.ast_node_interactivity <span class="op">=</span> <span class="st">'all'</span></span></code></pre></div>
<div class="sourceCode" id="cb550"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb550-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb550-1" tabindex="-1"></a><span class="co"># 导入数据</span></span>
<span id="cb550-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb550-2" tabindex="-1"></a>data<span class="op">=</span>pd.read_excel(<span class="st">'../习题与案例数据/案例数据/A1_7.xlsx'</span>,index_col<span class="op">=</span><span class="st">'year'</span>)</span>
<span id="cb550-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb550-3" tabindex="-1"></a>data.index<span class="op">=</span>pd.date_range(<span class="st">'1900'</span>,<span class="st">'1999'</span>,freq<span class="op">=</span><span class="st">'a'</span>)<span class="co">#不要以年份做索引，可能会有问题</span></span>
<span id="cb550-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb550-4" tabindex="-1"></a>data</span></code></pre></div>
<div id="绘制时序图" class="section level3" number="10.2.1">
<h3>
<span class="header-section-number">10.2.1</span> 绘制时序图<a class="anchor" aria-label="anchor" href="#%E7%BB%98%E5%88%B6%E6%97%B6%E5%BA%8F%E5%9B%BE"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb551"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb551-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb551-1" tabindex="-1"></a>plt.plot(data)</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168d9804d88&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_5_1.png"></div>
</div>
<div id="模型识别" class="section level3 tabset" number="10.2.2">
<h3>
<span class="header-section-number">10.2.2</span> 模型识别<a class="anchor" aria-label="anchor" href="#%E6%A8%A1%E5%9E%8B%E8%AF%86%E5%88%AB"><i class="fas fa-link"></i></a>
</h3>
<div id="序列的描述性统计" class="section level4" number="10.2.2.1">
<h4>
<span class="header-section-number">10.2.2.1</span> 序列的描述性统计<a class="anchor" aria-label="anchor" href="#%E5%BA%8F%E5%88%97%E7%9A%84%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>序列的平稳性检验结果</li>
</ul>
<p>adf检验</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb553-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb553-1" tabindex="-1"></a>tsa.adfuller(data[<span class="st">'number'</span>])<span class="co">#array_like, 1d data series</span></span>
<span id="cb553-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb553-2" tabindex="-1"></a><span class="co">#help(tsa.adfuller)</span></span></code></pre></div>
<pre><code>(-3.183192251191782,
 0.02097842525600371,
 2,
 96,
 {'1%': -3.5003788874873405,
  '5%': -2.8921519665075235,
  '10%': -2.5830997960069446},
 549.0681467660734)

maxlag：最大滞后阶数，也就是自回归阶数
regression：自回归项是一定被包括的，maxlag设定了阶数
'c':只有常数项（漂移项）
'ct':漂移项和趋势项
'nc':只有自回归项
'ctt':constant, and linear and quadratic trend
autolag：自动选择lag，基于bic，aic等准则，只有设置为None，自己设置的maxlag才会被使用，否则模型会自动选择最好的lag
其他的见上面</code></pre>
<p><strong>返回adf,p值，回归阶数，样本数，0.01,0.05,0.1分位点的值，aic等信息准则的值，等。</strong></p>
<div class="sourceCode" id="cb555"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb555-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb555-1" tabindex="-1"></a>tsa.adfuller(data.number,autolag<span class="op">=</span><span class="va">None</span>,maxlag<span class="op">=</span><span class="dv">1</span>)<span class="co">#自己设置模型的lag为1,maxlag代表差分阶数</span></span></code></pre></div>
<pre><code>(-3.9178563779331284,
 0.001907294129421782,
 1,
 97,
 {'1%': -3.4996365338407074,
  '5%': -2.8918307730370025,
  '10%': -2.5829283377617176})</code></pre>
<div class="sourceCode" id="cb557"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb557-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-1" tabindex="-1"></a>reg<span class="op">=</span>[<span class="st">'nc'</span>,<span class="st">'c'</span>,<span class="st">'ct'</span>]</span>
<span id="cb557-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-2" tabindex="-1"></a>lag<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb557-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-3" tabindex="-1"></a>model<span class="op">=</span>[<span class="st">'自回归'</span>,<span class="st">'漂移项+自回归'</span>,<span class="st">'漂移项+趋势项+自回归'</span>]</span>
<span id="cb557-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-4" tabindex="-1"></a>results<span class="op">=</span>[]</span>
<span id="cb557-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-5" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> reg:</span>
<span id="cb557-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-6" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> lag:</span>
<span id="cb557-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-7" tabindex="-1"></a>        types<span class="op">=</span>model[reg.index(i)]</span>
<span id="cb557-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-8" tabindex="-1"></a>        stat,p<span class="op">=</span>tsa.adfuller(data.number,autolag<span class="op">=</span><span class="va">None</span>,maxlag<span class="op">=</span>j,regression<span class="op">=</span>i)[:<span class="dv">2</span>]</span>
<span id="cb557-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-9" tabindex="-1"></a>        results.append([types,j,stat,p])</span>
<span id="cb557-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb557-10" tabindex="-1"></a>pd.DataFrame(results,columns<span class="op">=</span>[<span class="st">'type'</span>,<span class="st">'lag'</span>,<span class="st">'统计量值'</span>,<span class="st">'p值'</span>])</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
type
</th>
<th>
lag
</th>
<th>
统计量值
</th>
<th>
p值
</th>
</tr></thead>
<tbody>
<tr>
<td>
0
</td>
<td>
自回归
</td>
<td>
0
</td>
<td>
-1.584539
</td>
<td>
0.106501
</td>
</tr>
<tr>
<td>
1
</td>
<td>
自回归
</td>
<td>
1
</td>
<td>
-1.045064
</td>
<td>
0.266416
</td>
</tr>
<tr>
<td>
2
</td>
<td>
自回归
</td>
<td>
2
</td>
<td>
-0.652610
</td>
<td>
0.432560
</td>
</tr>
<tr>
<td>
3
</td>
<td>
漂移项+自回归
</td>
<td>
0
</td>
<td>
-5.353999
</td>
<td>
0.000004
</td>
</tr>
<tr>
<td>
4
</td>
<td>
漂移项+自回归
</td>
<td>
1
</td>
<td>
-3.917856
</td>
<td>
0.001907
</td>
</tr>
<tr>
<td>
5
</td>
<td>
漂移项+自回归
</td>
<td>
2
</td>
<td>
-3.183192
</td>
<td>
0.020978
</td>
</tr>
<tr>
<td>
6
</td>
<td>
漂移项+趋势项+自回归
</td>
<td>
0
</td>
<td>
-5.551394
</td>
<td>
0.000018
</td>
</tr>
<tr>
<td>
7
</td>
<td>
漂移项+趋势项+自回归
</td>
<td>
1
</td>
<td>
-4.141835
</td>
<td>
0.005471
</td>
</tr>
<tr>
<td>
8
</td>
<td>
漂移项+趋势项+自回归
</td>
<td>
2
</td>
<td>
-3.509947
</td>
<td>
0.038338
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="sourceCode" id="cb558"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb558-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb558-1" tabindex="-1"></a><span class="bu">dir</span>(tsa.adfuller(data.number,regresults<span class="op">=</span><span class="va">True</span>)[<span class="op">-</span><span class="dv">1</span>])[:<span class="dv">2</span>]<span class="op">+</span><span class="bu">dir</span>(tsa.adfuller(data.number,regresults<span class="op">=</span><span class="va">True</span>)[<span class="op">-</span><span class="dv">1</span>])[<span class="op">-</span><span class="dv">8</span>:]</span>
<span id="cb558-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb558-2" tabindex="-1"></a>tsa.adfuller(data.number,regresults<span class="op">=</span><span class="va">True</span>)[<span class="op">-</span><span class="dv">1</span>].adfstat<span class="co">#返回adf值</span></span></code></pre></div>
<pre><code>['H0',
 'HA',
 'adfstat',
 'autolag_results',
 'critvalues',
 'icbest',
 'maxlag',
 'nobs',
 'resols',
 'usedlag']

-3.183192251191782</code></pre>
<p>从漂移项加自回归，或者漂移项+趋势项+自回归都可以看出，模型是平稳的</p>
</div>
<div id="序列的纯随机性检验结果" class="section level4" number="10.2.2.2">
<h4>
<span class="header-section-number">10.2.2.2</span> 序列的纯随机性检验结果<a class="anchor" aria-label="anchor" href="#%E5%BA%8F%E5%88%97%E7%9A%84%E7%BA%AF%E9%9A%8F%E6%9C%BA%E6%80%A7%E6%A3%80%E9%AA%8C%E7%BB%93%E6%9E%9C"><i class="fas fa-link"></i></a>
</h4>
<p>纯随机性检验也就是LB检验，利用Q统计量</p>
<p>因为LB统计量（Q统计量的修正）是利用k阶延迟自相关系数来计算的，所以必须获得前k阶的自相关系数。k一般取6或12</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb560-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb560-1" tabindex="-1"></a><span class="co"># 计算k阶延迟自相关</span></span>
<span id="cb560-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb560-2" tabindex="-1"></a>tsa.acf(data.number,nlags<span class="op">=</span><span class="dv">12</span>)<span class="co">#从0步到12步,但是实际计算q统计量是从1步开始算的。所以实际计算时应该去掉0步</span></span></code></pre></div>
<pre><code>array([ 1.        ,  0.54173285,  0.41888438,  0.39795532,  0.32404731,
        0.23716419,  0.17179424,  0.19022816,  0.06120181, -0.04850548,
       -0.10673042, -0.04327143, -0.07230482])</code></pre>
<div class="sourceCode" id="cb562"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb562-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb562-1" tabindex="-1"></a><span class="co">#计算k阶延迟偏自相关</span></span>
<span id="cb562-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb562-2" tabindex="-1"></a>tsa.pacf(data.number,nlags<span class="op">=</span><span class="dv">12</span>)</span></code></pre></div>
<pre><code>array([ 1.        ,  0.54726074,  0.18276348,  0.17599425,  0.04046234,
       -0.02925253, -0.04206131,  0.0784646 , -0.14778847, -0.15651177,
       -0.1296911 ,  0.113972  ,  0.01187113])</code></pre>
<div class="sourceCode" id="cb564"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb564-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb564-1" tabindex="-1"></a><span class="co">#计算Q统计量</span></span>
<span id="cb564-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb564-2" tabindex="-1"></a></span>
<span id="cb564-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb564-3" tabindex="-1"></a>q_acf<span class="op">=</span>tsa.q_stat(tsa.acf(data.number,nlags<span class="op">=</span><span class="dv">12</span>)[<span class="dv">1</span>:],nobs<span class="op">=</span><span class="bu">len</span>(data.number))<span class="co">#用自相关系数计算Q统计量,nobs为总的样本量，而不是自相关的延迟阶数</span></span>
<span id="cb564-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb564-4" tabindex="-1"></a><span class="co">#q_pacf=tsa.q_stat(tsa.pacf(data.number,nlags=12)[1:],nobs=len(data.number))</span></span>
<span id="cb564-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb564-5" tabindex="-1"></a>q_acf</span>
<span id="cb564-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb564-6" tabindex="-1"></a><span class="co">#q_pacf</span></span></code></pre></div>
<pre><code>(array([29.94338136, 48.03065781, 64.52572016, 75.57794735, 81.56105668,
        84.73420816, 88.66715745, 89.07872742, 89.34012141, 90.61992405,
        90.83267742, 91.43353531]),
 array([4.44847764e-08, 3.71770714e-11, 6.33585229e-14, 1.50371504e-15,
        3.95511245e-16, 3.74733217e-16, 2.32297279e-16, 7.15231635e-16,
        2.20818568e-15, 4.03523693e-15, 1.14482818e-14, 2.60445654e-14]))</code></pre>
<div class="sourceCode" id="cb566"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb566-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb566-1" tabindex="-1"></a><span class="bu">help</span>(tsa.q_stat)</span></code></pre></div>
<pre><code>Help on function q_stat in module statsmodels.tsa.stattools:

q_stat(x, nobs, type='ljungbox')
    Return's Ljung-Box Q Statistic
    
    x : array-like
        Array of autocorrelation coefficients.  Can be obtained from acf.
    nobs : int
        Number of observations in the entire sample (ie., not just the length
        of the autocorrelation function results.
    
    Returns
    -------
    q-stat : array
        Ljung-Box Q-statistic for autocorrelation parameters
    p-value : array
        P-value of the Q statistic
    
    Notes
    -----
    Written to be used with acf.</code></pre>
<div class="sourceCode" id="cb568"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb568-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb568-1" tabindex="-1"></a><span class="co">#acf,pacf都代表</span></span>
<span id="cb568-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb568-2" tabindex="-1"></a><span class="kw">def</span> suiji(data,nobs,lag<span class="op">=</span><span class="dv">12</span>):</span>
<span id="cb568-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb568-3" tabindex="-1"></a>    suiji<span class="op">=</span>pd.DataFrame()</span>
<span id="cb568-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb568-4" tabindex="-1"></a>    suiji[<span class="st">'acf'</span>]<span class="op">=</span>tsa.acf(data,nlags<span class="op">=</span>lag)[<span class="dv">1</span>:]</span>
<span id="cb568-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb568-5" tabindex="-1"></a>    suiji[<span class="st">'pacf'</span>]<span class="op">=</span>tsa.pacf(data,nlags<span class="op">=</span>lag)[<span class="dv">1</span>:]</span>
<span id="cb568-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb568-6" tabindex="-1"></a>    suiji[<span class="st">'Q'</span>]<span class="op">=</span>tsa.q_stat(tsa.acf(data,nlags<span class="op">=</span>lag)[<span class="dv">1</span>:],nobs<span class="op">=</span>nobs)[<span class="dv">0</span>]</span>
<span id="cb568-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb568-7" tabindex="-1"></a>    suiji[<span class="st">'P'</span>]<span class="op">=</span>tsa.q_stat(tsa.acf(data,nlags<span class="op">=</span>lag)[<span class="dv">1</span>:],nobs<span class="op">=</span>nobs)[<span class="dv">1</span>]</span>
<span id="cb568-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb568-8" tabindex="-1"></a>    <span class="cf">return</span> suiji</span></code></pre></div>
<div class="sourceCode" id="cb569"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb569-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb569-1" tabindex="-1"></a>suiji(data.number,lag<span class="op">=</span><span class="dv">12</span>,nobs<span class="op">=</span><span class="bu">len</span>(data.number))</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
acf
</th>
<th>
pacf
</th>
<th>
Q
</th>
<th>
P
</th>
</tr></thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0.541733
</td>
<td>
0.547261
</td>
<td>
29.943381
</td>
<td>
4.448478e-08
</td>
</tr>
<tr>
<th>
1
</th>
<td>
0.418884
</td>
<td>
0.182763
</td>
<td>
48.030658
</td>
<td>
3.717707e-11
</td>
</tr>
<tr>
<th>
2
</th>
<td>
0.397955
</td>
<td>
0.175994
</td>
<td>
64.525720
</td>
<td>
6.335852e-14
</td>
</tr>
<tr>
<th>
3
</th>
<td>
0.324047
</td>
<td>
0.040462
</td>
<td>
75.577947
</td>
<td>
1.503715e-15
</td>
</tr>
<tr>
<th>
4
</th>
<td>
0.237164
</td>
<td>
-0.029253
</td>
<td>
81.561057
</td>
<td>
3.955112e-16
</td>
</tr>
<tr>
<th>
5
</th>
<td>
0.171794
</td>
<td>
-0.042061
</td>
<td>
84.734208
</td>
<td>
3.747332e-16
</td>
</tr>
<tr>
<th>
6
</th>
<td>
0.190228
</td>
<td>
0.078465
</td>
<td>
88.667157
</td>
<td>
2.322973e-16
</td>
</tr>
<tr>
<th>
7
</th>
<td>
0.061202
</td>
<td>
-0.147788
</td>
<td>
89.078727
</td>
<td>
7.152316e-16
</td>
</tr>
<tr>
<th>
8
</th>
<td>
-0.048505
</td>
<td>
-0.156512
</td>
<td>
89.340121
</td>
<td>
2.208186e-15
</td>
</tr>
<tr>
<th>
9
</th>
<td>
-0.106730
</td>
<td>
-0.129691
</td>
<td>
90.619924
</td>
<td>
4.035237e-15
</td>
</tr>
<tr>
<th>
10
</th>
<td>
-0.043271
</td>
<td>
0.113972
</td>
<td>
90.832677
</td>
<td>
1.144828e-14
</td>
</tr>
<tr>
<th>
11
</th>
<td>
-0.072305
</td>
<td>
0.011871
</td>
<td>
91.433535
</td>
<td>
2.604457e-14
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="序列的各种自相关图" class="section level4" number="10.2.2.3">
<h4>
<span class="header-section-number">10.2.2.3</span> 序列的各种自相关图<a class="anchor" aria-label="anchor" href="#%E5%BA%8F%E5%88%97%E7%9A%84%E5%90%84%E7%A7%8D%E8%87%AA%E7%9B%B8%E5%85%B3%E5%9B%BE"><i class="fas fa-link"></i></a>
</h4>
<p>绘制时间序列图形的包在statsmodels中 <code>from statsmodels.graphics.tsaplots import plot_acf, plot_pacf</code></p>
<div class="sourceCode" id="cb570"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb570-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb570-1" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span></code></pre></div>
<div class="sourceCode" id="cb571"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb571-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb571-1" tabindex="-1"></a>plot_acf(data.number).show()</span>
<span id="cb571-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb571-2" tabindex="-1"></a>plot_pacf(data.number).show()</span></code></pre></div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_24_0.png"></div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_24_1.png"></div>
<p>从相关图形和q统计量都可以看出，在短期内是存在相关性的，所以这是一个非纯随机时间序列，非白噪声序列。可以进行进一步的分析，也就是建模分析，预测。</p>
</div>
</div>
<div id="模型构建" class="section level3 tabset" number="10.2.3">
<h3>
<span class="header-section-number">10.2.3</span> 模型构建<a class="anchor" aria-label="anchor" href="#%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA"><i class="fas fa-link"></i></a>
</h3>
<p>从自相关图可以看出是拖尾的，从偏相关图可以看出是截尾的。阶数为2.所以应该应用AR(2)模型</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb572-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb572-1" tabindex="-1"></a><span class="co">#导入ar和arma模型的一种方式</span></span>
<span id="cb572-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb572-2" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa <span class="im">import</span> ar_model</span>
<span id="cb572-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb572-3" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa <span class="im">import</span> arima_model</span>
<span id="cb572-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb572-4" tabindex="-1"></a>ar_model.AR</span>
<span id="cb572-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb572-5" tabindex="-1"></a>arima_model.ARMA</span></code></pre></div>
<pre><code>statsmodels.tsa.ar_model.AR

statsmodels.tsa.arima_model.ARMA</code></pre>
<div class="sourceCode" id="cb574"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb574-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb574-1" tabindex="-1"></a><span class="co">#导入statsmodels.api后，在tsa下可以直接运用模型</span></span>
<span id="cb574-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb574-2" tabindex="-1"></a>sm.tsa.AR</span>
<span id="cb574-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb574-3" tabindex="-1"></a>sm.tsa.ARMA</span></code></pre></div>
<pre><code>statsmodels.tsa.ar_model.AR

statsmodels.tsa.arima_model.ARMA</code></pre>
<p>我们下面只看ARMA的实现，因为AR模型就相当于与ARMA（p，0）</p>
<div id="模型定阶" class="section level4" number="10.2.3.1">
<h4>
<span class="header-section-number">10.2.3.1</span> 模型定阶<a class="anchor" aria-label="anchor" href="#%E6%A8%A1%E5%9E%8B%E5%AE%9A%E9%98%B6"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb576"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb576-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb576-1" tabindex="-1"></a><span class="co">#构建arma模型，首先是创建arma模型实例，给与一个时间序列数据</span></span>
<span id="cb576-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb576-2" tabindex="-1"></a>arma_mod20<span class="op">=</span>sm.tsa.ARMA(data,(<span class="dv">2</span>,<span class="dv">0</span>))<span class="co">#数据是序列或数据框，索引是时间序列数据,并且设置阶数</span></span>
<span id="cb576-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb576-3" tabindex="-1"></a>arma_mod20fit<span class="op">=</span>arma_mod20.fit(disp<span class="op">=-</span><span class="dv">1</span>,trend<span class="op">=</span><span class="st">'c'</span>)<span class="co">#这里面可以选择方法和是否添加常数项等。默认有常数项</span></span>
<span id="cb576-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb576-4" tabindex="-1"></a>arma_mod20fit.summary()</span></code></pre></div>
<p>模型的显著性检验先不看,可以看到参数的检验都是通过的，而通过根的大小（都大于1）我们可以判断出这个AR模型是平稳的。</p>
<p>其实python中还允许利用函数来判断一个arma模型的平稳性和可逆性，<code>from statsmodels.tsa.arima_process import ArmaProcess</code></p>
<p>但是需要事先构建模型获得系数参数</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb577-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-1" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima_process <span class="im">import</span> ArmaProcess</span>
<span id="cb577-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-2" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb577-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-3" tabindex="-1"></a><span class="co"># include zero-th lag</span></span>
<span id="cb577-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-4" tabindex="-1"></a><span class="co">#arma（4,1）</span></span>
<span id="cb577-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-5" tabindex="-1"></a>arparams <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="fl">.75</span>, <span class="op">-</span><span class="fl">.65</span>, <span class="op">-</span><span class="fl">.55</span>, <span class="fl">.9</span>])<span class="co">#4阶ar，注意需要包含0阶，这实际上就是自回归系数多项式</span></span>
<span id="cb577-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-6" tabindex="-1"></a>maparams <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="fl">.65</span>])<span class="co">#1阶ma，注意需要包含0阶，这实际上就是系数多项式</span></span>
<span id="cb577-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-7" tabindex="-1"></a>arma_t <span class="op">=</span> ArmaProcess(arparams, maparams)<span class="co">#传递ar和ma的系数参数</span></span>
<span id="cb577-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-8" tabindex="-1"></a>arma_t.isinvertible<span class="co">#判断可逆性</span></span>
<span id="cb577-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb577-9" tabindex="-1"></a>arma_t.isstationary<span class="co">#判断平稳性</span></span></code></pre></div>
<pre><code>True

False</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb579-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb579-1" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb579-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb579-2" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb579-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb579-3" tabindex="-1"></a>ax.plot(arma_t.generate_sample(nsample<span class="op">=</span><span class="dv">50</span>))<span class="op">;</span></span></code></pre></div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_37_0.png"></div>
<p><a href="#%E6%A8%A1%E5%9E%8B%E5%AE%9A%E9%98%B6%E7%9A%84%E7%AE%80%E4%BE%BF%E6%96%B9%E6%B3%95">见模型定阶的简便方法</a><a></a></p>
<p>另外需要注意的是python中的arma模型不允许构建不平稳的模型，否则会报错。所以我们先在利用bic准则，查看5阶内所有的模型的bic量，对于报错的我们把它的bic定为无穷</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb580-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-1" tabindex="-1"></a>p<span class="op">=</span><span class="bu">range</span>(<span class="dv">6</span>)</span>
<span id="cb580-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-2" tabindex="-1"></a>q<span class="op">=</span><span class="bu">range</span>(<span class="dv">6</span>)</span>
<span id="cb580-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-3" tabindex="-1"></a>rank<span class="op">=</span>[]</span>
<span id="cb580-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-4" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> p:</span>
<span id="cb580-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-5" tabindex="-1"></a>    con<span class="op">=</span>[]</span>
<span id="cb580-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-6" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> q:</span>
<span id="cb580-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-7" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb580-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-8" tabindex="-1"></a>            con.append(arima_model.ARMA(data.number,(i,j)).fit(disp<span class="op">=-</span><span class="dv">1</span>).bic)</span>
<span id="cb580-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-9" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb580-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-10" tabindex="-1"></a>            con.append(np.Inf)</span>
<span id="cb580-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-11" tabindex="-1"></a>    rank.append(con)</span>
<span id="cb580-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-12" tabindex="-1"></a>rank<span class="op">=</span>pd.DataFrame(rank,index<span class="op">=</span>[<span class="st">'AR'</span><span class="op">+</span><span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> p],columns<span class="op">=</span>[<span class="st">'MA'</span><span class="op">+</span><span class="bu">str</span>(j) <span class="cf">for</span> j <span class="kw">in</span> q])</span>
<span id="cb580-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb580-13" tabindex="-1"></a>rank</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
MA0
</th>
<th>
MA1
</th>
<th>
MA2
</th>
<th>
MA3
</th>
<th>
MA4
</th>
<th>
MA5
</th>
</tr></thead>
<tbody>
<tr>
<td>
AR0
</td>
<td>
681.734599
</td>
<td>
662.632218
</td>
<td>
662.113706
</td>
<td>
660.906160
</td>
<td>
662.699747
</td>
<td>
666.007394
</td>
</tr>
<tr>
<td>
AR1
</td>
<td>
651.753037
</td>
<td>
650.836763
</td>
<td>
655.356467
</td>
<td>
658.633388
</td>
<td>
662.940464
</td>
<td>
667.036829
</td>
</tr>
<tr>
<td>
AR2
</td>
<td>
653.114333
</td>
<td>
inf
</td>
<td>
658.039309
</td>
<td>
inf
</td>
<td>
inf
</td>
<td>
inf
</td>
</tr>
<tr>
<td>
AR3
</td>
<td>
654.472268
</td>
<td>
658.915996
</td>
<td>
663.356277
</td>
<td>
665.307412
</td>
<td>
inf
</td>
<td>
inf
</td>
</tr>
<tr>
<td>
AR4
</td>
<td>
658.853051
</td>
<td>
663.431867
</td>
<td>
665.500353
</td>
<td>
670.043316
</td>
<td>
inf
</td>
<td>
inf
</td>
</tr>
<tr>
<td>
AR5
</td>
<td>
663.385982
</td>
<td>
665.232821
</td>
<td>
672.597914
</td>
<td>
679.265916
</td>
<td>
671.782722
</td>
<td>
inf
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="sourceCode" id="cb581"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb581-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb581-1" tabindex="-1"></a>rank.<span class="bu">min</span>()</span></code></pre></div>
<pre><code>MA0    651.753037
MA1    650.836763
MA2    655.356467
MA3    658.633388
MA4    662.699747
MA5    666.007394
dtype: float64</code></pre>
<p>可以看到AR(1,1)模型bic最小，并且模型平稳，我们最终模型定阶为（1，1）</p>
</div>
<div id="检验" class="section level4" number="10.2.3.2">
<h4>
<span class="header-section-number">10.2.3.2</span> 检验<a class="anchor" aria-label="anchor" href="#%E6%A3%80%E9%AA%8C"><i class="fas fa-link"></i></a>
</h4>
<p>包括模型的显著性，也即残差是否是一个白噪声序列</p>
<p>残差的相关性检验，DW检验</p>
<p>对于arma模型，我们假定残差服从正态分布，所以需要检验残差的正态性</p>
</div>
<div id="相关性检验" class="section level4" number="10.2.3.3">
<h4>
<span class="header-section-number">10.2.3.3</span> 相关性检验<a class="anchor" aria-label="anchor" href="#%E7%9B%B8%E5%85%B3%E6%80%A7%E6%A3%80%E9%AA%8C"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb583"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb583-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb583-1" tabindex="-1"></a>sm.stats.durbin_watson(arma_mod11fit.resid.values)</span></code></pre></div>
<pre><code>1.959664111340092</code></pre>
<div class="sourceCode" id="cb585"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb585-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb585-1" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb585-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb585-2" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb585-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb585-3" tabindex="-1"></a>ax1.plot(arma_mod11fit.resid)</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dc340f88&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_49_1.png"></div>
</div>
<div id="正态性检验" class="section level4" number="10.2.3.4">
<h4>
<span class="header-section-number">10.2.3.4</span> 正态性检验<a class="anchor" aria-label="anchor" href="#%E6%AD%A3%E6%80%81%E6%80%A7%E6%A3%80%E9%AA%8C"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb587"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb587-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-1" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb587-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-2" tabindex="-1"></a><span class="co">#正态检验</span></span>
<span id="cb587-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-3" tabindex="-1"></a>resid <span class="op">=</span> arma_mod11fit.resid</span>
<span id="cb587-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-4" tabindex="-1"></a>stats.normaltest(resid)<span class="co">#利用stats包中的正态测试</span></span>
<span id="cb587-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-5" tabindex="-1"></a><span class="co">#利用qq图</span></span>
<span id="cb587-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-6" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.api <span class="im">import</span> qqplot</span>
<span id="cb587-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-7" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb587-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-8" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb587-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb587-9" tabindex="-1"></a>fig <span class="op">=</span> qqplot(resid, line<span class="op">=</span><span class="st">'q'</span>, ax<span class="op">=</span>ax, fit<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>NormaltestResult(statistic=5.939742977265384, pvalue=0.051309903814136935)</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_51_1.png"></div>
</div>
<div id="随机性检验" class="section level4" number="10.2.3.5">
<h4>
<span class="header-section-number">10.2.3.5</span> 随机性检验<a class="anchor" aria-label="anchor" href="#%E9%9A%8F%E6%9C%BA%E6%80%A7%E6%A3%80%E9%AA%8C"><i class="fas fa-link"></i></a>
</h4>
<p>即检验模型的显著性</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb589-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-1" tabindex="-1"></a><span class="co">#残差的随机性检验</span></span>
<span id="cb589-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-2" tabindex="-1"></a>r,q,p <span class="op">=</span> sm.tsa.acf(resid.values.squeeze(), fft<span class="op">=</span><span class="va">True</span>, qstat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb589-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-3" tabindex="-1"></a>data1 <span class="op">=</span> np.c_[<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">41</span>), r[<span class="dv">1</span>:], q, p]<span class="co">#默认是40期</span></span>
<span id="cb589-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-4" tabindex="-1"></a>table <span class="op">=</span> pd.DataFrame(data1, columns<span class="op">=</span>[<span class="st">'lag'</span>, <span class="st">"AC"</span>, <span class="st">"Q"</span>, <span class="st">"Prob(&gt;Q)"</span>])</span>
<span id="cb589-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-5" tabindex="-1"></a><span class="bu">print</span>(table.set_index(<span class="st">'lag'</span>))</span>
<span id="cb589-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-6" tabindex="-1"></a><span class="co">#当残差的随机性检验不通过的时候，可以通过残差的相关图看看还有哪些相关关系未提取干净</span></span>
<span id="cb589-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-7" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb589-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-8" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">211</span>)</span>
<span id="cb589-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-9" tabindex="-1"></a>fig <span class="op">=</span> sm.graphics.tsa.plot_acf(resid.values.squeeze(), lags<span class="op">=</span><span class="dv">40</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb589-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-10" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">212</span>)</span>
<span id="cb589-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb589-11" tabindex="-1"></a>fig <span class="op">=</span> sm.graphics.tsa.plot_pacf(resid, lags<span class="op">=</span><span class="dv">40</span>, ax<span class="op">=</span>ax2)</span></code></pre></div>
<pre><code>            AC          Q  Prob(&gt;Q)
lag                                
1.0   0.010300   0.010825  0.917133
2.0  -0.063396   0.425117  0.808513
3.0   0.065777   0.875755  0.831274
4.0   0.047298   1.111215  0.892489
5.0  -0.004223   1.113112  0.952937
6.0  -0.028136   1.198227  0.976972
7.0   0.144325   3.462101  0.839223
8.0  -0.002454   3.462763  0.902060
9.0  -0.113296   4.888849  0.843888
10.0 -0.157036   7.659406  0.662066
11.0  0.045036   7.889868  0.723134
12.0  0.018466   7.929059  0.790649
13.0 -0.056399   8.298885  0.823598
14.0 -0.067152   8.829343  0.841825
15.0 -0.011891   8.846175  0.885422
16.0 -0.171222  12.377992  0.717576
17.0 -0.011226  12.393360  0.775755
18.0 -0.019499  12.440294  0.823693
19.0  0.147969  15.176856  0.711292
20.0 -0.014903  15.204967  0.764562
21.0 -0.023304  15.274586  0.808926
22.0  0.098692  16.539408  0.788244
23.0 -0.148043  19.422915  0.676424
24.0 -0.092072  20.553106  0.664927
25.0  0.050855  20.902567  0.698030
26.0  0.171934  24.951672  0.521712
27.0 -0.003867  24.953749  0.577054
28.0  0.003667  24.955643  0.630249
29.0 -0.088285  26.068993  0.621801
30.0  0.042425  26.329814  0.658196
31.0 -0.039924  26.564193  0.693876
32.0  0.075991  27.425989  0.697433
33.0  0.091602  28.697210  0.681352
34.0  0.053442  29.136551  0.704902
35.0 -0.034872  29.326542  0.738179
36.0 -0.068495  30.071156  0.745837
37.0  0.060894  30.669183  0.759259
38.0 -0.057669  31.214327  0.774112
39.0  0.030721  31.371606  0.802514
40.0  0.020507  31.442874  0.831202</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_53_1.png"></div>
<p>从检验看出残差之间相关性很弱，满足假设</p>
</div>
<div id="预测" class="section level4" number="10.2.3.6">
<h4>
<span class="header-section-number">10.2.3.6</span> 预测<a class="anchor" aria-label="anchor" href="#%E9%A2%84%E6%B5%8B"><i class="fas fa-link"></i></a>
</h4>
<p>利用模型的predict函数和predict_plot函数，可以预测值，以及绘制预测值的图</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb591-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb591-1" tabindex="-1"></a>arma_mod11fit.predict(<span class="st">'1980'</span>,<span class="st">'2005'</span>)</span></code></pre></div>
<pre><code>1980-12-31    17.465377
1981-12-31    18.049009
1982-12-31    16.729012
1983-12-31    14.577349
1984-12-31    15.606044
1985-12-31    13.299255
1986-12-31    15.047666
1987-12-31    12.267820
1988-12-31    13.022072
1989-12-31    12.170360
1990-12-31    11.404516
1991-12-31    13.432397
1992-12-31    13.137112
1993-12-31    18.126782
1994-12-31    17.550478
1995-12-31    16.904956
1996-12-31    20.560380
1997-12-31    20.976142
1998-12-31    20.370293
1999-12-31    18.530631
2000-12-31    18.723334
2001-12-31    18.883399
2002-12-31    19.016353
2003-12-31    19.126788
2004-12-31    19.218519
2005-12-31    19.294713
Freq: A-DEC, dtype: float64</code></pre>
<div class="sourceCode" id="cb593"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb593-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb593-1" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb593-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb593-2" tabindex="-1"></a>ax.plot(data)</span>
<span id="cb593-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb593-3" tabindex="-1"></a><span class="co">#arma_mod11fit.plot_predict('2000', '2006',)有问题</span></span>
<span id="cb593-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb593-4" tabindex="-1"></a>ax.plot(arma_mod11fit.predict())</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dd0b0fc8&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dd0b9b88&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_57_2.png"></div>
<div class="sourceCode" id="cb595"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb595-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb595-1" tabindex="-1"></a>arma_mod11fit.fittedvalues</span></code></pre></div>
<pre><code>1900-12-31    19.668380
1901-12-31    16.071618
1902-12-31    15.810983
1903-12-31    13.350267
1904-12-31    13.098084
                ...    
1994-12-31    17.550478
1995-12-31    16.904956
1996-12-31    20.560380
1997-12-31    20.976142
1998-12-31    20.370293
Freq: A-DEC, Length: 99, dtype: float64</code></pre>
<div class="sourceCode" id="cb597"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb597-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb597-1" tabindex="-1"></a>arma_mod11fit.forecast(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>(array([18.5306311 , 18.72333411, 18.8833986 , 19.01635263, 19.12678795]),
 array([5.88763837, 6.32759403, 6.61409924, 6.80474257, 6.93322013]),
 array([[ 6.99107194, 30.07019026],
        [ 6.32147771, 31.12519051],
        [ 5.92000229, 31.84679491],
        [ 5.67930228, 32.35340298],
        [ 5.5379262 , 32.7156497 ]]))</code></pre>
<div class="sourceCode" id="cb599"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb599-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb599-1" tabindex="-1"></a>arma_mod11fit.predict(<span class="st">'1999'</span>,<span class="st">'2005'</span>)</span></code></pre></div>
<pre><code>1999-12-31    18.530631
2000-12-31    18.723334
2001-12-31    18.883399
2002-12-31    19.016353
2003-12-31    19.126788
2004-12-31    19.218519
2005-12-31    19.294713
Freq: A-DEC, dtype: float64</code></pre>
<div class="sourceCode" id="cb601"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb601-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb601-1" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb601-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb601-2" tabindex="-1"></a>ax.plot(data,color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb601-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb601-3" tabindex="-1"></a>ax.plot(arma_mod11fit.predict(),ls<span class="op">=</span><span class="st">'--'</span>,color<span class="op">=</span><span class="st">'green'</span>,label<span class="op">=</span><span class="st">'in-sample'</span>)</span>
<span id="cb601-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb601-4" tabindex="-1"></a>ax.plot(arma_mod11fit.predict(<span class="st">'1999'</span>,<span class="st">'2019'</span>),ls<span class="op">=</span><span class="st">'-.'</span>,color<span class="op">=</span><span class="st">'red'</span>,label<span class="op">=</span><span class="st">'out-sample'</span>)</span>
<span id="cb601-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb601-5" tabindex="-1"></a>l,r<span class="op">=</span>arma_mod11fit.forecast(<span class="dv">20</span>,alpha<span class="op">=</span><span class="fl">0.8</span>)[<span class="dv">2</span>][:,<span class="dv">0</span>],arma_mod11fit.forecast(<span class="dv">20</span>,alpha<span class="op">=</span><span class="fl">0.8</span>)[<span class="dv">2</span>][:,<span class="dv">1</span>]</span>
<span id="cb601-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb601-6" tabindex="-1"></a>ax.fill_between(pd.date_range(<span class="st">'1999'</span>,<span class="st">'2019'</span>,freq<span class="op">=</span><span class="st">'a'</span>),l,r)</span>
<span id="cb601-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb601-7" tabindex="-1"></a>ax.legend()</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dcd2dac8&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dcd4c1c8&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dcd4cb48&gt;]

&lt;matplotlib.collections.PolyCollection at 0x168dcd51ec8&gt;

&lt;matplotlib.legend.Legend at 0x168dcd51f88&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_61_5.png"></div>
<div class="sourceCode" id="cb603"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb603-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb603-1" tabindex="-1"></a><span class="bu">help</span>(arma_mod11fit.forecast)</span></code></pre></div>
<pre><code>Help on method forecast in module statsmodels.tsa.arima_model:

forecast(steps=1, exog=None, alpha=0.05) method of statsmodels.tsa.arima_model.ARMAResults instance
    Out-of-sample forecasts
    
    Parameters
    ----------
    steps : int
        The number of out of sample forecasts from the end of the
        sample.
    exog : array
        If the model is an ARMAX, you must provide out of sample
        values for the exogenous variables. This should not include
        the constant.
    alpha : float
        The confidence intervals for the forecasts are (1 - alpha) %
    
    Returns
    -------
    forecast : array
        Array of out of sample forecasts
    stderr : array
        Array of the standard error of the forecasts.
    conf_int : array
        2d array of the confidence interval for the forecast</code></pre>
<div class="sourceCode" id="cb605"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb605-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb605-1" tabindex="-1"></a><span class="bu">help</span>(arma_mod11fit.predict)</span></code></pre></div>
<pre><code>Help on method predict in module statsmodels.tsa.arima_model:

predict(start=None, end=None, exog=None, dynamic=False) method of statsmodels.tsa.arima_model.ARMAResultsWrapper instance
    predict(self, start=None, end=None, exog=None, dynamic=False)
    
    ARMA model in-sample and out-of-sample prediction
    
    Parameters
    ----------
    
    start : int, str, or datetime
        Zero-indexed observation number at which to start forecasting, ie.,
        the first forecast is start. Can also be a date string to
        parse or a datetime type.
    end : int, str, or datetime
        Zero-indexed observation number at which to end forecasting, ie.,
        the first forecast is start. Can also be a date string to
        parse or a datetime type. However, if the dates index does not
        have a fixed frequency, end must be an integer index if you
        want out of sample prediction.
    exog : array-like, optional
        If the model is an ARMAX and out-of-sample forecasting is
        requested, exog must be given. Note that you'll need to pass
        `k_ar` additional lags for any exogenous variables. E.g., if you
        fit an ARMAX(2, q) model and want to predict 5 steps, you need 7
        observations to do this.
    dynamic : bool, optional
        The `dynamic` keyword affects in-sample prediction. If dynamic
        is False, then the in-sample lagged values are used for
        prediction. If `dynamic` is True, then in-sample forecasts are
        used in place of lagged dependent variables. The first forecasted
        value is `start`.

    Returns
    -------
    predict : array
        The predicted values.

    Notes
    -----
    It is recommended to use dates with the time-series models, as the
    below will probably make clear. However, if ARIMA is used without
    dates and/or `start` and `end` are given as indices, then these
    indices are in terms of the *original*, undifferenced series. Ie.,
    given some undifferenced observations::
    
     1970Q1, 1
     1970Q2, 1.5
     1970Q3, 1.25
     1970Q4, 2.25
     1971Q1, 1.2
     1971Q2, 4.1
    
    1970Q1 is observation 0 in the original series. However, if we fit an
    ARIMA(p,1,q) model then we lose this first observation through
    differencing. Therefore, the first observation we can forecast (if
    using exact MLE) is index 1. In the differenced series this is index
    0, but we refer to it as 1 from the original series.</code></pre>
</div>
<div id="生成相应系数的arma模型以及样本" class="section level4" number="10.2.3.7">
<h4>
<span class="header-section-number">10.2.3.7</span> 生成相应系数的arma模型以及样本<a class="anchor" aria-label="anchor" href="#%E7%94%9F%E6%88%90%E7%9B%B8%E5%BA%94%E7%B3%BB%E6%95%B0%E7%9A%84arma%E6%A8%A1%E5%9E%8B%E4%BB%A5%E5%8F%8A%E6%A0%B7%E6%9C%AC"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb607"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb607-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb607-1" tabindex="-1"></a><span class="co">## 利用from statsmodels.tsa.arima_process import ArmaProcess</span></span>
<span id="cb607-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb607-2" tabindex="-1"></a></span>
<span id="cb607-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb607-3" tabindex="-1"></a>arpar<span class="op">=</span>np.r_[<span class="dv">1</span>,<span class="op">-</span>arma_mod11fit.arparams]<span class="co">#注意负号</span></span>
<span id="cb607-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb607-4" tabindex="-1"></a>maapr<span class="op">=</span>np.r_[<span class="dv">1</span>,arma_mod11fit.maparams]</span>
<span id="cb607-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb607-5" tabindex="-1"></a>arma_t<span class="op">=</span>ArmaProcess(arpar,maapr)</span>
<span id="cb607-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb607-6" tabindex="-1"></a>arma_t.generate_sample(<span class="dv">50</span>)<span class="co">#生成样本数</span></span></code></pre></div>
<pre><code>array([ 0.84100879, -1.11466772, -1.69619658, -0.89732715, -1.24949787,
       -0.9429691 , -0.36605419, -0.49423353,  0.17072922,  1.44030944,
       -0.45314823, -0.0211145 ,  0.32116309, -0.07627831,  1.06153154,
       -1.97036659,  1.44268116, -0.83143763,  0.02046505,  0.62915108,
       -0.57072571,  0.33114286,  0.77741837,  0.86158753, -0.43930777,
        2.04760704,  1.05056826, -0.37918406,  0.82059652,  0.44502154,
        0.81677717, -3.08796419,  0.31299866, -0.16455348, -0.03883496,
       -0.53423336,  0.5115214 ,  1.07455292,  0.73309407,  1.88259081,
        1.0354387 ,  0.42521786, -0.49991477, -0.55091025,  0.61444634,
        0.07167267, -0.24943137,  0.47172613, -0.90796036, -0.79903477])</code></pre>
<div class="sourceCode" id="cb609"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb609-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb609-1" tabindex="-1"></a><span class="bu">dir</span>(arma_t)</span></code></pre></div>
<pre><code>['__class__',
 '__delattr__',
 '__dict__',
 '__dir__',
 '__doc__',
 '__eq__',
 '__format__',
 '__ge__',
 '__getattribute__',
 '__gt__',
 '__hash__',
 '__init__',
 '__init_subclass__',
 '__le__',
 '__lt__',
 '__module__',
 '__mul__',
 '__ne__',
 '__new__',
 '__reduce__',
 '__reduce_ex__',
 '__repr__',
 '__setattr__',
 '__sizeof__',
 '__str__',
 '__subclasshook__',
 '__weakref__',
 'acf',
 'acovf',
 'ar',
 'arcoefs',
 'arma2ar',
 'arma2ma',
 'arpoly',
 'arroots',
 'from_coeffs',
 'from_estimation',
 'generate_sample',
 'impulse_response',
 'invertroots',
 'isinvertible',
 'isstationary',
 'ma',
 'macoefs',
 'mapoly',
 'maroots',
 'nobs',
 'pacf',
 'periodogram']</code></pre>
<p>生成相应模型后，可以计算模型的自相关，偏自相关，自协方差函数等</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb611-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb611-1" tabindex="-1"></a>arma_t.acf(<span class="dv">12</span>)</span>
<span id="cb611-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb611-2" tabindex="-1"></a>arma_t.pacf(<span class="dv">12</span>)</span>
<span id="cb611-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb611-3" tabindex="-1"></a>arma_t.acovf(<span class="dv">12</span>)</span></code></pre></div>
<pre><code>array([1.        , 0.53937576, 0.44802054, 0.37213835, 0.30910848,
       0.25675412, 0.21326713, 0.17714562, 0.14714209, 0.12222032,
       0.1015196 , 0.08432501])

array([1.00000000e+00, 5.39375760e-01, 2.21548631e-01, 9.56983544e-02,
       4.17191583e-02, 1.82189418e-02, 7.95893463e-03, 3.47707644e-03,
       1.51907351e-03, 6.63658016e-04, 2.89941305e-04, 1.26670613e-04])

array([1.50001883, 0.8090738 , 0.67203925, 0.55821453, 0.46366854,
       0.38513601, 0.31990471, 0.26572176, 0.2207159 , 0.18333278,
       0.15228132, 0.12648911])</code></pre>
<div class="sourceCode" id="cb613"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb613-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb613-1" tabindex="-1"></a><span class="co">## 利用arma_generate_sample()</span></span>
<span id="cb613-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb613-2" tabindex="-1"></a></span>
<span id="cb613-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb613-3" tabindex="-1"></a>sm.tsa.arma_generate_sample(arpar,maapr,<span class="dv">50</span>)</span></code></pre></div>
<pre><code>array([ 0.29120536,  0.68119412,  0.82190127,  0.74797878,  0.98093912,
        1.96669932,  0.25680721,  0.08654568,  1.50093088, -0.56938977,
        0.96221975, -1.29394972, -0.77817225,  0.29972415, -0.28227105,
       -0.32754268,  0.48817939, -1.71037106, -0.57913776, -0.10676858,
       -0.509618  , -0.93247366, -1.18755667, -0.25181921, -2.10277464,
       -0.60889419, -1.15709421, -1.05072217, -0.0480205 ,  0.33550013,
        0.22174955,  0.23075989,  0.94173438,  2.31921265,  1.73878118,
        0.20280618, -1.49651451,  1.59821857, -1.25111724,  0.9293164 ,
        1.04055467,  0.13611643,  0.98155745, -0.34197525,  1.26426066,
        0.01166392,  0.93966998,  1.45848901,  0.65975754,  2.96696278])</code></pre>
<div class="sourceCode" id="cb615"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb615-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-1" tabindex="-1"></a><span class="co">#验证一下确实是模型的自相关，偏自相关</span></span>
<span id="cb615-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-2" tabindex="-1"></a><span class="co"># 生成一个平稳arma(1,0)模型</span></span>
<span id="cb615-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-3" tabindex="-1"></a>ar1<span class="op">=</span>np.array([<span class="dv">1</span>,<span class="fl">0.8</span>])</span>
<span id="cb615-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-4" tabindex="-1"></a>ma1<span class="op">=</span>np.array([<span class="dv">1</span>])</span>
<span id="cb615-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-5" tabindex="-1"></a>arma20<span class="op">=</span>ArmaProcess(ar1,ma1)</span>
<span id="cb615-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-6" tabindex="-1"></a>arma20.acf(<span class="dv">12</span>)<span class="co">#ar（1）模型的k阶自相关应该是系数的k次方</span></span>
<span id="cb615-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-7" tabindex="-1"></a>arma20.pacf(<span class="dv">12</span>)<span class="co">#除了1阶为系数，其他皆为0</span></span>
<span id="cb615-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-8" tabindex="-1"></a>np.array([<span class="fl">0.8</span><span class="op">**</span>i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)])</span>
<span id="cb615-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb615-9" tabindex="-1"></a><span class="co">#验证是通过的</span></span></code></pre></div>
<pre><code>array([ 1.        , -0.8       ,  0.64      , -0.512     ,  0.4096    ,
       -0.32768   ,  0.262144  , -0.2097152 ,  0.16777216, -0.13421773,
        0.10737418, -0.08589935])

array([ 1.00000000e+00, -8.00000000e-01, -3.45402719e-16, -6.16790569e-17,
        4.31753398e-17, -3.25171988e-17, -1.04854397e-16,  7.70988212e-17,
        1.23358114e-17, -4.62592927e-17, -1.38777878e-17,  1.07938350e-17])

array([1.        , 0.8       , 0.64      , 0.512     , 0.4096    ,
       0.32768   , 0.262144  , 0.2097152 , 0.16777216, 0.13421773,
       0.10737418, 0.08589935])</code></pre>
</div>
<div id="模型定阶的简便方法" class="section level4" number="10.2.3.8">
<h4>
<span class="header-section-number">10.2.3.8</span> 模型定阶的简便方法<a class="anchor" aria-label="anchor" href="#%E6%A8%A1%E5%9E%8B%E5%AE%9A%E9%98%B6%E7%9A%84%E7%AE%80%E4%BE%BF%E6%96%B9%E6%B3%95"><i class="fas fa-link"></i></a>
</h4>
<p>设置最大和最小AR、MA阶数，给与data和信息准则，信息准则可以是一个字符串或一个列表，同时可以选择是否中心化。检测后，可以利用.aic_min_order或.bic_min_order等你选择的最小准则选择最佳的模型，并且模型一定是平稳和可逆的。不满足的无值</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb617-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb617-1" tabindex="-1"></a><span class="bu">help</span>(sm.tsa.arma_order_select_ic)</span></code></pre></div>
<pre><code>Help on function arma_order_select_ic in module statsmodels.tsa.stattools:

arma_order_select_ic(y, max_ar=4, max_ma=2, ic='bic', trend='c', model_kw=None, fit_kw=None)
    Returns information criteria for many ARMA models
    
    Parameters
    ----------
    y : array-like
        Time-series data
    max_ar : int
        Maximum number of AR lags to use. Default 4.
    max_ma : int
        Maximum number of MA lags to use. Default 2.
    ic : str, list
        Information criteria to report. Either a single string or a list
        of different criteria is possible.
    trend : str
        The trend to use when fitting the ARMA models.
    model_kw : dict
        Keyword arguments to be passed to the ``ARMA`` model
    fit_kw : dict
        Keyword arguments to be passed to ``ARMA.fit``.
    
    Returns
    -------
    obj : Results object
        Each ic is an attribute with a DataFrame for the results. The AR order
        used is the row index. The ma order used is the column index. The
        minimum orders are available as ``ic_min_order``.
    
    Examples
    --------
    
    &gt;&gt;&gt; from statsmodels.tsa.arima_process import arma_generate_sample
    &gt;&gt;&gt; import statsmodels.api as sm
    &gt;&gt;&gt; import numpy as np
    
    &gt;&gt;&gt; arparams = np.array([.75, -.25])
    &gt;&gt;&gt; maparams = np.array([.65, .35])
    &gt;&gt;&gt; arparams = np.r_[1, -arparams]
    &gt;&gt;&gt; maparam = np.r_[1, maparams]
    &gt;&gt;&gt; nobs = 250
    &gt;&gt;&gt; np.random.seed(2014)
    &gt;&gt;&gt; y = arma_generate_sample(arparams, maparams, nobs)
    &gt;&gt;&gt; res = sm.tsa.arma_order_select_ic(y, ic=['aic', 'bic'], trend='nc')
    &gt;&gt;&gt; res.aic_min_order
    &gt;&gt;&gt; res.bic_min_order
    
    Notes
    -----
    This method can be used to tentatively identify the order of an ARMA
    process, provided that the time series is stationary and invertible. This
    function computes the full exact MLE estimate of each model and can be,
    therefore a little slow. An implementation using approximate estimates
    will be provided in the future. In the meantime, consider passing
    {method : 'css'} to fit_kw.</code></pre>
<div class="sourceCode" id="cb619"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb619-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb619-1" tabindex="-1"></a>mod_ch<span class="op">=</span>sm.tsa.arma_order_select_ic(data,<span class="dv">4</span>,<span class="dv">4</span>,[<span class="st">'aic'</span>,<span class="st">'bic'</span>],trend<span class="op">=</span><span class="st">'nc'</span>)</span>
<span id="cb619-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb619-2" tabindex="-1"></a>mod_ch</span></code></pre></div>
<pre><code>{'aic':             0           1           2           3           4
 0         NaN  799.674173  761.067479  738.361676  715.759799
 1  666.645525  647.132300  648.738566  649.986452  651.941850
 2  656.028374  648.842840  648.850644  650.846599  652.699837
 3  649.748166  650.009945  652.004944         NaN  654.552222
 4  650.228277  652.004611         NaN  651.799867  654.256041,
 'bic':             0           1           2           3           4
 0         NaN  804.864412  768.852838  748.742155  728.735398
 1  671.835765  654.917660  659.119046  662.962051  667.512569
 2  663.813734  659.223319  661.826244  666.417318  670.865676
 3  660.128646  662.985544  667.575663         NaN  675.313181
 4  663.203877  667.575330         NaN  672.560826  677.612119,
 'aic_min_order': (1, 1),
 'bic_min_order': (1, 1)}</code></pre>
<div class="sourceCode" id="cb621"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb621-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb621-1" tabindex="-1"></a><span class="bu">dir</span>(mod_ch)</span></code></pre></div>
<pre><code>['__class__',
 '__contains__',
 '__delattr__',
 '__delitem__',
 '__dict__',
 '__dir__',
 '__doc__',
 '__eq__',
 '__format__',
 '__ge__',
 '__getattribute__',
 '__getitem__',
 '__gt__',
 '__hash__',
 '__init__',
 '__init_subclass__',
 '__iter__',
 '__le__',
 '__len__',
 '__lt__',
 '__module__',
 '__ne__',
 '__new__',
 '__reduce__',
 '__reduce_ex__',
 '__repr__',
 '__setattr__',
 '__setitem__',
 '__sizeof__',
 '__str__',
 '__subclasshook__',
 '__weakref__',
 'aic',
 'aic_min_order',
 'bic',
 'bic_min_order',
 'clear',
 'copy',
 'fromkeys',
 'get',
 'items',
 'keys',
 'pop',
 'popitem',
 'setdefault',
 'update',
 'values']</code></pre>
<div class="sourceCode" id="cb623"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb623-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb623-1" tabindex="-1"></a>mod_ch.keys()</span></code></pre></div>
<pre><code>dict_keys(['aic', 'bic', 'aic_min_order', 'bic_min_order'])</code></pre>
</div>
</div>
<div id="模型总结" class="section level3" number="10.2.4">
<h3>
<span class="header-section-number">10.2.4</span> 模型总结<a class="anchor" aria-label="anchor" href="#%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93"><i class="fas fa-link"></i></a>
</h3>
<p>sm.tsa=tsa</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="20%">
<col width="40%">
<col width="40%">
</colgroup>
<thead><tr class="header">
<th>步骤</th>
<th align="left">方法</th>
<th align="left">解释</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>模型定阶</td>
<td align="left"><code>sm.tsa.arma_order_select_ic(data,max_ar,max_ma,ic,trend,model_kw,fit_kw)</code></td>
<td align="left">
<a href="data:%E6%95%B0%E6%8D%AE" class="uri">data:数据</a><br>max_ar,max_ma:最大的阶数<br>ic:字符串或者列表,指定信息准则<br>trend:‘c’or‘nc’,是否中心化<br>model_kw,fit_kw:arma以及arma.fit的参数</td>
</tr>
<tr class="even">
<td>模型构建</td>
<td align="left">按照数据和阶数构建：<br><code>arma_mod=sm.tsa.ARMA(data)</code><br><code>arma_modfit=arma_mod.fit(disp=-1,trend='c')</code>
</td>
<td align="left">arma_mod的参数一般只需要输入data，序列或数据框，索引为时间类型。<br>fit的时候可以选择计算方法，是否包含常数项等.<br>通过summary方法可以看到模型的信息量，参数的检验结果，系数，系数多项式的根。<br>还有其他属性可以获得参数值，ar或ma参数，ar或ma的根，信息量，残差等。<br>但是无法计算模型的协方差等信息</td>
</tr>
<tr class="odd">
<td>-</td>
<td align="left">按照ar和ma的系数构建，注意即延迟算子形式的系数<br><code>from sm.tsa.arima_process import ArmaProcess</code><br><code>ArmaProcess(ar,ma)</code>
</td>
<td align="left">ar:ar的所有系数<br>ma:ma的所有系数<br>此模型也可以获得ar，ma等系数，根<br>同时还可以获取<strong>模型的自协方差，自相关系数等</strong><br>同时还可以检验模型的可逆性和稳定性<br>同时还可以获得模型的逆转形式的系数多项式的根</td>
</tr>
<tr class="even">
<td>生成相应模型样本（非必要步骤）</td>
<td align="left">
<code>sm.tsa.arma.generate_sample(ar,ma,nobs)</code>或<br><code>AramaProcess(ar,ma).generate_sample(nsample)</code>
</td>
<td align="left">可以直接调用函数，也可以通过先生成模型再进行生成样本</td>
</tr>
<tr class="odd">
<td>检验模型</td>
<td align="left">模型的显著性检验:<code>r,q,p = sm.tsa.acf(resid, fft=True, qstat=True)</code>默认nlags40<br>残差的相关性检验：<code>sm.stats.durbin_watson(arma_mod11fit.resid.values)</code><br>残差的正态性检验:<code>scipy.stats.normaltest(resid)</code><br>模型的参数检验：在生成模型的时候就已经可以判断，如果有参数被舍弃，则应重新建模</td>
<td align="left">r,q,p代表自相关值，q统计量值，p值，判断残差随机性<br>dw检验也检验残差的相关性<br>正态检验还可以通过<code>statsmodels.graphics.api.qqplot(resid, line='q', ax=ax, fit=True)</code>判断拟合效果</td>
</tr>
<tr class="even">
<td>模型预测</td>
<td align="left"><code>.predict(开始时间,结束时间)</code></td>
<td align="left">注意不要设置dynamic=True，否则预测值会近似一条直线<br>可以将预测值和样本值放在一起比较结果</td>
</tr>
</tbody>
</table></div>
</div>
<div id="非平稳时间序列" class="section level3" number="10.2.5">
<h3>
<span class="header-section-number">10.2.5</span> 非平稳时间序列<a class="anchor" aria-label="anchor" href="#%E9%9D%9E%E5%B9%B3%E7%A8%B3%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><i class="fas fa-link"></i></a>
</h3>
<p>cramer分解定理证明任何一个序列都可以视为同时受到确定性影响和随机性影响的作用，对于非平稳时间序列，这两方面至少有一个方面是不平稳的。</p>
</div>
<div id="arima-非平稳无季节效应时间序列" class="section level3 tabset" number="10.2.6">
<h3>
<span class="header-section-number">10.2.6</span> ARIMA 非平稳无季节效应时间序列<a class="anchor" aria-label="anchor" href="#arima-%E9%9D%9E%E5%B9%B3%E7%A8%B3%E6%97%A0%E5%AD%A3%E8%8A%82%E6%95%88%E5%BA%94%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><i class="fas fa-link"></i></a>
</h3>
<p>当时间序列非平稳但是不存在其他诸如季节效应的随机影响时，一般只需要做差分就可以获得平稳序列。可能是一阶，二阶，并且可以证明d阶差分后一定是平稳的，但是差分阶数越高，方差越大，所以我们要选择合适的差分阶数。避免出现过差分现象</p>
<p>其实差分就是自回归，一个差分可以写成自回归的形式，就是用自回归来提取序列中蕴含的确定性信息</p>
<p><strong>对蕴含固定周期的序列进行步长为周期长度的差分运算，(k步差分)通常可以可以很好的提取周期信息</strong>，这和有季节因素的非平稳序列比较有关系</p>
<p>ARIMA（p，d，q）p，q和ARMA模型一致，d代表做几阶差分。当p=q=0，d=0时，<span class="math inline">\(x_t=x_{t-1}+\epsilon\)</span>,称为随机游走模型或醉汉模型</p>
<pre><code>arima_mod=tsa.SARIMAX(data,order=(p,d,q))
arima_modpdq=arima_modpdq.fit(disp=-1)</code></pre>
<div id="数据是否平稳" class="section level4" number="10.2.6.1">
<h4>
<span class="header-section-number">10.2.6.1</span> 数据是否平稳<a class="anchor" aria-label="anchor" href="#%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E5%B9%B3%E7%A8%B3"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb626"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb626-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb626-1" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb626-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb626-2" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> BytesIO</span>
<span id="cb626-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb626-3" tabindex="-1"></a>wpi1 <span class="op">=</span> requests.get(<span class="st">'https://www.stata-press.com/data/r12/wpi1.dta'</span>).content</span>
<span id="cb626-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb626-4" tabindex="-1"></a>data <span class="op">=</span> pd.read_stata(BytesIO(wpi1))</span>
<span id="cb626-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb626-5" tabindex="-1"></a>data.index <span class="op">=</span> data.t</span></code></pre></div>
<div class="sourceCode" id="cb627"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb627-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb627-1" tabindex="-1"></a>data</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
wpi
</th>
<th>
t
</th>
<th>
ln_wpi
</th>
</tr>
<tr>
<th>
t
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
1960-01-01
</td>
<td>
30.700001
</td>
<td>
1960-01-01
</td>
<td>
3.424263
</td>
</tr>
<tr>
<td>
1960-04-01
</td>
<td>
30.799999
</td>
<td>
1960-04-01
</td>
<td>
3.427515
</td>
</tr>
<tr>
<td>
1960-07-01
</td>
<td>
30.700001
</td>
<td>
1960-07-01
</td>
<td>
3.424263
</td>
</tr>
<tr>
<td>
1960-10-01
</td>
<td>
30.700001
</td>
<td>
1960-10-01
</td>
<td>
3.424263
</td>
</tr>
<tr>
<td>
1961-01-01
</td>
<td>
30.799999
</td>
<td>
1961-01-01
</td>
<td>
3.427515
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<td>
1989-10-01
</td>
<td>
109.400002
</td>
<td>
1989-10-01
</td>
<td>
4.695011
</td>
</tr>
<tr>
<td>
1990-01-01
</td>
<td>
111.000000
</td>
<td>
1990-01-01
</td>
<td>
4.709530
</td>
</tr>
<tr>
<td>
1990-04-01
</td>
<td>
110.800003
</td>
<td>
1990-04-01
</td>
<td>
4.707727
</td>
</tr>
<tr>
<td>
1990-07-01
</td>
<td>
112.800003
</td>
<td>
1990-07-01
</td>
<td>
4.725616
</td>
</tr>
<tr>
<td>
1990-10-01
</td>
<td>
116.199997
</td>
<td>
1990-10-01
</td>
<td>
4.755313
</td>
</tr>
</tbody>
</table></div>
<p>
124 rows × 3 columns
</p>
</div>
<div class="sourceCode" id="cb628"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb628-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb628-1" tabindex="-1"></a>plt.plot(data.wpi)</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dd8d7848&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_82_1.png"></div>
<p>可以判断大致应该是做一阶差分</p>
</div>
<div id="差分并做单位根检验" class="section level4" number="10.2.6.2">
<h4>
<span class="header-section-number">10.2.6.2</span> 差分并做单位根检验<a class="anchor" aria-label="anchor" href="#%E5%B7%AE%E5%88%86%E5%B9%B6%E5%81%9A%E5%8D%95%E4%BD%8D%E6%A0%B9%E6%A3%80%E9%AA%8C"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb630"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb630-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb630-1" tabindex="-1"></a><span class="kw">def</span> select_arima_orderd_adf(data,maxlag):</span>
<span id="cb630-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb630-2" tabindex="-1"></a>    results<span class="op">=</span>[tsa.adfuller(data.diff(i).dropna())[<span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,maxlag<span class="op">+</span><span class="dv">1</span>)]</span>
<span id="cb630-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb630-3" tabindex="-1"></a>    results<span class="op">=</span>pd.DataFrame(results,index<span class="op">=</span><span class="bu">range</span>(<span class="dv">1</span>,maxlag<span class="op">+</span><span class="dv">1</span>),columns<span class="op">=</span>[<span class="st">'p值'</span>])</span>
<span id="cb630-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb630-4" tabindex="-1"></a>    results._set_axis_name(<span class="st">'差分阶数'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb630-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb630-5" tabindex="-1"></a>    <span class="cf">return</span> results</span></code></pre></div>
<div class="sourceCode" id="cb631"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb631-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb631-1" tabindex="-1"></a>select_arima_orderd_adf(data.wpi,<span class="dv">5</span>)</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
p值
</th>
</tr>
<tr>
<th>
差分阶数
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
0.098945
</td>
</tr>
<tr>
<td>
2
</td>
<td>
0.121322
</td>
</tr>
<tr>
<td>
3
</td>
<td>
0.069117
</td>
</tr>
<tr>
<td>
4
</td>
<td>
0.359309
</td>
</tr>
<tr>
<td>
5
</td>
<td>
0.122730
</td>
</tr>
</tbody>
</table></div>
</div>
<p>这里其实全部都没有通过0.05的检验，那我们就取0.1为标准，所以一阶差分就可</p>
</div>
<div id="构建arima模型" class="section level4" number="10.2.6.3">
<h4>
<span class="header-section-number">10.2.6.3</span> 构建ARIMA模型<a class="anchor" aria-label="anchor" href="#%E6%9E%84%E5%BB%BAarima%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb632"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb632-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb632-1" tabindex="-1"></a><span class="co">#首先获取差分数据</span></span>
<span id="cb632-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb632-2" tabindex="-1"></a>data[<span class="st">'d1wpi'</span>]<span class="op">=</span>data[<span class="st">'wpi'</span>].diff()</span>
<span id="cb632-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb632-3" tabindex="-1"></a><span class="co">#绘制相关图。判断p，q</span></span>
<span id="cb632-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb632-4" tabindex="-1"></a>fig<span class="op">=</span>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb632-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb632-5" tabindex="-1"></a>ax1<span class="op">=</span>plt.subplot(<span class="dv">211</span>)<span class="op">;</span>plot_acf(data.d1wpi.dropna(),ax<span class="op">=</span>ax1).show()</span>
<span id="cb632-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb632-6" tabindex="-1"></a>ax2<span class="op">=</span>plt.subplot(<span class="dv">212</span>)<span class="op">;</span>plot_pacf(data.d1wpi.dropna(),ax<span class="op">=</span>ax2).show()</span></code></pre></div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_89_0.png"></div>
<p>根据自相关图和偏相关图，我们也可以判断是否适合用疏系数模型</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb633-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb633-1" tabindex="-1"></a><span class="co">#使用模型定阶的函数</span></span>
<span id="cb633-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb633-2" tabindex="-1"></a>tsa.arma_order_select_ic(data.d1wpi.dropna(),<span class="dv">4</span>,<span class="dv">4</span>,[<span class="st">'aic'</span>,<span class="st">'bic'</span>],trend<span class="op">=</span><span class="st">'c'</span>)</span></code></pre></div>
<pre><code>{'aic':             0           1           2           3           4
 0  347.072562  307.552197  299.357225  293.948300  285.064261
 1  283.806987  278.702628  280.105905  280.726991  281.041604
 2  281.855956  280.368858  281.696667  279.304674  280.894012
 3  278.371786  280.281285         NaN  304.722568  279.878126
 4  280.205568  279.706951  279.272632  280.581639  281.139270,
 'bic':             0           1           2           3           4
 0  352.696930  315.988750  310.605962  308.009222  301.937367
 1  292.243540  289.951365  294.166827  297.600097  300.726894
 2  293.104694  294.429780  298.569774  298.989965  303.391487
 3  292.432708  297.154391         NaN  327.220043  305.187785
 4  297.078674  299.392241  301.770106  305.891298  309.261113,
 'aic_min_order': (3, 0),
 'bic_min_order': (1, 1)}</code></pre>
<p>使用bic准则我们p=1，q=1</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb635-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb635-1" tabindex="-1"></a><span class="co">#构建模型</span></span>
<span id="cb635-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb635-2" tabindex="-1"></a>arima_mod111<span class="op">=</span>tsa.SARIMAX(data[<span class="st">'wpi'</span>],order<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),trend<span class="op">=</span><span class="st">'c'</span>)</span>
<span id="cb635-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb635-3" tabindex="-1"></a>arima_mod111fit<span class="op">=</span>arima_mod111.fit(disp<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb635-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb635-4" tabindex="-1"></a>arima_mod111fit.summary()</span></code></pre></div>
</div>
<div id="检验-1" class="section level4" number="10.2.6.4">
<h4>
<span class="header-section-number">10.2.6.4</span> 检验<a class="anchor" aria-label="anchor" href="#%E6%A3%80%E9%AA%8C-1"><i class="fas fa-link"></i></a>
</h4>
</div>
<div id="预测-1" class="section level4" number="10.2.6.5">
<h4>
<span class="header-section-number">10.2.6.5</span> 预测<a class="anchor" aria-label="anchor" href="#%E9%A2%84%E6%B5%8B-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb636"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb636-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb636-1" tabindex="-1"></a>arima_mod111fit.predict(<span class="st">'1960-01-01'</span>,<span class="st">'1991-01-01'</span>)</span></code></pre></div>
<pre><code>1960-01-01      0.749786
1960-04-01     31.449807
1960-07-01     31.122188
1960-10-01     30.867851
1961-01-01     30.862600
                 ...    
1990-01-01    109.912121
1990-04-01    112.044809
1990-07-01    111.232380
1990-10-01    113.996828
1991-01-01    118.358861
Freq: QS-OCT, Length: 125, dtype: float64</code></pre>
<div class="sourceCode" id="cb638"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb638-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb638-1" tabindex="-1"></a>arima_mod111fit.get_prediction()</span>
<span id="cb638-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb638-2" tabindex="-1"></a>arima_mod111fit.get_prediction().conf_int()</span></code></pre></div>
<pre><code>&lt;statsmodels.tsa.statespace.mlemodel.PredictionResultsWrapper at 0x168debe0c48&gt;</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
lower wpi
</th>
<th>
upper wpi
</th>
</tr></thead>
<tbody>
<tr>
<td>
1960-01-01
</td>
<td>
-1959.215181
</td>
<td>
1960.714753
</td>
</tr>
<tr>
<td>
1960-04-01
</td>
<td>
29.487836
</td>
<td>
33.411777
</td>
</tr>
<tr>
<td>
1960-07-01
</td>
<td>
29.644898
</td>
<td>
32.599478
</td>
</tr>
<tr>
<td>
1960-10-01
</td>
<td>
29.437815
</td>
<td>
32.297886
</td>
</tr>
<tr>
<td>
1961-01-01
</td>
<td>
29.440036
</td>
<td>
32.285163
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<td>
1989-10-01
</td>
<td>
108.144279
</td>
<td>
110.986387
</td>
</tr>
<tr>
<td>
1990-01-01
</td>
<td>
108.491066
</td>
<td>
111.333175
</td>
</tr>
<tr>
<td>
1990-04-01
</td>
<td>
110.623755
</td>
<td>
113.465863
</td>
</tr>
<tr>
<td>
1990-07-01
</td>
<td>
109.811325
</td>
<td>
112.653434
</td>
</tr>
<tr>
<td>
1990-10-01
</td>
<td>
112.575774
</td>
<td>
115.417882
</td>
</tr>
</tbody>
</table></div>
<p>
124 rows × 2 columns
</p>
</div>
<div class="sourceCode" id="cb640"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb640-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb640-1" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb640-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb640-2" tabindex="-1"></a>ax.plot(data.wpi,<span class="st">'k'</span>,label<span class="op">=</span><span class="st">'raw'</span>)</span>
<span id="cb640-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb640-3" tabindex="-1"></a>ax.plot(arima_mod111fit.predict(),<span class="st">'r--'</span>,label<span class="op">=</span><span class="st">'predict'</span>)</span>
<span id="cb640-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb640-4" tabindex="-1"></a>ci<span class="op">=</span>arima_mod111fit.get_prediction().conf_int().iloc[<span class="dv">1</span>:,]</span>
<span id="cb640-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb640-5" tabindex="-1"></a>l,r<span class="op">=</span>ci.iloc[:,<span class="dv">0</span>],ci.iloc[:,<span class="dv">1</span>]</span>
<span id="cb640-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb640-6" tabindex="-1"></a>ax.fill_between(ci.index,l,r,alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb640-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb640-7" tabindex="-1"></a>ax.legend()</span>
<span id="cb640-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb640-8" tabindex="-1"></a>plt.show()</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168de9d5c88&gt;]

[&lt;matplotlib.lines.Line2D at 0x168de9f0508&gt;]

&lt;matplotlib.collections.PolyCollection at 0x168debee508&gt;

&lt;matplotlib.legend.Legend at 0x168de9f59c8&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_97_4.png"></div>
</div>
</div>
<div id="有季节效应的非平稳模型" class="section level3 tabset" number="10.2.7">
<h3>
<span class="header-section-number">10.2.7</span> 有季节效应的非平稳模型<a class="anchor" aria-label="anchor" href="#%E6%9C%89%E5%AD%A3%E8%8A%82%E6%95%88%E5%BA%94%E7%9A%84%E9%9D%9E%E5%B9%B3%E7%A8%B3%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>直接差分，先消掉趋势。再按照周期来构建<strong>疏系数模型</strong>，季度数据，月度数据周期是一年</li>
<li>arima加法和乘法模型</li>
<li>x11季节调节模型</li>
<li>指数平滑模型</li>
</ol>
<div class="sourceCode" id="cb642"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb642-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb642-1" tabindex="-1"></a><span class="co"># Dataset</span></span>
<span id="cb642-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb642-2" tabindex="-1"></a>data <span class="op">=</span> pd.read_stata(BytesIO(wpi1))</span>
<span id="cb642-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb642-3" tabindex="-1"></a>data.index <span class="op">=</span> data.t</span>
<span id="cb642-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb642-4" tabindex="-1"></a>data[<span class="st">'ln_wpi'</span>] <span class="op">=</span> np.log(data[<span class="st">'wpi'</span>])</span>
<span id="cb642-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb642-5" tabindex="-1"></a>data[<span class="st">'D.ln_wpi'</span>] <span class="op">=</span> data[<span class="st">'ln_wpi'</span>].diff()<span class="co">#注意这里的时间之间差值是三个月，也就是季度数据，那我们在构建时只需构建滞后四期</span></span></code></pre></div>
<div class="sourceCode" id="cb643"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb643-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb643-1" tabindex="-1"></a>fig<span class="op">=</span>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">10</span>))</span>
<span id="cb643-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb643-2" tabindex="-1"></a>ax1<span class="op">=</span>plt.subplot(<span class="dv">211</span>)<span class="op">;</span>ax1.plot(data.ln_wpi)</span>
<span id="cb643-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb643-3" tabindex="-1"></a>ax2<span class="op">=</span>plt.subplot(<span class="dv">212</span>)<span class="op">;</span>ax2.plot(data[<span class="st">'D.ln_wpi'</span>])</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dee1dc88&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dee32c88&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_103_2.png"></div>
<div id="第一种模型构建" class="section level4" number="10.2.7.1">
<h4>
<span class="header-section-number">10.2.7.1</span> 第一种模型构建<a class="anchor" aria-label="anchor" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb645"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb645-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb645-1" tabindex="-1"></a>ar <span class="op">=</span> <span class="dv">1</span>          <span class="co"># this is the maximum degree specification</span></span>
<span id="cb645-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb645-2" tabindex="-1"></a>ma <span class="op">=</span> (<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)  <span class="co"># this is the lag polynomial specification</span></span>
<span id="cb645-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb645-3" tabindex="-1"></a>mod <span class="op">=</span> tsa.SARIMAX(data[<span class="st">'wpi'</span>], trend<span class="op">=</span><span class="st">'c'</span>, order<span class="op">=</span>(ar,<span class="dv">1</span>,ma))<span class="co">#这里把关于时间t的函数就设置为常数c</span></span>
<span id="cb645-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb645-4" tabindex="-1"></a>modfit<span class="op">=</span>mod.fit(disp<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb645-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb645-5" tabindex="-1"></a>modfit.summary()<span class="co">#应为该序列并没有季节效应，四阶滞后参数检验不通过</span></span></code></pre></div>
<div class="sourceCode" id="cb646"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb646-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb646-1" tabindex="-1"></a>data<span class="op">=</span>pd.read_excel(<span class="st">'./习题与案例数据/案例数据/A1_21.xlsx'</span>,index_col<span class="op">=</span><span class="st">'time'</span>)</span>
<span id="cb646-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb646-2" tabindex="-1"></a>data</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
x
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
1948-01-01
</td>
<td>
446
</td>
</tr>
<tr>
<td>
1948-02-01
</td>
<td>
650
</td>
</tr>
<tr>
<td>
1948-03-01
</td>
<td>
592
</td>
</tr>
<tr>
<td>
1948-04-01
</td>
<td>
561
</td>
</tr>
<tr>
<td>
1948-05-01
</td>
<td>
491
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<td>
1981-08-01
</td>
<td>
2975
</td>
</tr>
<tr>
<td>
1981-09-01
</td>
<td>
3064
</td>
</tr>
<tr>
<td>
1981-10-01
</td>
<td>
3092
</td>
</tr>
<tr>
<td>
1981-11-01
</td>
<td>
3063
</td>
</tr>
<tr>
<td>
1981-12-01
</td>
<td>
2991
</td>
</tr>
</tbody>
</table></div>
<p>
408 rows × 1 columns
</p>
</div>
<div class="sourceCode" id="cb647"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb647-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb647-1" tabindex="-1"></a>plt.plot(data)</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168deaa9448&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_107_1.png"></div>
<div class="sourceCode" id="cb649"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb649-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb649-1" tabindex="-1"></a>select_arima_orderd_adf(data.x,<span class="dv">3</span>)</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
p值
</th>
</tr>
<tr>
<th>
差分阶数
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
5.224534e-06
</td>
</tr>
<tr>
<td>
2
</td>
<td>
1.957925e-07
</td>
</tr>
<tr>
<td>
3
</td>
<td>
5.315701e-07
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="sourceCode" id="cb650"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb650-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb650-1" tabindex="-1"></a>ar<span class="op">=</span><span class="dv">1</span><span class="co">#就设置为1</span></span>
<span id="cb650-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb650-2" tabindex="-1"></a>ma<span class="op">=</span>[<span class="dv">0</span>]<span class="op">*</span><span class="dv">12</span></span>
<span id="cb650-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb650-3" tabindex="-1"></a>ma[<span class="dv">0</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb650-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb650-4" tabindex="-1"></a>ma[<span class="dv">11</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb650-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb650-5" tabindex="-1"></a>mod<span class="op">=</span>tsa.SARIMAX(data,order<span class="op">=</span>(ar,<span class="dv">1</span>,ma))</span>
<span id="cb650-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb650-6" tabindex="-1"></a>modfit<span class="op">=</span>mod.fit(disp<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb650-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb650-7" tabindex="-1"></a>modfit.summary()</span></code></pre></div>
</div>
<div id="arima加法模型" class="section level4" number="10.2.7.2">
<h4>
<span class="header-section-number">10.2.7.2</span> ARIMA加法模型<a class="anchor" aria-label="anchor" href="#arima%E5%8A%A0%E6%B3%95%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h4>
<p>加法模型其实就是先获得平稳的模型，将不稳定因素减去，对剩下的因素构建适当的ARMA模型</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb651-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb651-1" tabindex="-1"></a><span class="co">#导入数据</span></span>
<span id="cb651-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb651-2" tabindex="-1"></a>data<span class="op">=</span>pd.read_excel(<span class="st">'./习题与案例数据/案例数据/A1_20.xlsx'</span>,index_col<span class="op">=</span><span class="st">'time'</span>)</span>
<span id="cb651-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb651-3" tabindex="-1"></a>data</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
x
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
1962-01-01
</td>
<td>
1.1
</td>
</tr>
<tr>
<td>
1962-04-01
</td>
<td>
0.5
</td>
</tr>
<tr>
<td>
1962-07-01
</td>
<td>
0.4
</td>
</tr>
<tr>
<td>
1962-10-01
</td>
<td>
0.7
</td>
</tr>
<tr>
<td>
1963-01-01
</td>
<td>
1.6
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<td>
1990-10-01
</td>
<td>
6.6
</td>
</tr>
<tr>
<td>
1991-01-01
</td>
<td>
6.8
</td>
</tr>
<tr>
<td>
1991-04-01
</td>
<td>
6.0
</td>
</tr>
<tr>
<td>
1991-07-01
</td>
<td>
6.2
</td>
</tr>
<tr>
<td>
1991-10-01
</td>
<td>
6.2
</td>
</tr>
</tbody>
</table></div>
<p>
120 rows × 1 columns
</p>
</div>
<div class="sourceCode" id="cb652"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb652-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb652-1" tabindex="-1"></a>plt.plot(data)</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168de935808&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_112_1.png"></div>
<div class="sourceCode" id="cb654"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb654-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb654-1" tabindex="-1"></a><span class="co">#做一阶差分和4步差分，得到数据,因为这是季度数据</span></span>
<span id="cb654-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb654-2" tabindex="-1"></a>dx<span class="op">=</span>data[<span class="st">'x'</span>].diff().dropna()</span>
<span id="cb654-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb654-3" tabindex="-1"></a>dx12<span class="op">=</span>pd.Series([n<span class="op">-</span>dx[::<span class="op">-</span><span class="dv">1</span>][i<span class="op">+</span><span class="dv">4</span>] <span class="cf">for</span> i,n <span class="kw">in</span> <span class="bu">enumerate</span>(dx[::<span class="op">-</span><span class="dv">1</span>]) <span class="cf">if</span> i<span class="op">+</span><span class="dv">4</span><span class="op">&lt;</span><span class="bu">len</span>(dx)])</span></code></pre></div>
<div class="sourceCode" id="cb655"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb655-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb655-1" tabindex="-1"></a><span class="co">#检验平稳性和随机性</span></span>
<span id="cb655-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb655-2" tabindex="-1"></a>tsa.adfuller(dx12)</span>
<span id="cb655-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb655-3" tabindex="-1"></a>r,q,p<span class="op">=</span>tsa.acf(dx12,fft<span class="op">=</span><span class="va">True</span>,qstat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb655-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb655-4" tabindex="-1"></a>np.c_[r[<span class="dv">1</span>:],q,p]</span></code></pre></div>
<pre><code>(-6.15621309726213,
 7.357953744299023e-08,
 3,
 111,
 {'1%': -3.490683082754047,
  '5%': -2.8879516565798817,
  '10%': -2.5808574442009578},
 57.66176611874175)

array([[ 4.22066251e-01,  2.10251984e+01,  4.53282432e-06],
       [ 1.88976812e-01,  2.52774828e+01,  3.24387684e-06],
       [ 7.24845218e-02,  2.59086671e+01,  9.96671089e-06],
       [-2.38843592e-01,  3.28235991e+01,  1.29804479e-06],
       [-2.38793298e-01,  3.97984557e+01,  1.63984012e-07],
       [-1.80874879e-01,  4.38368964e+01,  7.96352503e-08],
       [-1.94932404e-01,  4.85708939e+01,  2.75329616e-08],
       [-8.88521849e-02,  4.95636354e+01,  4.95665651e-08],
       [-5.97374814e-02,  5.00166077e+01,  1.06952006e-07],
       [ 2.17768244e-02,  5.00773769e+01,  2.58303768e-07],
       [ 2.17725542e-02,  5.01387063e+01,  5.91003399e-07],
       [-1.09621764e-01,  5.17084909e+01,  6.98214396e-07],
       [-2.03836243e-02,  5.17632992e+01,  1.48118422e-06],
       [-2.72508298e-02,  5.18622277e+01,  2.96709626e-06],
       [-1.20310925e-01,  5.38098011e+01,  2.82621187e-06],
       [ 1.71314533e-02,  5.38496887e+01,  5.48699630e-06],
       [ 5.63344292e-02,  5.42854066e+01,  8.91900867e-06],
       [-3.70409246e-02,  5.44757227e+01,  1.54678157e-05],
       [ 3.34272080e-02,  5.46323302e+01,  2.64565501e-05],
       [-5.67773727e-02,  5.50889037e+01,  3.98239366e-05],
       [-4.87304255e-02,  5.54288077e+01,  6.12018160e-05],
       [-7.49039463e-03,  5.54369250e+01,  1.02921942e-04],
       [-1.15397953e-01,  5.73844905e+01,  9.04122266e-05],
       [-1.17972793e-01,  5.94423041e+01,  7.65404775e-05],
       [-4.28970359e-02,  5.97174074e+01,  1.14349898e-04],
       [-6.39266238e-02,  6.03352207e+01,  1.51143632e-04],
       [ 5.67403641e-02,  6.08274702e+01,  2.05279762e-04],
       [ 1.22109796e-01,  6.31335029e+01,  1.59611818e-04],
       [ 8.42926928e-02,  6.42451453e+01,  1.77948161e-04],
       [ 1.39901237e-01,  6.73433341e+01,  1.09119067e-04],
       [ 2.38312186e-01,  7.64403073e+01,  1.03975215e-05],
       [ 2.14123950e-01,  8.38728276e+01,  1.56253569e-06],
       [ 1.36469084e-01,  8.69287224e+01,  9.62407575e-07],
       [ 7.75446317e-03,  8.69387110e+01,  1.59550939e-06],
       [-1.75615070e-01,  9.21257233e+01,  4.93164324e-07],
       [-1.93746705e-01,  9.85190259e+01,  1.01272609e-07],
       [-2.27914085e-01,  1.07479509e+02,  8.53842148e-09],
       [-9.94686998e-02,  1.09208393e+02,  8.27441070e-09],
       [ 1.02066788e-02,  1.09226836e+02,  1.42176837e-08],
       [-1.57033533e-02,  1.09271076e+02,  2.39135167e-08]])</code></pre>
<div class="sourceCode" id="cb657"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb657-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb657-1" tabindex="-1"></a><span class="co">#检验通过，在绘制自相关图加上order选择，判断最终定阶</span></span>
<span id="cb657-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb657-2" tabindex="-1"></a>plot_acf(dx12).show()</span>
<span id="cb657-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb657-3" tabindex="-1"></a>plot_pacf(dx12).show()</span>
<span id="cb657-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb657-4" tabindex="-1"></a>tsa.arma_order_select_ic(dx12,<span class="dv">3</span>,<span class="dv">3</span>,ic<span class="op">=</span><span class="st">'bic'</span>)</span></code></pre></div>
<pre><code>{'bic':            0          1          2          3
 0  96.453316  80.919882  84.974043  80.342909
 1  78.398369  83.123195  87.789872  84.874616
 2  83.121046  87.865584  80.724535  83.286027
 3  87.847277  81.027281  85.840942  92.948794, 'bic_min_order': (1, 0)}</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_115_1.png"></div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_115_2.png"></div>
<p>结合自相关图和偏自相关图，可以看到除了一阶和四阶，其他的都在两倍标准差内。所以可以尝试拟合疏系数模型，并且根据拖尾和截尾性质，使用ar模型.加法模型</p>
<p><span class="math inline">\(ARIMA((1,4),(1,4),0)\)</span>=<span class="math inline">\(ARIMA(1,1,0)\times(0,1,0)_4\)</span></p>
<div class="sourceCode" id="cb659"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb659-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb659-1" tabindex="-1"></a>ar<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb659-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb659-2" tabindex="-1"></a>mod<span class="op">=</span>tsa.SARIMAX(data,order<span class="op">=</span>(ar,<span class="dv">1</span>,<span class="dv">0</span>),seasonal_order<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb659-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb659-3" tabindex="-1"></a>modfit<span class="op">=</span>mod.fit(disp<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb659-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb659-4" tabindex="-1"></a>modfit.summary()</span></code></pre></div>
<div class="sourceCode" id="cb660"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb660-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb660-1" tabindex="-1"></a>modfit.predict(<span class="dv">0</span>,<span class="dv">120</span>)</span></code></pre></div>
<pre><code>1962-01-01    0.000000
1962-04-01    1.100000
1962-07-01    0.500000
1962-10-01    0.400000
1963-01-01    1.250000
                ...   
1991-01-01    6.949265
1991-04-01    5.612139
1991-07-01    5.916173
1991-10-01    6.186753
1992-01-01    6.615064
Freq: QS-OCT, Length: 121, dtype: float64</code></pre>
<div class="sourceCode" id="cb662"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb662-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb662-1" tabindex="-1"></a>ax<span class="op">=</span>plt.subplot(<span class="dv">111</span>)</span>
<span id="cb662-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb662-2" tabindex="-1"></a>ax.plot(data[<span class="st">'x'</span>])</span>
<span id="cb662-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb662-3" tabindex="-1"></a>ax.plot(modfit.predict(<span class="dv">0</span>,<span class="dv">120</span>))</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dc191608&gt;]

[&lt;matplotlib.lines.Line2D at 0x168de924208&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_119_2.png"></div>
<p>季节的加法模型和上面一个模型相比就是多了一个季节参数，也就是一个季节的k步差分</p>
<p>模型检验</p>
<p>都是通过的</p>
<p>略</p>
</div>
<div id="arima乘法模型" class="section level4" number="10.2.7.3">
<h4>
<span class="header-section-number">10.2.7.3</span> ARIMA乘法模型<a class="anchor" aria-label="anchor" href="#arima%E4%B9%98%E6%B3%95%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb664"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb664-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb664-1" tabindex="-1"></a>data<span class="op">=</span>pd.read_excel(<span class="st">'./习题与案例数据/案例数据/A1_21.xlsx'</span>,index_col<span class="op">=</span><span class="st">'time'</span>)</span>
<span id="cb664-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb664-2" tabindex="-1"></a>plt.plot(data)</span>
<span id="cb664-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb664-3" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dba2ca88&gt;]</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
x
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
1948-01-01
</td>
<td>
446
</td>
</tr>
<tr>
<td>
1948-02-01
</td>
<td>
650
</td>
</tr>
<tr>
<td>
1948-03-01
</td>
<td>
592
</td>
</tr>
<tr>
<td>
1948-04-01
</td>
<td>
561
</td>
</tr>
<tr>
<td>
1948-05-01
</td>
<td>
491
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<td>
1981-08-01
</td>
<td>
2975
</td>
</tr>
<tr>
<td>
1981-09-01
</td>
<td>
3064
</td>
</tr>
<tr>
<td>
1981-10-01
</td>
<td>
3092
</td>
</tr>
<tr>
<td>
1981-11-01
</td>
<td>
3063
</td>
</tr>
<tr>
<td>
1981-12-01
</td>
<td>
2991
</td>
</tr>
</tbody>
</table></div>
<p>
408 rows × 1 columns
</p>
</div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_123_2.png"></div>
<div class="sourceCode" id="cb666"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb666-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb666-1" tabindex="-1"></a><span class="co">#先将趋势项和季节效应提取，检验序列是否是平稳非白噪声序列</span></span>
<span id="cb666-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb666-2" tabindex="-1"></a><span class="co">#刚刚做一阶差分后已经提取了趋势效应</span></span>
<span id="cb666-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb666-3" tabindex="-1"></a><span class="co">#再做12步差分，提取季节效应</span></span>
<span id="cb666-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb666-4" tabindex="-1"></a>dx<span class="op">=</span>data[<span class="st">'x'</span>].diff().dropna()</span>
<span id="cb666-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb666-5" tabindex="-1"></a>dx12<span class="op">=</span>pd.Series([n<span class="op">-</span>dx[::<span class="op">-</span><span class="dv">1</span>][i<span class="op">+</span><span class="dv">12</span>] <span class="cf">for</span> i,n <span class="kw">in</span> <span class="bu">enumerate</span>(dx[::<span class="op">-</span><span class="dv">1</span>]) <span class="cf">if</span> i<span class="op">+</span><span class="dv">12</span><span class="op">&lt;</span><span class="bu">len</span>(dx)])</span></code></pre></div>
<div class="sourceCode" id="cb667"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb667-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb667-1" tabindex="-1"></a><span class="co">#然后再确定是否是白噪声序列</span></span>
<span id="cb667-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb667-2" tabindex="-1"></a>r,q,p<span class="op">=</span>tsa.acf(data[<span class="st">'x'</span>].diff().dropna(),fft<span class="op">=</span><span class="va">True</span>,qstat<span class="op">=</span><span class="va">True</span>,nlags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb667-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb667-3" tabindex="-1"></a>np.c_[r[<span class="dv">1</span>:],q,p]</span></code></pre></div>
<pre><code>array([[-1.85749784e-01,  1.41464777e+01,  1.69113428e-04],
       [ 2.98935223e-03,  1.41501507e+01,  8.45928814e-04],
       [-2.60302718e-01,  4.20687586e+01,  3.87956739e-09],
       [-7.06041807e-02,  4.41278399e+01,  6.03523844e-09],
       [ 2.35100467e-01,  6.70153553e+01,  4.27733608e-13],
       [-1.54958260e-02,  6.71150341e+01,  1.59431485e-12],
       [ 2.03394043e-01,  8.43311106e+01,  1.79654981e-15],
       [-8.43815734e-02,  8.73016825e+01,  1.63938501e-15],
       [-2.42222914e-01,  1.11841148e+02,  6.20008961e-20],
       [-7.56589124e-02,  1.14241348e+02,  7.42517345e-20],
       [-1.13345720e-01,  1.19641833e+02,  2.14011551e-20],
       [ 6.13800469e-01,  2.78414249e+02,  1.57763769e-52]])</code></pre>
<div class="sourceCode" id="cb669"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb669-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb669-1" tabindex="-1"></a><span class="co">#可以判断不是白噪声，为模型定阶</span></span>
<span id="cb669-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb669-2" tabindex="-1"></a></span>
<span id="cb669-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb669-3" tabindex="-1"></a>tsa.arma_order_select_ic(dx12,<span class="dv">3</span>,<span class="dv">3</span>,<span class="st">'bic'</span>)</span>
<span id="cb669-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb669-4" tabindex="-1"></a>plot_acf(dx12).show()</span>
<span id="cb669-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb669-5" tabindex="-1"></a>plot_pacf(dx12).show()</span></code></pre></div>
<pre><code>{'bic':              0            1            2            3
 0  4860.959171  4861.392903  4852.740094  4858.431293
 1  4859.319573  4859.251978  4857.639464  4863.045988
 2  4853.259759  4856.594373  4862.554521  4868.222488
 3  4857.194729  4862.560040  4856.715196  4860.269284,
 'bic_min_order': (0, 2)}</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_126_1.png"></div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_126_2.png"></div>
<div class="sourceCode" id="cb671"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb671-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-1" tabindex="-1"></a><span class="co"># 模型尝试</span></span>
<span id="cb671-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-2" tabindex="-1"></a>ar<span class="op">=</span>[<span class="dv">0</span>]<span class="op">*</span><span class="dv">12</span></span>
<span id="cb671-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-3" tabindex="-1"></a>ar[<span class="dv">0</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb671-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-4" tabindex="-1"></a>ar[<span class="op">-</span><span class="dv">1</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb671-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-5" tabindex="-1"></a>ma<span class="op">=</span>[<span class="dv">0</span>]<span class="op">*</span><span class="dv">12</span></span>
<span id="cb671-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-6" tabindex="-1"></a>ma[<span class="dv">0</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb671-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-7" tabindex="-1"></a>ma[<span class="dv">1</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb671-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-8" tabindex="-1"></a>ma[<span class="op">-</span><span class="dv">1</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb671-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-9" tabindex="-1"></a><span class="co">## AR(1,12)</span></span>
<span id="cb671-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-10" tabindex="-1"></a>r,q,p<span class="op">=</span>tsa.acf(tsa.SARIMAX(data,order<span class="op">=</span>(ar,<span class="dv">1</span>,<span class="dv">0</span>),seasonal_order<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">12</span>)).fit(disp<span class="op">=-</span><span class="dv">1</span>).resid,fft<span class="op">=</span><span class="va">True</span>,qstat<span class="op">=</span><span class="va">True</span>,nlags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb671-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-11" tabindex="-1"></a>np.c_[r[<span class="dv">1</span>:],q,p]</span>
<span id="cb671-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-12" tabindex="-1"></a><span class="co">##MA(1,2,12)</span></span>
<span id="cb671-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-13" tabindex="-1"></a>r,q,p<span class="op">=</span>tsa.acf(tsa.SARIMAX(data,order<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,ma),seasonal_order<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">12</span>)).fit(disp<span class="op">=-</span><span class="dv">1</span>).resid,fft<span class="op">=</span><span class="va">True</span>,qstat<span class="op">=</span><span class="va">True</span>,nlags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb671-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-14" tabindex="-1"></a>np.c_[r[<span class="dv">1</span>:],q,p]</span>
<span id="cb671-15"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-15" tabindex="-1"></a><span class="co">##ARMA((1,12),(1,12))</span></span>
<span id="cb671-16"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-16" tabindex="-1"></a>r,q,p<span class="op">=</span>tsa.acf(tsa.SARIMAX(data,order<span class="op">=</span>(ar,<span class="dv">1</span>,ar),seasonal_order<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">12</span>)).fit(disp<span class="op">=-</span><span class="dv">1</span>).resid,fft<span class="op">=</span><span class="va">True</span>,qstat<span class="op">=</span><span class="va">True</span>,nlags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb671-17"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb671-17" tabindex="-1"></a>np.c_[r[<span class="dv">1</span>:],q,p]</span></code></pre></div>
<pre><code>array([[ 2.62090931e-04,  2.82327771e-05,  9.95760498e-01],
       [ 1.59764475e-01,  1.05167024e+01,  5.20387781e-03],
       [ 6.39902758e-04,  1.05168715e+01,  1.46468835e-02],
       [ 6.61403669e-02,  1.23281943e+01,  1.50705147e-02],
       [ 2.91205772e-02,  1.26801913e+01,  2.65673310e-02],
       [ 5.60074868e-02,  1.39854907e+01,  2.97986615e-02],
       [-7.44858289e-02,  1.62999362e+01,  2.25130010e-02],
       [ 4.75763942e-02,  1.72465374e+01,  2.76418710e-02],
       [ 1.67598772e-03,  1.72477151e+01,  4.49751787e-02],
       [-8.53212637e-02,  2.03073916e+01,  2.64757342e-02],
       [ 4.68050874e-02,  2.12304722e+01,  3.10604125e-02],
       [-1.90425816e-01,  3.65484165e+01,  2.64346585e-04]])

array([[-4.38793784e-03,  7.91353530e-03,  9.29115246e-01],
       [ 1.08908145e-01,  4.89487265e+00,  8.65150990e-02],
       [-5.37913540e-02,  6.08999935e+00,  1.07312723e-01],
       [ 4.17548207e-02,  6.81189745e+00,  1.46168807e-01],
       [ 4.29923830e-02,  7.57912115e+00,  1.81007414e-01],
       [ 6.39358198e-02,  9.28012949e+00,  1.58425867e-01],
       [-6.26090674e-02,  1.09153417e+01,  1.42354643e-01],
       [ 2.17990649e-02,  1.11140700e+01,  1.95319236e-01],
       [-4.07478530e-02,  1.18101844e+01,  2.24222982e-01],
       [-5.96051715e-02,  1.33034217e+01,  2.07198464e-01],
       [ 1.16491739e-02,  1.33606016e+01,  2.70411346e-01],
       [-5.09339524e-02,  1.44564831e+01,  2.72512353e-01]])

array([[ 3.15982571e-01,  4.10370250e+01,  1.49372521e-10],
       [-5.88083875e-02,  4.24619648e+01,  6.01868337e-10],
       [-1.74572953e-01,  5.50495642e+01,  6.70101585e-12],
       [-8.21849192e-02,  5.78462709e+01,  8.21956756e-12],
       [ 1.09130349e-01,  6.27897199e+01,  3.21823058e-12],
       [ 1.49917833e-01,  7.21421520e+01,  1.48554920e-13],
       [ 1.77317263e-02,  7.22733120e+01,  5.12360612e-13],
       [-9.50309310e-02,  7.60500252e+01,  3.03874327e-13],
       [-1.88881390e-01,  9.10071964e+01,  1.02210118e-15],
       [-1.51868051e-01,  1.00700990e+02,  3.94492110e-17],
       [ 3.62650860e-01,  1.56116450e+02,  8.36001979e-28],
       [ 3.64378402e-01,  2.12202401e+02,  9.79513166e-39]])</code></pre>
<p>可以看到残差序列都是相关的，单纯的加法模型并不适合。</p>
<p>再次回到之前的自相关图，因为均不截尾，所以构建ARMA(1,1)模型</p>
<p>在考虑季节自相关特征，考虑季节效应周期（这里是一年，12阶延迟）倍数的相关系数，也就是12,24等</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb673-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb673-1" tabindex="-1"></a>plot_acf(dx12,lags<span class="op">=</span>[i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>,<span class="dv">48</span>,<span class="dv">12</span>)]).show()</span>
<span id="cb673-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb673-2" tabindex="-1"></a>plot_pacf(dx12,lags<span class="op">=</span>[i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>,<span class="dv">48</span>,<span class="dv">12</span>)]).show()</span></code></pre></div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_129_0.png"></div>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_129_1.png"></div>
<p>可以看到自相关系数延迟12阶显著非0，但是延迟24阶落入两倍标准差内。而偏相关系数延迟12阶和24阶都显著非0，认为自相关1阶截尾，偏自相关拖尾，所以是<span class="math inline">\(ARIMA(1,1,1)\times(0,1,1)_{12}\)</span></p>
<div class="sourceCode" id="cb674"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb674-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb674-1" tabindex="-1"></a><span class="co">#模型构建</span></span>
<span id="cb674-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb674-2" tabindex="-1"></a>mod<span class="op">=</span>tsa.SARIMAX(data,order<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),seasonal_order<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">12</span>)).fit(disp<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb674-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb674-3" tabindex="-1"></a>mod.summary()</span></code></pre></div>
<div class="sourceCode" id="cb675"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb675-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb675-1" tabindex="-1"></a><span class="co"># 模型显著性检验</span></span>
<span id="cb675-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb675-2" tabindex="-1"></a>r,q,p<span class="op">=</span>tsa.acf(mod.resid,fft<span class="op">=</span><span class="va">True</span>,qstat<span class="op">=</span><span class="va">True</span>,nlags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb675-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb675-3" tabindex="-1"></a>np.c_[r[<span class="dv">1</span>:],q,p]</span></code></pre></div>
<pre><code>array([[ 4.21220154e-02,  7.29235657e-01,  3.93131054e-01],
       [ 3.45447505e-02,  1.22091516e+00,  5.43102298e-01],
       [ 5.26569785e-03,  1.23236768e+00,  7.45252129e-01],
       [-5.54856194e-03,  1.24511513e+00,  8.70616308e-01],
       [ 8.40985550e-02,  4.18084466e+00,  5.23683554e-01],
       [ 4.87304329e-02,  5.16898472e+00,  5.22329615e-01],
       [-4.78427525e-02,  6.12382771e+00,  5.25367445e-01],
       [ 1.45962355e-02,  6.21292525e+00,  6.23394560e-01],
       [-3.75830490e-02,  6.80510717e+00,  6.57402303e-01],
       [-6.54153133e-02,  8.60364592e+00,  5.70085780e-01],
       [ 2.80827570e-02,  8.93594796e+00,  6.27804691e-01],
       [-4.38198976e-02,  9.74707998e+00,  6.38138285e-01]])</code></pre>
<p>显著性检验通过，系数检验也通过</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb677-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb677-1" tabindex="-1"></a>fig,axes<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb677-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb677-2" tabindex="-1"></a>axes.plot(data,label<span class="op">=</span><span class="st">'raw'</span>)</span>
<span id="cb677-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb677-3" tabindex="-1"></a>axes.plot(mod.predict(<span class="dv">0</span>,<span class="dv">480</span>),label<span class="op">=</span><span class="st">'predict'</span>)</span>
<span id="cb677-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb677-4" tabindex="-1"></a>plt.legend()</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168deed5f08&gt;]

[&lt;matplotlib.lines.Line2D at 0x168deeb15c8&gt;]

&lt;matplotlib.legend.Legend at 0x168db920f88&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_134_3.png"></div>
</div>
<div id="季节调整模型" class="section level4" number="10.2.7.4">
<h4>
<span class="header-section-number">10.2.7.4</span> 季节调整模型<a class="anchor" aria-label="anchor" href="#%E5%AD%A3%E8%8A%82%E8%B0%83%E6%95%B4%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb679"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb679-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb679-1" tabindex="-1"></a>data<span class="op">=</span>pd.read_excel(<span class="st">'./习题与案例数据/案例数据/A1_17.xlsx'</span>,index_col<span class="op">=</span><span class="st">'time'</span>)</span>
<span id="cb679-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb679-2" tabindex="-1"></a><span class="co">#tsa.x13_arima_select_order(data,maxorder=(2,2),maxdiff=(2,1))# x12a and x13as not found on path. Give the path, put them on PATH, or set the X12PATH or X13PATH environmental variable.</span></span></code></pre></div>
</div>
<div id="指数平滑模型" class="section level4" number="10.2.7.5">
<h4>
<span class="header-section-number">10.2.7.5</span> 指数平滑模型<a class="anchor" aria-label="anchor" href="#%E6%8C%87%E6%95%B0%E5%B9%B3%E6%BB%91%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h4>
<ol style="list-style-type: decimal">
<li>Holt线性趋势模型</li>
</ol>
<p>Holt 在1957年把简单的指数平滑模型进行了延伸，能够预测包含趋势的数据，该方法包含一个预测方程和两个平滑方程（一个用于水平，另一个用于趋势）</p>
<p><span class="math display">\[\begin{align*}
\text{Forecast equation}&amp;&amp; \hat{y}_{t+h|t} &amp;= \ell_{t} + hb_{t} \\
\text{Level equation}&amp;&amp; \ell_{t} &amp;= \alpha y_{t} + (1 - \alpha)(\ell_{t-1} + b_{t-1})\\
\text{Trend equation}&amp;&amp; b_{t} &amp;= \beta^*(\ell_{t} - \ell_{t-1}) + (1 -\beta^*)b_{t-1}
\end{align*}\]</span></p>
<p>其中 ltlt代表时刻t的预估水平， btbt代表时刻t的预测趋势（或坡度）， αα是水平的平滑参数， β∗β∗是趋势的平滑参数。
这时候，预测函数不再是平的，而是具有趋势的。</p>
<ol start="2" style="list-style-type: decimal">
<li>指数趋势模型</li>
</ol>
<p>另外一种Holt 线性模型的变体是指数趋势模型，这时水平和趋势不是相加的，而是相乘</p>
<p><span class="math display">\[\begin{align*}
\hat {y}_{t+h|t} &amp;= \ell_{t} b_{t}^h\\ \ell_{t} &amp;= \alpha
y_{t} + (1 - \alpha)(\ell_{t-1} b_{t-1})\\ b_{t} &amp;=
\beta^*\frac{\ell_{t}}{ \ell_{t-1}} + (1 -\beta^*)b_{t-1}
\end{align*}\]</span></p>
<p>其中 btbt代表预估的增长率（以相对的形式而不是绝对的形式）。这时候的趋势不是线性的，而是指数的。</p>
<ol start="3" style="list-style-type: decimal">
<li>阻尼趋势模型</li>
</ol>
<p>经验表明，Holt的线性模型和指数模型倾向于对未来预测值过高，特别是对于长期预测。Gardner 和 McKenzie (1985)引入了一种阻尼效应，倾向于在未来保持一个水平的线。包含阻尼的趋势被证明是一种非常有效的预测方法。</p>
<p>除了Holt的方法中的α和<span class="math inline">\(\beta^*\)</span>，该方法还包含阻尼参数0&lt;ϕ&lt;1:</p>
<p><span class="math display">\[\begin{align*}
\hat {y}_{t+h|t} &amp;= \ell_{t} + (\phi+\phi^2 + \dots + \phi^{h}) b_{t} \\
\ell_{t} &amp;= \alpha y_{t} + (1 - \alpha)(\ell_{t-1} + \phi b_{t-1})\\
b_{t}  &amp;= \beta^*(\ell_{t} - \ell_{t-1}) + (1 -\beta^*)\phi b_{t-1}.
\end{align*}\]</span></p>
<p>如果 ϕ=1，这种方法与Holt的线性模型相同。对于在0到1的值， ϕ对趋势产生阻尼效应。实际上， 当 h→∞时对于任何的 0&lt;ϕ&lt;1预测值收敛于 lT+ϕbT/(1−ϕ)。
误差校正形式是：</p>
<p><span class="math display">\[\begin{align*}
\ell_{t} &amp;= \ell_{t-1} + \phi b_{t-1} + \alpha e_{t} \\
b_{t} &amp;= \phi b_{t-1}+ \alpha \beta^*e_{t}.
\end{align*}\]</span></p>
<ol start="4" style="list-style-type: decimal">
<li>乘法阻尼趋势</li>
</ol>
<p>Taylor(2003)引入了一种阻尼参数，建立了乘法阻尼趋势模型：</p>
<p><span class="math display">\[\begin{align*} \hat {y}_{t+h|t} &amp;=
\ell_{t}b_{t}^{(\phi+\phi^2 + \dots + \phi^{h})} \\
\ell_{t} &amp;= \alpha y_{t} + (1 - \alpha)\ell_{t-1}
b^\phi_{t-1}\\ b_{t} &amp;= \beta^*\frac{\ell_{t}}{
\ell_{t-1}} + (1 -\beta^*)b_{t-1}^{\phi}.
\end{align*}\]</span></p>
<p>这种方法的预测结果不像加法阻尼那么保守，误差校正形式是：</p>
<p><span class="math display">\[\begin{align*}
\ell_{t} &amp;= \ell_{t-1} b^\phi_{t-1}+\alpha e_{t}\\ b_{t} &amp;=
b^\phi_{t-1}+ \alpha \beta^*\frac{e_{t}}{\ell_{t-1}}.
\end{align*}\]</span></p>
<ol start="5" style="list-style-type: decimal">
<li>holt三参数模型</li>
</ol>
<p>三次指数平滑在二次指数平滑的基础上保留了季节性的信息，使得其可以预测带有季节性的时间序列。三次指数平滑添加了一个新的参数p来表示平滑后的趋势。</p>
<p>三次指数平滑有累加和累乘两种方法。</p>
<p><strong>季节加法模型</strong>：</p>
<p><span class="math inline">\(a_0截距，b为斜率,\epsilon_t随机波动,服从N(0,\sigma^2)分布,c_t为t时刻有时间效应造成的序列偏差\)</span></p>
<p><span class="math display">\[x_t=a_0+bt+c_t+\epsilon_t\]</span></p>
<p>假设每个季节的周期长度为m期，每一期的季节指数为<span class="math inline">\(S_1,S_2,\dots,S_m\)</span>,不放假设t时刻为季节周期的第j期,则<span class="math inline">\(c_t\)</span>可以表示为:<span class="math inline">\(c_t=S_j+e_t e_t \sim N(0,\sigma^2_e)\)</span>,则模型可以写成如下递推公式:</p>
<p><span class="math display">\[x_t=a_0+b(t-1)+b+c_t+\epsilon_t=(x_{t-1}-c_{t-1}-\epsilon_{t-1})+b+\epsilon_t+(S_j+e_t)\]</span></p>
<p>不妨记：</p>
<p><span class="math inline">\(a(t-1)=x_{t-1}-c_{t-1}-\epsilon_{t-1}\)</span></p>
<p><span class="math inline">\(b(t)=b+\epsilon_t\)</span></p>
<p><span class="math inline">\(c(t)=S_j+e_t\)</span></p>
<p>显然，<span class="math inline">\(a(t-1)\)</span>是t-1时刻消除季节效应的序列截距项的无偏估计值，<span class="math inline">\(b(t)\)</span>是t时刻斜率b的无偏估计值,c(t)是t时刻季节指数S_j的无偏估计值.</p>
<p>则：<span class="math inline">\(x_t=a(t-1)+b(t)+c(t)\)</span></p>
<p>Holt-Winters三参数指数模型就是分别使用指数平滑的方法，迭代递推参数<span class="math inline">\(\hat{a}(t),\hat{b}(t)和\hat{c}_t\)</span>的值，递推公式如下:</p>
<p><span class="math inline">\(\hat{a}(t)=\alpha[x_t-c(t-m)]+(1-\alpha)[\hat(a)(t-1)+\hat(b)(t-1)]\)</span></p>
<p><span class="math inline">\(\hat{b}(t)=\beta[\hat{a}(t)-\hat{a}(t-1)]+(1-\beta)\hat{b}(t-1)\)</span></p>
<p><span class="math inline">\(\hat{c}(t)=\gamma[x_t-\hat{a}(t)]+(1-\gamma)c(t-m)\)</span></p>
<p>式中，<span class="math inline">\(x_t\)</span>为序列在t时刻得到的最新观察值；m是季节效应的周期长度；<span class="math inline">\(\alpha,\beta,\gamma\)</span>均为平滑系数,满足<span class="math inline">\(0&lt;\alpha,\beta,\gamma&lt;1\)</span></p>
<p>使用holt-Winters三参数指数平滑加法公式，向前k期的预测值为:</p>
<p><span class="math inline">\(\hat{x}_{t+k}=\hat{a}(t)+\hat{b}(t)k+\hat{c}(t+k),\forall k \geq 1\)</span></p>
<p>假设t+k期为季节周期的第j期,则<span class="math inline">\(\hat{c}(t+k)=\hat{S}_k(j=1,2,3,\dots,m)\)</span></p>
<p><strong>季节乘法模型</strong></p>
<p>对于乘法模型，序列通常可以表达为如下模型结构:</p>
<p><span class="math inline">\(x_t=(a_0+bt+\epsilon_t)c_t\)</span></p>
<p>式中，<span class="math inline">\(a_0\)</span>为截距；b为斜率.<span class="math inline">\(\epsilon_t\)</span>为随机波动且<span class="math inline">\(\epsilon_t\sim N(0,sigma^2)\)</span>;c_t为t时刻的季节效应；</p>
<p>假设每个季节的周期长度为m期，每一期的季节指数为<span class="math inline">\(S_1,S_2,\dots,S_m\)</span>,不放假设t时刻为季节周期的第j期,则<span class="math inline">\(c_t\)</span>可以表示为:<span class="math inline">\(c_t=S_j+e_t e_t \sim N(0,\sigma^2_e)\)</span>,则模型可以写成如下递推公式:</p>
<p><span class="math display">\[x_t=[a_0+b(t-1)+b+\epsilon_t]c_t=[(x_{t-1}/c_{t-1}-\epsilon_{t-1})+b+\epsilon_t](S_j+e_t)\]</span></p>
<p>不妨记：</p>
<p><span class="math inline">\(a(t-1)=x_{t-1}/c_{t-1}-\epsilon_{t-1}\)</span></p>
<p><span class="math inline">\(b(t)=b+\epsilon_t\)</span></p>
<p><span class="math inline">\(c(t)=S_j+e_t\)</span></p>
<p>显然，a(t-1)是t-1时刻消除季节效应的序列截距的无偏估计值，b(t)是t时刻序列斜率b的无偏估计值，c（t）是t时刻序列季节指数<span class="math inline">\(S_j\)</span>的无偏估计值</p>
<p>则模型可以表示为：</p>
<p><span class="math display">\[x_t=[a(t-1)+b(t)]c(t)\]</span></p>
<p>式中三个参数的地推公式是:</p>
<p><span class="math inline">\(\hat{a}(t)=\alpha[x_t/c(t-m)]+(1-\alpha)[\hat(a)(t-1)+\hat(b)(t-1)]\)</span></p>
<p><span class="math inline">\(\hat{b}(t)=\beta[\hat{a}(t)-\hat{a}(t-1)]+(1-\beta)\hat{b}(t-1)\)</span></p>
<p><span class="math inline">\(\hat{c}(t)=\gamma[x_t/\hat{a}(t)]+(1-\gamma)c(t-m)\)</span></p>
<p>式中，<span class="math inline">\(x_t\)</span>为序列在t时刻得到的最新观察值；m是季节效应的周期长度；<span class="math inline">\(\alpha,\beta,\gamma\)</span>均为平滑系数,满足<span class="math inline">\(0&lt;\alpha,\beta,\gamma&lt;1\)</span></p>
<p>使用holt-Winters三参数指数平滑加法公式，向前k期的预测值为:</p>
<p><span class="math inline">\(\hat{x}_{t+k}=[\hat{a}(t)+\hat{b}(t)k]\hat{c}(t+k),\forall k \geq 1\)</span></p>
<p>假设t+k期为季节周期的第j期,则<span class="math inline">\(\hat{c}(t+k)=\hat{S}_k(j=1,2,3,\dots,m)\)</span></p>
</div>
<div id="简单指数平滑模型" class="section level4" number="10.2.7.6">
<h4>
<span class="header-section-number">10.2.7.6</span> 简单指数平滑模型<a class="anchor" aria-label="anchor" href="#%E7%AE%80%E5%8D%95%E6%8C%87%E6%95%B0%E5%B9%B3%E6%BB%91%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h4>
<p>模型没有长期趋势和季节效应</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb680-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-1" tabindex="-1"></a><span class="co">#Here we run three variants of simple exponential smoothing:</span></span>
<span id="cb680-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-2" tabindex="-1"></a></span>
<span id="cb680-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-3" tabindex="-1"></a><span class="co">#In fit1 we do not use the auto optimization but instead choose to explicitly provide the model with the  α=0.2  parameter</span></span>
<span id="cb680-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-4" tabindex="-1"></a><span class="co">#In fit2 as above we choose an  α=0.6 </span></span>
<span id="cb680-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-5" tabindex="-1"></a><span class="co">#In fit3 we allow statsmodels to automatically find an optimized  α  value for us. This is the recommended approach.</span></span>
<span id="cb680-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-6" tabindex="-1"></a></span>
<span id="cb680-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-7" tabindex="-1"></a>data<span class="op">=</span>pd.read_excel(<span class="st">'./习题与案例数据/案例数据/A1_18.xlsx'</span>)</span>
<span id="cb680-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-8" tabindex="-1"></a>data.index<span class="op">=</span>pd.date_range(<span class="st">'1949'</span>,<span class="st">'1999'</span>,freq<span class="op">=</span><span class="st">'a'</span>)</span>
<span id="cb680-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-9" tabindex="-1"></a>data.index</span>
<span id="cb680-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-10" tabindex="-1"></a><span class="kw">del</span> data[<span class="st">'year'</span>]</span>
<span id="cb680-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb680-11" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>DatetimeIndex(['1949-12-31', '1950-12-31', '1951-12-31', '1952-12-31',
               '1953-12-31', '1954-12-31', '1955-12-31', '1956-12-31',
               '1957-12-31', '1958-12-31', '1959-12-31', '1960-12-31',
               '1961-12-31', '1962-12-31', '1963-12-31', '1964-12-31',
               '1965-12-31', '1966-12-31', '1967-12-31', '1968-12-31',
               '1969-12-31', '1970-12-31', '1971-12-31', '1972-12-31',
               '1973-12-31', '1974-12-31', '1975-12-31', '1976-12-31',
               '1977-12-31', '1978-12-31', '1979-12-31', '1980-12-31',
               '1981-12-31', '1982-12-31', '1983-12-31', '1984-12-31',
               '1985-12-31', '1986-12-31', '1987-12-31', '1988-12-31',
               '1989-12-31', '1990-12-31', '1991-12-31', '1992-12-31',
               '1993-12-31', '1994-12-31', '1995-12-31', '1996-12-31',
               '1997-12-31', '1998-12-31'],
              dtype='datetime64[ns]', freq='A-DEC')</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
temp
</th>
</tr></thead>
<tbody>
<tr>
<td>
1949-12-31
</td>
<td>
38.8
</td>
</tr>
<tr>
<td>
1950-12-31
</td>
<td>
35.6
</td>
</tr>
<tr>
<td>
1951-12-31
</td>
<td>
38.3
</td>
</tr>
<tr>
<td>
1952-12-31
</td>
<td>
39.6
</td>
</tr>
<tr>
<td>
1953-12-31
</td>
<td>
37.0
</td>
</tr>
<tr>
<td>
1954-12-31
</td>
<td>
33.4
</td>
</tr>
<tr>
<td>
1955-12-31
</td>
<td>
39.6
</td>
</tr>
<tr>
<td>
1956-12-31
</td>
<td>
34.6
</td>
</tr>
<tr>
<td>
1957-12-31
</td>
<td>
36.2
</td>
</tr>
<tr>
<td>
1958-12-31
</td>
<td>
37.6
</td>
</tr>
<tr>
<td>
1959-12-31
</td>
<td>
36.8
</td>
</tr>
<tr>
<td>
1960-12-31
</td>
<td>
38.1
</td>
</tr>
<tr>
<td>
1961-12-31
</td>
<td>
40.6
</td>
</tr>
<tr>
<td>
1962-12-31
</td>
<td>
37.1
</td>
</tr>
<tr>
<td>
1963-12-31
</td>
<td>
39.0
</td>
</tr>
<tr>
<td>
1964-12-31
</td>
<td>
37.5
</td>
</tr>
<tr>
<td>
1965-12-31
</td>
<td>
38.5
</td>
</tr>
<tr>
<td>
1966-12-31
</td>
<td>
37.5
</td>
</tr>
<tr>
<td>
1967-12-31
</td>
<td>
35.8
</td>
</tr>
<tr>
<td>
1968-12-31
</td>
<td>
40.1
</td>
</tr>
<tr>
<td>
1969-12-31
</td>
<td>
35.9
</td>
</tr>
<tr>
<td>
1970-12-31
</td>
<td>
35.3
</td>
</tr>
<tr>
<td>
1971-12-31
</td>
<td>
35.2
</td>
</tr>
<tr>
<td>
1972-12-31
</td>
<td>
39.5
</td>
</tr>
<tr>
<td>
1973-12-31
</td>
<td>
37.5
</td>
</tr>
<tr>
<td>
1974-12-31
</td>
<td>
35.8
</td>
</tr>
<tr>
<td>
1975-12-31
</td>
<td>
38.4
</td>
</tr>
<tr>
<td>
1976-12-31
</td>
<td>
35.0
</td>
</tr>
<tr>
<td>
1977-12-31
</td>
<td>
34.1
</td>
</tr>
<tr>
<td>
1978-12-31
</td>
<td>
37.5
</td>
</tr>
<tr>
<td>
1979-12-31
</td>
<td>
35.9
</td>
</tr>
<tr>
<td>
1980-12-31
</td>
<td>
35.1
</td>
</tr>
<tr>
<td>
1981-12-31
</td>
<td>
38.1
</td>
</tr>
<tr>
<td>
1982-12-31
</td>
<td>
37.3
</td>
</tr>
<tr>
<td>
1983-12-31
</td>
<td>
37.2
</td>
</tr>
<tr>
<td>
1984-12-31
</td>
<td>
36.1
</td>
</tr>
<tr>
<td>
1985-12-31
</td>
<td>
35.1
</td>
</tr>
<tr>
<td>
1986-12-31
</td>
<td>
38.5
</td>
</tr>
<tr>
<td>
1987-12-31
</td>
<td>
36.1
</td>
</tr>
<tr>
<td>
1988-12-31
</td>
<td>
38.1
</td>
</tr>
<tr>
<td>
1989-12-31
</td>
<td>
35.8
</td>
</tr>
<tr>
<td>
1990-12-31
</td>
<td>
37.5
</td>
</tr>
<tr>
<td>
1991-12-31
</td>
<td>
35.7
</td>
</tr>
<tr>
<td>
1992-12-31
</td>
<td>
37.5
</td>
</tr>
<tr>
<td>
1993-12-31
</td>
<td>
35.8
</td>
</tr>
<tr>
<td>
1994-12-31
</td>
<td>
37.2
</td>
</tr>
<tr>
<td>
1995-12-31
</td>
<td>
35.0
</td>
</tr>
<tr>
<td>
1996-12-31
</td>
<td>
36.0
</td>
</tr>
<tr>
<td>
1997-12-31
</td>
<td>
38.2
</td>
</tr>
<tr>
<td>
1998-12-31
</td>
<td>
37.2
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="sourceCode" id="cb682"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb682-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-1" tabindex="-1"></a>fit1 <span class="op">=</span> tsa.SimpleExpSmoothing(data).fit(smoothing_level<span class="op">=</span><span class="fl">0.2</span>,optimized<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb682-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-2" tabindex="-1"></a>fcast1 <span class="op">=</span> fit1.predict(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb682-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-3" tabindex="-1"></a>fit2 <span class="op">=</span> tsa.SimpleExpSmoothing(data).fit(smoothing_level<span class="op">=</span><span class="fl">0.6</span>,optimized<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb682-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-4" tabindex="-1"></a>fcast2 <span class="op">=</span> fit2.predict(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb682-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-5" tabindex="-1"></a>fit3 <span class="op">=</span> tsa.SimpleExpSmoothing(data).fit()</span>
<span id="cb682-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-6" tabindex="-1"></a>fcast3 <span class="op">=</span> fit3.predict(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb682-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-7" tabindex="-1"></a></span>
<span id="cb682-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-8" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb682-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-9" tabindex="-1"></a>ax.plot(data,marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb682-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-10" tabindex="-1"></a>ax.plot(fcast1,marker<span class="op">=</span><span class="st">'o'</span>,  color<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="vs">r'$\alpha=0.2$'</span>)</span>
<span id="cb682-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-11" tabindex="-1"></a>ax.plot(fcast2,marker<span class="op">=</span><span class="st">'o'</span>,  color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="vs">r'$\alpha=0.6$'</span>)</span>
<span id="cb682-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-12" tabindex="-1"></a>ax.plot(fcast3,marker<span class="op">=</span><span class="st">'o'</span>,  color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="vs">r'$\alpha=</span><span class="sc">%s</span><span class="vs">$'</span><span class="op">%</span>fit3.model.params[<span class="st">'smoothing_level'</span>])</span>
<span id="cb682-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-13" tabindex="-1"></a>ax.legend()</span>
<span id="cb682-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb682-14" tabindex="-1"></a>plt.show()</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dbff8308&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dbfdf188&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dbfce788&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dbfdf488&gt;]

&lt;matplotlib.legend.Legend at 0x168dbfce808&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_139_5.png"></div>
</div>
<div id="指数平滑-holt两参数" class="section level4" number="10.2.7.7">
<h4>
<span class="header-section-number">10.2.7.7</span> 指数平滑-holt两参数<a class="anchor" aria-label="anchor" href="#%E6%8C%87%E6%95%B0%E5%B9%B3%E6%BB%91-holt%E4%B8%A4%E5%8F%82%E6%95%B0"><i class="fas fa-link"></i></a>
</h4>
<p>对于含有线性趋势的序列进行预测</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb684-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb684-1" tabindex="-1"></a>data<span class="op">=</span>pd.read_excel(<span class="st">'./习题与案例数据/案例数据/A1_19.xlsx'</span>)</span>
<span id="cb684-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb684-2" tabindex="-1"></a>data.index<span class="op">=</span>pd.date_range(<span class="st">'1898'</span>,<span class="st">'1969'</span>,freq<span class="op">=</span><span class="st">'a'</span>)</span>
<span id="cb684-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb684-3" tabindex="-1"></a><span class="kw">del</span> data[<span class="st">'year'</span>]</span>
<span id="cb684-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb684-4" tabindex="-1"></a>data</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
water
</th>
</tr></thead>
<tbody>
<tr>
<td>
1898-12-31
</td>
<td>
402.8
</td>
</tr>
<tr>
<td>
1899-12-31
</td>
<td>
421.3
</td>
</tr>
<tr>
<td>
1900-12-31
</td>
<td>
431.2
</td>
</tr>
<tr>
<td>
1901-12-31
</td>
<td>
426.2
</td>
</tr>
<tr>
<td>
1902-12-31
</td>
<td>
425.5
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<td>
1964-12-31
</td>
<td>
567.1
</td>
</tr>
<tr>
<td>
1965-12-31
</td>
<td>
499.3
</td>
</tr>
<tr>
<td>
1966-12-31
</td>
<td>
493.6
</td>
</tr>
<tr>
<td>
1967-12-31
</td>
<td>
533.7
</td>
</tr>
<tr>
<td>
1968-12-31
</td>
<td>
581.1
</td>
</tr>
</tbody>
</table></div>
<p>
71 rows × 1 columns
</p>
</div>
<div class="sourceCode" id="cb685"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb685-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb685-1" tabindex="-1"></a>plt.plot(data)</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dcfc6d08&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_142_1.png"></div>
<pre><code>Holt's Method
Lets take a look at another example. This time we use air pollution data and the Holt's Method. We will fit three examples again.

In fit1 we again choose not to use the optimizer and provide explicit values for  α=0.8  and  β=0.2 
In fit2 we do the same as in fit1 but choose to use an exponential model rather than a Holt's additive model.
In fit3 we used a damped versions of the Holt's additive model but allow the dampening parameter  ϕ  to be optimized while fixing the values for  α=0.8  and  β=0.2</code></pre>
<div class="sourceCode" id="cb688"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb688-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-1" tabindex="-1"></a>fit1 <span class="op">=</span> tsa.Holt(data).fit(smoothing_level<span class="op">=</span><span class="fl">0.8</span>, smoothing_slope<span class="op">=</span><span class="fl">0.2</span>, optimized<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb688-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-2" tabindex="-1"></a>fcast1 <span class="op">=</span> fit1.forecast(<span class="dv">5</span>)</span>
<span id="cb688-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-3" tabindex="-1"></a>fit2 <span class="op">=</span> tsa.Holt(data, exponential<span class="op">=</span><span class="va">True</span>).fit(smoothing_level<span class="op">=</span><span class="fl">0.8</span>, smoothing_slope<span class="op">=</span><span class="fl">0.2</span>, optimized<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb688-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-4" tabindex="-1"></a>fcast2 <span class="op">=</span> fit2.forecast(<span class="dv">5</span>)</span>
<span id="cb688-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-5" tabindex="-1"></a>fit3 <span class="op">=</span> tsa.Holt(data, damped<span class="op">=</span><span class="va">True</span>).fit(smoothing_level<span class="op">=</span><span class="fl">0.8</span>, smoothing_slope<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb688-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-6" tabindex="-1"></a>fcast3 <span class="op">=</span> fit3.forecast(<span class="dv">5</span>)</span>
<span id="cb688-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-7" tabindex="-1"></a></span>
<span id="cb688-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-8" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb688-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-9" tabindex="-1"></a>ax.plot(data,color<span class="op">=</span><span class="st">"black"</span>, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb688-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-10" tabindex="-1"></a>ax.plot(fit1.fittedvalues, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb688-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-11" tabindex="-1"></a>ax.plot(fcast1, color<span class="op">=</span><span class="st">'blue'</span>, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb688-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-12" tabindex="-1"></a>ax.plot(fit2.fittedvalues,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb688-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-13" tabindex="-1"></a>ax.plot(fcast2, color<span class="op">=</span><span class="st">'red'</span>, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb688-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-14" tabindex="-1"></a>ax.plot(fit3.fittedvalues, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb688-15"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-15" tabindex="-1"></a>ax.plot(fcast3, color<span class="op">=</span><span class="st">'green'</span>, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb688-16"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb688-16" tabindex="-1"></a>plt.show()</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dc001d48&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dd00a088&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dd00a288&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dd011088&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dd00aa48&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dd011b48&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dd011d88&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_144_7.png"></div>
<p>Seasonally adjusted data</p>
<p>Lets look at some seasonally adjusted livestock data. We fit five Holt’s models. The below table allows us to compare results when we use exponential versus additive and damped versus non-damped.</p>
<p>Note: fit4 does not allow the parameter ϕ to be optimized by providing a fixed value of ϕ=0.98</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb690-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-1" tabindex="-1"></a>data <span class="op">=</span> [<span class="fl">263.9177</span>,  <span class="fl">268.3072</span>,  <span class="fl">260.6626</span>,  <span class="fl">266.6394</span>,  <span class="fl">277.5158</span>,  <span class="fl">283.834</span> , <span class="fl">290.309</span> ,  <span class="fl">292.4742</span>,  <span class="fl">300.8307</span>,  <span class="fl">309.2867</span>,  <span class="fl">318.3311</span>,  <span class="fl">329.3724</span>, <span class="fl">338.884</span> ,  <span class="fl">339.2441</span>,  <span class="fl">328.6006</span>,  <span class="fl">314.2554</span>,  <span class="fl">314.4597</span>,  <span class="fl">321.4138</span>, <span class="fl">329.7893</span>,  <span class="fl">346.3852</span>,  <span class="fl">352.2979</span>,  <span class="fl">348.3705</span>,  <span class="fl">417.5629</span>,  <span class="fl">417.1236</span>, <span class="fl">417.7495</span>,  <span class="fl">412.2339</span>,  <span class="fl">411.9468</span>,  <span class="fl">394.6971</span>,  <span class="fl">401.4993</span>,  <span class="fl">408.2705</span>, <span class="fl">414.2428</span>]</span>
<span id="cb690-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-2" tabindex="-1"></a>index<span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'1970'</span>, end<span class="op">=</span><span class="st">'2001'</span>, freq<span class="op">=</span><span class="st">'A'</span>)</span>
<span id="cb690-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-3" tabindex="-1"></a>livestock2 <span class="op">=</span> pd.Series(data, index)</span>
<span id="cb690-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-4" tabindex="-1"></a>data <span class="op">=</span> [<span class="fl">407.9979</span> ,  <span class="fl">403.4608</span>,  <span class="fl">413.8249</span>,  <span class="fl">428.105</span> ,  <span class="fl">445.3387</span>,  <span class="fl">452.9942</span>, <span class="fl">455.7402</span>]</span>
<span id="cb690-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-5" tabindex="-1"></a>index<span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'2001'</span>, end<span class="op">=</span><span class="st">'2008'</span>, freq<span class="op">=</span><span class="st">'A'</span>)</span>
<span id="cb690-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-6" tabindex="-1"></a>livestock3 <span class="op">=</span> pd.Series(data, index)</span>
<span id="cb690-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-7" tabindex="-1"></a>fit1 <span class="op">=</span> tsa.SimpleExpSmoothing(livestock2).fit()</span>
<span id="cb690-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-8" tabindex="-1"></a>fit2 <span class="op">=</span> tsa.Holt(livestock2).fit()</span>
<span id="cb690-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-9" tabindex="-1"></a>fit3 <span class="op">=</span> tsa.Holt(livestock2,exponential<span class="op">=</span><span class="va">True</span>).fit()</span>
<span id="cb690-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-10" tabindex="-1"></a>fit4 <span class="op">=</span> tsa.Holt(livestock2,damped<span class="op">=</span><span class="va">True</span>).fit(damping_slope<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb690-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-11" tabindex="-1"></a>fit5 <span class="op">=</span> tsa.Holt(livestock2,exponential<span class="op">=</span><span class="va">True</span>,damped<span class="op">=</span><span class="va">True</span>).fit()</span>
<span id="cb690-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-12" tabindex="-1"></a>params <span class="op">=</span> [<span class="st">'smoothing_level'</span>, <span class="st">'smoothing_slope'</span>, <span class="st">'damping_slope'</span>, <span class="st">'initial_level'</span>, <span class="st">'initial_slope'</span>]</span>
<span id="cb690-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-13" tabindex="-1"></a>results<span class="op">=</span>pd.DataFrame(np.zeros((<span class="dv">6</span>,<span class="dv">5</span>)),index<span class="op">=</span>[<span class="vs">r"$\alpha$"</span>,<span class="vs">r"$\beta$"</span>,<span class="vs">r"$\phi$"</span>,<span class="vs">r"$l_0$"</span>,<span class="st">"$b_0$"</span>,<span class="st">"SSE"</span>] ,columns<span class="op">=</span>[<span class="st">'SES'</span>, <span class="st">"Holt's"</span>,<span class="st">"Exponential"</span>, <span class="st">"Additive"</span>, <span class="st">"Multiplicative"</span>])</span>
<span id="cb690-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-14" tabindex="-1"></a>results[<span class="st">"SES"</span>] <span class="op">=</span>            [fit1.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit1.sse]</span>
<span id="cb690-15"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-15" tabindex="-1"></a>results[<span class="st">"Holt's"</span>] <span class="op">=</span>         [fit2.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit2.sse]</span>
<span id="cb690-16"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-16" tabindex="-1"></a>results[<span class="st">"Exponential"</span>] <span class="op">=</span>    [fit3.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit3.sse]</span>
<span id="cb690-17"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-17" tabindex="-1"></a>results[<span class="st">"Additive"</span>] <span class="op">=</span>       [fit4.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit4.sse]</span>
<span id="cb690-18"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-18" tabindex="-1"></a>results[<span class="st">"Multiplicative"</span>] <span class="op">=</span> [fit5.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit5.sse]</span>
<span id="cb690-19"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb690-19" tabindex="-1"></a>results</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
SES
</th>
<th>
Holt’s
</th>
<th>
Exponential
</th>
<th>
Additive
</th>
<th>
Multiplicative
</th>
</tr></thead>
<tbody>
<tr>
<td>
<span class="math inline">\(\alpha\)</span>
</td>
<td>
1.000000
</td>
<td>
0.974306
</td>
<td>
0.977633
</td>
<td>
0.978847
</td>
<td>
0.974911
</td>
</tr>
<tr>
<td>
<span class="math inline">\(\beta\)</span>
</td>
<td>
NaN
</td>
<td>
0.000000
</td>
<td>
0.000000
</td>
<td>
0.000000
</td>
<td>
0.000000
</td>
</tr>
<tr>
<td>
<span class="math inline">\(\phi\)</span>
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
0.980000
</td>
<td>
0.981646
</td>
</tr>
<tr>
<td>
<span class="math inline">\(l_0\)</span>
</td>
<td>
263.917700
</td>
<td>
258.882647
</td>
<td>
260.341560
</td>
<td>
257.357648
</td>
<td>
258.951730
</td>
</tr>
<tr>
<td>
<span class="math inline">\(b_0\)</span>
</td>
<td>
NaN
</td>
<td>
5.010775
</td>
<td>
1.013780
</td>
<td>
6.644538
</td>
<td>
1.038145
</td>
</tr>
<tr>
<td>
SSE
</td>
<td>
6761.350218
</td>
<td>
6004.138200
</td>
<td>
6104.194746
</td>
<td>
6036.555004
</td>
<td>
6081.995045
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Plots of Seasonally Adjusted Data
The following plots allow us to evaluate the level and slope/trend components of the above table’s fits.</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb691-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb691-1" tabindex="-1"></a><span class="cf">for</span> fit <span class="kw">in</span> [fit2,fit4]:</span>
<span id="cb691-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb691-2" tabindex="-1"></a>    plt.plot(pd.DataFrame(np.c_[fit.level,fit.slope]).rename(columns<span class="op">=</span>{<span class="dv">0</span>:<span class="st">'level'</span>,<span class="dv">1</span>:<span class="st">'slope'</span>}))</span>
<span id="cb691-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb691-3" tabindex="-1"></a>    plt.show()</span>
<span id="cb691-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb691-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Figure 7.4: Level and slope components for Holt’s linear trend method and the additive damped trend method.'</span>)</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dec4d308&gt;,
 &lt;matplotlib.lines.Line2D at 0x168dec4d4c8&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_148_1.png"></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168deca9908&gt;,
 &lt;matplotlib.lines.Line2D at 0x168deca9ac8&gt;]</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_148_3.png"></div>
<pre><code>Figure 7.4: Level and slope components for Holt’s linear trend method and the additive damped trend method.</code></pre>
<p>Comparison¶</p>
<p>Here we plot a comparison Simple Exponential Smoothing and Holt’s Methods for various additive, exponential and damped combinations. All of the models parameters will be optimized by statsmodels.</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb695-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-1" tabindex="-1"></a>fit1 <span class="op">=</span> tsa.SimpleExpSmoothing(livestock2).fit()</span>
<span id="cb695-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-2" tabindex="-1"></a>fcast1 <span class="op">=</span> fit1.forecast(<span class="dv">9</span>)</span>
<span id="cb695-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-3" tabindex="-1"></a>fit2 <span class="op">=</span> tsa.Holt(livestock2).fit()</span>
<span id="cb695-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-4" tabindex="-1"></a>fcast2 <span class="op">=</span> fit2.forecast(<span class="dv">9</span>)</span>
<span id="cb695-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-5" tabindex="-1"></a>fit3 <span class="op">=</span> tsa.Holt(livestock2, exponential<span class="op">=</span><span class="va">True</span>).fit()</span>
<span id="cb695-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-6" tabindex="-1"></a>fcast3 <span class="op">=</span> fit3.forecast(<span class="dv">9</span>)</span>
<span id="cb695-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-7" tabindex="-1"></a>fit4 <span class="op">=</span> tsa.Holt(livestock2, damped<span class="op">=</span><span class="va">True</span>).fit(damping_slope<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb695-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-8" tabindex="-1"></a>fcast4 <span class="op">=</span> fit4.forecast(<span class="dv">9</span>)</span>
<span id="cb695-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-9" tabindex="-1"></a>fit5 <span class="op">=</span> tsa.Holt(livestock2, exponential<span class="op">=</span><span class="va">True</span>, damped<span class="op">=</span><span class="va">True</span>).fit()</span>
<span id="cb695-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-10" tabindex="-1"></a>fcast5 <span class="op">=</span> fit5.forecast(<span class="dv">9</span>)</span>
<span id="cb695-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-11" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb695-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-12" tabindex="-1"></a>ax .plot(livestock2,color<span class="op">=</span><span class="st">"black"</span>, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb695-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-13" tabindex="-1"></a>ax.plot(livestock3 ,color<span class="op">=</span><span class="st">"black"</span>, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb695-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-14" tabindex="-1"></a>ax.plot(fcast1, color<span class="op">=</span><span class="st">'red'</span>,label<span class="op">=</span><span class="st">'SES'</span>)</span>
<span id="cb695-15"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-15" tabindex="-1"></a>ax.plot(fcast2, color<span class="op">=</span><span class="st">'green'</span>,label<span class="op">=</span><span class="st">"holt's"</span>)</span>
<span id="cb695-16"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-16" tabindex="-1"></a>ax.plot( fcast3,color<span class="op">=</span><span class="st">'blue'</span>,label<span class="op">=</span><span class="st">"Exponential"</span>)</span>
<span id="cb695-17"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-17" tabindex="-1"></a>ax.plot( fcast4,color<span class="op">=</span><span class="st">'cyan'</span>,label<span class="op">=</span><span class="st">"Additive Damped"</span>)</span>
<span id="cb695-18"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-18" tabindex="-1"></a>ax.plot( fcast5,color<span class="op">=</span><span class="st">'magenta'</span>,label<span class="op">=</span><span class="st">'Multiplicated Damped'</span>)</span>
<span id="cb695-19"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-19" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Livestock, sheep in Asia (millions)'</span>)</span>
<span id="cb695-20"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-20" tabindex="-1"></a>plt.legend()</span>
<span id="cb695-21"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-21" tabindex="-1"></a>plt.show()</span>
<span id="cb695-22"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb695-22" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Figure 7.5: Forecasting livestock, sheep in Asia: comparing forecasting performance of non-seasonal methods.'</span>)</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168e1383948&gt;]

[&lt;matplotlib.lines.Line2D at 0x168e13a88c8&gt;]

[&lt;matplotlib.lines.Line2D at 0x168e13afc08&gt;]

[&lt;matplotlib.lines.Line2D at 0x168e13afbc8&gt;]

[&lt;matplotlib.lines.Line2D at 0x168e13b2408&gt;]

[&lt;matplotlib.lines.Line2D at 0x168e13b2b48&gt;]

[&lt;matplotlib.lines.Line2D at 0x168e13b2308&gt;]

Text(0, 0.5, 'Livestock, sheep in Asia (millions)')

&lt;matplotlib.legend.Legend at 0x168e13b77c8&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_150_9.png"></div>
<pre><code>Figure 7.5: Forecasting livestock, sheep in Asia: comparing forecasting performance of non-seasonal methods.</code></pre>
</div>
<div id="holt-winters三参数季节加法和乘法模型" class="section level4" number="10.2.7.8">
<h4>
<span class="header-section-number">10.2.7.8</span> holt-winters三参数季节加法和乘法模型<a class="anchor" aria-label="anchor" href="#holt-winters%E4%B8%89%E5%8F%82%E6%95%B0%E5%AD%A3%E8%8A%82%E5%8A%A0%E6%B3%95%E5%92%8C%E4%B9%98%E6%B3%95%E6%A8%A1%E5%9E%8B"><i class="fas fa-link"></i></a>
</h4>
<p><code>tsa.ExponentialSmoothing(data,seasonal_periods,trend='add'或'mul',seasonal='add'或'mut')</code>#seasonal选项决定了加法还是乘法模型</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb698-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb698-1" tabindex="-1"></a>data <span class="op">=</span> [<span class="fl">41.7275</span>,  <span class="fl">24.0418</span>,  <span class="fl">32.3281</span>,  <span class="fl">37.3287</span>,  <span class="fl">46.2132</span>,  <span class="fl">29.3463</span>, <span class="fl">36.4829</span>,  <span class="fl">42.9777</span>,  <span class="fl">48.9015</span>,  <span class="fl">31.1802</span>,  <span class="fl">37.7179</span>,  <span class="fl">40.4202</span>, <span class="fl">51.2069</span>,  <span class="fl">31.8872</span>,  <span class="fl">40.9783</span>,  <span class="fl">43.7725</span>,  <span class="fl">55.5586</span>,  <span class="fl">33.8509</span>, <span class="fl">42.0764</span>,  <span class="fl">45.6423</span>,  <span class="fl">59.7668</span>,  <span class="fl">35.1919</span>,  <span class="fl">44.3197</span>,  <span class="fl">47.9137</span>]</span>
<span id="cb698-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb698-2" tabindex="-1"></a>index<span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'2005'</span>, end<span class="op">=</span><span class="st">'2010-Q4'</span>, freq<span class="op">=</span><span class="st">'QS-OCT'</span>)</span>
<span id="cb698-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb698-3" tabindex="-1"></a>aust <span class="op">=</span> pd.Series(data, index)</span></code></pre></div>
<div class="sourceCode" id="cb699"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb699-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-1" tabindex="-1"></a>fit1 <span class="op">=</span> tsa.ExponentialSmoothing(aust, seasonal_periods<span class="op">=</span><span class="dv">4</span>, trend<span class="op">=</span><span class="st">'add'</span>, seasonal<span class="op">=</span><span class="st">'add'</span>).fit(use_boxcox<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb699-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-2" tabindex="-1"></a>fit2 <span class="op">=</span> tsa.ExponentialSmoothing(aust, seasonal_periods<span class="op">=</span><span class="dv">4</span>, trend<span class="op">=</span><span class="st">'add'</span>, seasonal<span class="op">=</span><span class="st">'mul'</span>).fit(use_boxcox<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb699-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-3" tabindex="-1"></a>fit3 <span class="op">=</span> tsa.ExponentialSmoothing(aust, seasonal_periods<span class="op">=</span><span class="dv">4</span>, trend<span class="op">=</span><span class="st">'add'</span>, seasonal<span class="op">=</span><span class="st">'add'</span>, damped<span class="op">=</span><span class="va">True</span>).fit(use_boxcox<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb699-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-4" tabindex="-1"></a>fit4 <span class="op">=</span> tsa.ExponentialSmoothing(aust, seasonal_periods<span class="op">=</span><span class="dv">4</span>, trend<span class="op">=</span><span class="st">'add'</span>, seasonal<span class="op">=</span><span class="st">'mul'</span>, damped<span class="op">=</span><span class="va">True</span>).fit(use_boxcox<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb699-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-5" tabindex="-1"></a>results<span class="op">=</span>pd.DataFrame(np.zeros((<span class="dv">7</span>,<span class="dv">4</span>)),index<span class="op">=</span>[<span class="vs">r"$\alpha$"</span>,<span class="vs">r"$\beta$"</span>,<span class="vs">r"$\phi$"</span>,<span class="vs">r"$\gamma$"</span>,<span class="vs">r"$l_0$"</span>,<span class="st">"$b_0$"</span>,<span class="st">"SSE"</span>],columns<span class="op">=</span>[<span class="st">"Additive"</span>,<span class="st">"Multiplicative"</span>,<span class="st">"Additive Dam"</span>,<span class="st">"Multiplica Dam"</span>])</span>
<span id="cb699-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-6" tabindex="-1"></a>params <span class="op">=</span> [<span class="st">'smoothing_level'</span>, <span class="st">'smoothing_slope'</span>, <span class="st">'damping_slope'</span>, <span class="st">'smoothing_seasonal'</span>, <span class="st">'initial_level'</span>, <span class="st">'initial_slope'</span>]</span>
<span id="cb699-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-7" tabindex="-1"></a>results[<span class="st">"Additive"</span>]       <span class="op">=</span> [fit1.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit1.sse]</span>
<span id="cb699-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-8" tabindex="-1"></a>results[<span class="st">"Multiplicative"</span>] <span class="op">=</span> [fit2.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit2.sse]</span>
<span id="cb699-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-9" tabindex="-1"></a>results[<span class="st">"Additive Dam"</span>]   <span class="op">=</span> [fit3.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit3.sse]</span>
<span id="cb699-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-10" tabindex="-1"></a>results[<span class="st">"Multiplica Dam"</span>] <span class="op">=</span> [fit4.params[p] <span class="cf">for</span> p <span class="kw">in</span> params] <span class="op">+</span> [fit4.sse]</span>
<span id="cb699-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-11" tabindex="-1"></a></span>
<span id="cb699-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-12" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb699-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-13" tabindex="-1"></a>ax .plot(aust,marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'black'</span> )</span>
<span id="cb699-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-14" tabindex="-1"></a>ax.set_ylabel(<span class="st">"International visitor night in Australia (millions)"</span>)</span>
<span id="cb699-15"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-15" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb699-16"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-16" tabindex="-1"></a>ax.set_title(<span class="st">"Forecasts from Holt-Winters' multiplicative method"</span>)</span>
<span id="cb699-17"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-17" tabindex="-1"></a>ax.plot(fit1.fittedvalues, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb699-18"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-18" tabindex="-1"></a>ax.plot(fit2.fittedvalues, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb699-19"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-19" tabindex="-1"></a>ax.plot(fit1.forecast(<span class="dv">8</span>), ls<span class="op">=</span><span class="st">'--'</span>, marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Holt-Winters (add-add-seasonal)'</span>)</span>
<span id="cb699-20"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-20" tabindex="-1"></a>ax.plot(fit2.forecast(<span class="dv">8</span>), ls<span class="op">=</span><span class="st">'--'</span>, marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'green'</span>,label<span class="op">=</span><span class="st">'Holt-Winters (add-mul-seasonal)'</span>)</span>
<span id="cb699-21"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-21" tabindex="-1"></a>plt.legend()</span>
<span id="cb699-22"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-22" tabindex="-1"></a>plt.show()</span>
<span id="cb699-23"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-23" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Figure 7.6: Forecasting international visitor nights in Australia using Holt-Winters method with both additive and multiplicative seasonality."</span>)</span>
<span id="cb699-24"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-24" tabindex="-1"></a></span>
<span id="cb699-25"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb699-25" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dd087b08&gt;]

Text(0, 0.5, 'International visitor night in Australia (millions)')

Text(0.5, 0, 'Year')

Text(0.5, 1.0, "Forecasts from Holt-Winters' multiplicative method")

[&lt;matplotlib.lines.Line2D at 0x168dec3f988&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dec5c348&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dc093a88&gt;]

[&lt;matplotlib.lines.Line2D at 0x168dececa88&gt;]

&lt;matplotlib.legend.Legend at 0x168dec08588&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_155_9.png"></div>
<pre><code>Figure 7.6: Forecasting international visitor nights in Australia using Holt-Winters method with both additive and multiplicative seasonality.</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
Additive
</th>
<th>
Multiplicative
</th>
<th>
Additive Dam
</th>
<th>
Multiplica Dam
</th>
</tr></thead>
<tbody>
<tr>
<td>
<span class="math inline">\(\alpha\)</span>
</td>
<td>
4.546258e-01
</td>
<td>
3.659123e-01
</td>
<td>
3.231104e-08
</td>
<td>
0.000182
</td>
</tr>
<tr>
<td>
<span class="math inline">\(\beta\)</span>
</td>
<td>
1.634586e-08
</td>
<td>
6.701126e-18
</td>
<td>
3.081400e-08
</td>
<td>
0.000182
</td>
</tr>
<tr>
<td>
<span class="math inline">\(\phi\)</span>
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
9.453152e-01
</td>
<td>
0.913648
</td>
</tr>
<tr>
<td>
<span class="math inline">\(\gamma\)</span>
</td>
<td>
5.244178e-01
</td>
<td>
9.705372e-12
</td>
<td>
7.167742e-06
</td>
<td>
0.000000
</td>
</tr>
<tr>
<td>
<span class="math inline">\(l_0\)</span>
</td>
<td>
1.421751e+01
</td>
<td>
1.454863e+01
</td>
<td>
1.418138e+01
</td>
<td>
14.534854
</td>
</tr>
<tr>
<td>
<span class="math inline">\(b_0\)</span>
</td>
<td>
1.307802e-01
</td>
<td>
1.661316e-01
</td>
<td>
2.380511e-01
</td>
<td>
0.484783
</td>
</tr>
<tr>
<td>
SSE
</td>
<td>
5.001656e+01
</td>
<td>
4.307003e+01
</td>
<td>
3.531783e+01
</td>
<td>
39.710958
</td>
</tr>
</tbody>
</table></div>
</div>
<p>The Internals
It is possible to get at the internals of the Exponential Smoothing models.</p>
<p>Here we show some tables that allow you to view side by side the original values <span class="math inline">\(y_t\)</span> , the level <span class="math inline">\(l_t\)</span> , the trend <span class="math inline">\(b_t\)</span> , the season <span class="math inline">\(s_t\)</span> and the fitted values <span class="math inline">\(\hat{y}_t\)</span> .</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb702-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb702-1" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(np.c_[aust, fit1.level, fit1.slope, fit1.season, fit1.fittedvalues],</span>
<span id="cb702-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb702-2" tabindex="-1"></a>                  columns<span class="op">=</span>[<span class="vs">r'$y_t$'</span>,<span class="vs">r'$l_t$'</span>,<span class="vs">r'$b_t$'</span>,<span class="vs">r'$s_t$'</span>,<span class="vs">r'$\hat</span><span class="sc">{y}</span><span class="vs">_t$'</span>],index<span class="op">=</span>aust.index)</span>
<span id="cb702-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb702-3" tabindex="-1"></a>df.append(fit1.forecast(<span class="dv">8</span>).rename(<span class="vs">r'$\hat</span><span class="sc">{y}</span><span class="vs">_t$'</span>).to_frame(), sort<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
<span class="math inline">\(\hat{y}_t\)</span>
</th>
<th>
<span class="math inline">\(b_t\)</span>
</th>
<th>
<span class="math inline">\(l_t\)</span>
</th>
<th>
<span class="math inline">\(s_t\)</span>
</th>
<th>
<span class="math inline">\(y_t\)</span>
</th>
</tr></thead>
<tbody>
<tr>
<td>
2005-01-01
</td>
<td>
41.721215
</td>
<td>
-34.969355
</td>
<td>
49.317641
</td>
<td>
-7.593355
</td>
<td>
41.7275
</td>
</tr>
<tr>
<td>
2005-04-01
</td>
<td>
24.190230
</td>
<td>
-35.452819
</td>
<td>
49.932455
</td>
<td>
-25.834685
</td>
<td>
24.0418
</td>
</tr>
<tr>
<td>
2005-07-01
</td>
<td>
31.460507
</td>
<td>
-36.532825
</td>
<td>
51.126190
</td>
<td>
-19.183004
</td>
<td>
32.3281
</td>
</tr>
<tr>
<td>
2005-10-01
</td>
<td>
36.634747
</td>
<td>
-37.397689
</td>
<td>
52.210159
</td>
<td>
-15.209769
</td>
<td>
37.3287
</td>
</tr>
<tr>
<td>
2006-01-01
</td>
<td>
45.097771
</td>
<td>
-38.467268
</td>
<td>
53.476787
</td>
<td>
-7.837229
</td>
<td>
46.2132
</td>
</tr>
<tr>
<td>
2006-04-01
</td>
<td>
27.191784
</td>
<td>
-40.276317
</td>
<td>
55.513864
</td>
<td>
-27.017364
</td>
<td>
29.3463
</td>
</tr>
<tr>
<td>
2006-07-01
</td>
<td>
36.544233
</td>
<td>
-40.625063
</td>
<td>
56.224501
</td>
<td>
-19.713874
</td>
<td>
36.4829
</td>
</tr>
<tr>
<td>
2006-10-01
</td>
<td>
41.449470
</td>
<td>
-42.041800
</td>
<td>
57.766129
</td>
<td>
-15.523362
</td>
<td>
42.9777
</td>
</tr>
<tr>
<td>
2007-01-01
</td>
<td>
50.934532
</td>
<td>
-41.543834
</td>
<td>
57.536773
</td>
<td>
-7.588696
</td>
<td>
48.9015
</td>
</tr>
<tr>
<td>
2007-04-01
</td>
<td>
31.418265
</td>
<td>
-42.197870
</td>
<td>
58.151045
</td>
<td>
-26.874311
</td>
<td>
31.1802
</td>
</tr>
<tr>
<td>
2007-07-01
</td>
<td>
38.718351
</td>
<td>
-42.303520
</td>
<td>
58.363042
</td>
<td>
-20.191961
</td>
<td>
37.7179
</td>
</tr>
<tr>
<td>
2007-10-01
</td>
<td>
44.140653
</td>
<td>
-41.085817
</td>
<td>
57.181928
</td>
<td>
-14.982846
</td>
<td>
40.4202
</td>
</tr>
<tr>
<td>
2008-01-01
</td>
<td>
49.315801
</td>
<td>
-42.961548
</td>
<td>
58.853067
</td>
<td>
-8.619920
</td>
<td>
51.2069
</td>
</tr>
<tr>
<td>
2008-04-01
</td>
<td>
32.307035
</td>
<td>
-43.186594
</td>
<td>
59.367061
</td>
<td>
-27.309231
</td>
<td>
31.8872
</td>
</tr>
<tr>
<td>
2008-07-01
</td>
<td>
39.207484
</td>
<td>
-44.827063
</td>
<td>
61.095687
</td>
<td>
-20.925640
</td>
<td>
40.9783
</td>
</tr>
<tr>
<td>
2008-10-01
</td>
<td>
44.551298
</td>
<td>
-44.899537
</td>
<td>
61.462251
</td>
<td>
-17.319979
</td>
<td>
43.7725
</td>
</tr>
<tr>
<td>
2009-01-01
</td>
<td>
54.358133
</td>
<td>
-46.192301
</td>
<td>
62.816914
</td>
<td>
-7.881709
</td>
<td>
55.5586
</td>
</tr>
<tr>
<td>
2009-04-01
</td>
<td>
35.153884
</td>
<td>
-45.980242
</td>
<td>
62.832235
</td>
<td>
-28.447956
</td>
<td>
33.8509
</td>
</tr>
<tr>
<td>
2009-07-01
</td>
<td>
43.066515
</td>
<td>
-46.228183
</td>
<td>
63.082736
</td>
<td>
-20.550728
</td>
<td>
42.0764
</td>
</tr>
<tr>
<td>
2009-10-01
</td>
<td>
45.871197
</td>
<td>
-46.852581
</td>
<td>
63.748943
</td>
<td>
-17.997893
</td>
<td>
45.6423
</td>
</tr>
<tr>
<td>
2010-01-01
</td>
<td>
57.166649
</td>
<td>
-48.770485
</td>
<td>
65.777689
</td>
<td>
-7.372215
</td>
<td>
59.7668
</td>
</tr>
<tr>
<td>
2010-04-01
</td>
<td>
36.761415
</td>
<td>
-48.308407
</td>
<td>
65.650109
</td>
<td>
-29.816926
</td>
<td>
35.1919
</td>
</tr>
<tr>
<td>
2010-07-01
</td>
<td>
44.932523
</td>
<td>
-48.798730
</td>
<td>
66.119529
</td>
<td>
-21.517568
</td>
<td>
44.3197
</td>
</tr>
<tr>
<td>
2010-10-01
</td>
<td>
48.399603
</td>
<td>
-49.269891
</td>
<td>
66.667513
</td>
<td>
-18.522367
</td>
<td>
47.9137
</td>
</tr>
<tr>
<td>
2011-01-01
</td>
<td>
61.338004
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2011-04-01
</td>
<td>
37.242913
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2011-07-01
</td>
<td>
46.842710
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2011-10-01
</td>
<td>
51.005356
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2012-01-01
</td>
<td>
64.470967
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2012-04-01
</td>
<td>
39.777051
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2012-07-01
</td>
<td>
49.636039
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2012-10-01
</td>
<td>
53.901669
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="sourceCode" id="cb703"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb703-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb703-1" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(np.c_[aust, fit2.level, fit2.slope, fit2.season, fit2.fittedvalues], </span>
<span id="cb703-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb703-2" tabindex="-1"></a>                  columns<span class="op">=</span>[<span class="vs">r'$y_t$'</span>,<span class="vs">r'$l_t$'</span>,<span class="vs">r'$b_t$'</span>,<span class="vs">r'$s_t$'</span>,<span class="vs">r'$\hat</span><span class="sc">{y}</span><span class="vs">_t$'</span>],index<span class="op">=</span>aust.index)</span>
<span id="cb703-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb703-3" tabindex="-1"></a>df.append(fit2.forecast(<span class="dv">8</span>).rename(<span class="vs">r'$\hat</span><span class="sc">{y}</span><span class="vs">_t$'</span>).to_frame(), sort<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="inline-table"><table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
<span class="math inline">\(\hat{y}_t\)</span>
</th>
<th>
<span class="math inline">\(b_t\)</span>
</th>
<th>
<span class="math inline">\(l_t\)</span>
</th>
<th>
<span class="math inline">\(s_t\)</span>
</th>
<th>
<span class="math inline">\(y_t\)</span>
</th>
</tr></thead>
<tbody>
<tr>
<td>
2005-01-01
</td>
<td>
41.860256
</td>
<td>
-36.532222
</td>
<td>
51.246984
</td>
<td>
0.815871
</td>
<td>
41.7275
</td>
</tr>
<tr>
<td>
2005-04-01
</td>
<td>
25.838610
</td>
<td>
-35.868807
</td>
<td>
50.738675
</td>
<td>
0.495361
</td>
<td>
24.0418
</td>
</tr>
<tr>
<td>
2005-07-01
</td>
<td>
31.659323
</td>
<td>
-37.285903
</td>
<td>
52.062842
</td>
<td>
0.612972
</td>
<td>
32.3281
</td>
</tr>
<tr>
<td>
2005-10-01
</td>
<td>
35.189636
</td>
<td>
-39.171170
</td>
<td>
54.189365
</td>
<td>
0.664165
</td>
<td>
37.3287
</td>
</tr>
<tr>
<td>
2006-01-01
</td>
<td>
44.929137
</td>
<td>
-40.308071
</td>
<td>
55.708228
</td>
<td>
0.815030
</td>
<td>
46.2132
</td>
</tr>
<tr>
<td>
2006-04-01
</td>
<td>
27.933669
</td>
<td>
-42.089577
</td>
<td>
57.758593
</td>
<td>
0.493042
</td>
<td>
29.3463
</td>
</tr>
<tr>
<td>
2006-07-01
</td>
<td>
35.824394
</td>
<td>
-43.102570
</td>
<td>
59.129556
</td>
<td>
0.610078
</td>
<td>
36.4829
</td>
</tr>
<tr>
<td>
2006-10-01
</td>
<td>
39.768659
</td>
<td>
-45.646232
</td>
<td>
61.909513
</td>
<td>
0.661689
</td>
<td>
42.9777
</td>
</tr>
<tr>
<td>
2007-01-01
</td>
<td>
51.174545
</td>
<td>
-45.123562
</td>
<td>
61.858836
</td>
<td>
0.813571
</td>
<td>
48.9015
</td>
</tr>
<tr>
<td>
2007-04-01
</td>
<td>
30.814509
</td>
<td>
-46.410933
</td>
<td>
63.137686
</td>
<td>
0.490286
</td>
<td>
31.1802
</td>
</tr>
<tr>
<td>
2007-07-01
</td>
<td>
39.009207
</td>
<td>
-46.389041
</td>
<td>
63.329916
</td>
<td>
0.608210
</td>
<td>
37.7179
</td>
</tr>
<tr>
<td>
2007-10-01
</td>
<td>
42.486041
</td>
<td>
-46.173405
</td>
<td>
63.146302
</td>
<td>
0.660426
</td>
<td>
40.4202
</td>
</tr>
<tr>
<td>
2008-01-01
</td>
<td>
52.174350
</td>
<td>
-46.762004
</td>
<td>
63.704315
</td>
<td>
0.813364
</td>
<td>
51.2069
</td>
</tr>
<tr>
<td>
2008-04-01
</td>
<td>
31.677371
</td>
<td>
-47.838278
</td>
<td>
64.873425
</td>
<td>
0.489542
</td>
<td>
31.8872
</td>
</tr>
<tr>
<td>
2008-07-01
</td>
<td>
40.035793
</td>
<td>
-49.241989
</td>
<td>
66.470507
</td>
<td>
0.607660
</td>
<td>
40.9783
</td>
</tr>
<tr>
<td>
2008-10-01
</td>
<td>
44.515956
</td>
<td>
-49.577850
</td>
<td>
67.068109
</td>
<td>
0.659565
</td>
<td>
43.7725
</td>
</tr>
<tr>
<td>
2009-01-01
</td>
<td>
55.343501
</td>
<td>
-50.604967
</td>
<td>
68.192465
</td>
<td>
0.812746
</td>
<td>
55.5586
</td>
</tr>
<tr>
<td>
2009-04-01
</td>
<td>
33.773172
</td>
<td>
-51.518074
</td>
<td>
69.287512
</td>
<td>
0.487867
</td>
<td>
33.8509
</td>
</tr>
<tr>
<td>
2009-07-01
</td>
<td>
42.644271
</td>
<td>
-52.028198
</td>
<td>
69.973592
</td>
<td>
0.606360
</td>
<td>
42.0764
</td>
</tr>
<tr>
<td>
2009-10-01
</td>
<td>
46.778450
</td>
<td>
-52.313589
</td>
<td>
70.368612
</td>
<td>
0.658677
</td>
<td>
45.6423
</td>
</tr>
<tr>
<td>
2010-01-01
</td>
<td>
58.009276
</td>
<td>
-54.096698
</td>
<td>
72.214632
</td>
<td>
0.812268
</td>
<td>
59.7668
</td>
</tr>
<tr>
<td>
2010-04-01
</td>
<td>
35.648429
</td>
<td>
-54.502798
</td>
<td>
72.912723
</td>
<td>
0.486508
</td>
<td>
35.1919
</td>
</tr>
<tr>
<td>
2010-07-01
</td>
<td>
44.784383
</td>
<td>
-55.166772
</td>
<td>
73.686275
</td>
<td>
0.605385
</td>
<td>
44.3197
</td>
</tr>
<tr>
<td>
2010-10-01
</td>
<td>
49.174485
</td>
<td>
-55.392542
</td>
<td>
74.032938
</td>
<td>
0.657808
</td>
<td>
47.9137
</td>
</tr>
<tr>
<td>
2011-01-01
</td>
<td>
60.967615
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2011-04-01
</td>
<td>
36.993898
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2011-07-01
</td>
<td>
46.712479
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2011-10-01
</td>
<td>
51.482819
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2012-01-01
</td>
<td>
64.456507
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2012-04-01
</td>
<td>
39.017313
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2012-07-01
</td>
<td>
49.291842
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<td>
2012-10-01
</td>
<td>
54.320157
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Finally lets look at the levels, slopes/trends and seasonal components of the models.</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb704-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-1" tabindex="-1"></a>states1 <span class="op">=</span> pd.DataFrame(np.c_[fit1.level, fit1.slope, fit1.season], columns<span class="op">=</span>[<span class="st">'level'</span>,<span class="st">'slope'</span>,<span class="st">'seasonal'</span>], index<span class="op">=</span>aust.index)</span>
<span id="cb704-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-2" tabindex="-1"></a>states2 <span class="op">=</span> pd.DataFrame(np.c_[fit2.level, fit2.slope, fit2.season], columns<span class="op">=</span>[<span class="st">'level'</span>,<span class="st">'slope'</span>,<span class="st">'seasonal'</span>], index<span class="op">=</span>aust.index)</span>
<span id="cb704-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-3" tabindex="-1"></a>fig, [[ax1, ax4],[ax2, ax5], [ax3, ax6]] <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb704-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-4" tabindex="-1"></a>ax1.plot(states1[[<span class="st">'level'</span>]],label<span class="op">=</span><span class="st">'level'</span>)</span>
<span id="cb704-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-5" tabindex="-1"></a>ax1.legend()</span>
<span id="cb704-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-6" tabindex="-1"></a>ax2.plot(states1[[<span class="st">'slope'</span>]],label<span class="op">=</span><span class="st">'slope'</span>)</span>
<span id="cb704-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-7" tabindex="-1"></a>ax2.legend()</span>
<span id="cb704-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-8" tabindex="-1"></a>ax3.plot(states1[[<span class="st">'seasonal'</span>]],label<span class="op">=</span><span class="st">'seasonal'</span>)</span>
<span id="cb704-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-9" tabindex="-1"></a>ax3.legend()</span>
<span id="cb704-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-10" tabindex="-1"></a>ax4.plot(states2[[<span class="st">'level'</span>]],label<span class="op">=</span><span class="st">'level'</span>)</span>
<span id="cb704-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-11" tabindex="-1"></a>ax4.legend()</span>
<span id="cb704-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-12" tabindex="-1"></a>ax5.plot(states2[[<span class="st">'slope'</span>]],label<span class="op">=</span><span class="st">'slope'</span>)</span>
<span id="cb704-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-13" tabindex="-1"></a>ax5.legend()</span>
<span id="cb704-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-14" tabindex="-1"></a>ax6.plot(states2[[<span class="st">'seasonal'</span>]],label<span class="op">=</span><span class="st">'seasonal'</span>)</span>
<span id="cb704-15"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-15" tabindex="-1"></a>ax6.legend()</span>
<span id="cb704-16"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb704-16" tabindex="-1"></a>plt.show()</span></code></pre></div>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x168dbceab08&gt;]

&lt;matplotlib.legend.Legend at 0x168db928648&gt;

[&lt;matplotlib.lines.Line2D at 0x168dcf41bc8&gt;]

&lt;matplotlib.legend.Legend at 0x168db9ab9c8&gt;

[&lt;matplotlib.lines.Line2D at 0x168dc101cc8&gt;]

&lt;matplotlib.legend.Legend at 0x168dba4f3c8&gt;

[&lt;matplotlib.lines.Line2D at 0x168dcf46c08&gt;]

&lt;matplotlib.legend.Legend at 0x168dc0f6fc8&gt;

[&lt;matplotlib.lines.Line2D at 0x168dcf6cdc8&gt;]

&lt;matplotlib.legend.Legend at 0x168dc12e708&gt;

[&lt;matplotlib.lines.Line2D at 0x168db9ef548&gt;]

&lt;matplotlib.legend.Legend at 0x168db9c3208&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_160_12.png"></div>
</div>
</div>
<div id="examples参考" class="section level3" number="10.2.8">
<h3>
<span class="header-section-number">10.2.8</span> examples参考<a class="anchor" aria-label="anchor" href="#examples%E5%8F%82%E8%80%83"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://www.statsmodels.org/v0.10.1/examples/notebooks/generated/tsa_arma_0.html">ARMA模型，讲了平稳性检验，随机性检验，相关图绘制，模型定阶和构建，假设的检验，预测</a></p>
<p><a href="https://www.statsmodels.org/v0.10.1/examples/notebooks/generated/statespace_sarimax_stata.html">ARIMA模型,讲了只有趋势项的情形，以及疏系数构建，以及ARIMA加法和乘法模型</a></p>
<p><a href="https://www.statsmodels.org/v0.10.1/examples/notebooks/generated/exponential_smoothing.html">指数平滑的例子,包括简单指数平滑，holt两参数平滑（无季节效应），holt三参数季节加法和乘法模型</a></p>
<p>ARIMA Example 4: ARMAX (Friedman)</p>
<p>This model demonstrates the use of explanatory variables (the X part of ARMAX). When exogenous regressors are included, the SARIMAX module uses the concept of “regression with SARIMA errors” (see <a href="http://robjhyndman.com/hyndsight/arimax/" class="uri">http://robjhyndman.com/hyndsight/arimax/</a> for details of regression with ARIMA errors versus alternative specifications), so that the model is specified as:</p>
<p><span class="math display">\[y_t = \beta_t x_t + u_t \\
        \phi_p (L) \tilde \phi_P (L^s) \Delta^d \Delta_s^D u_t = A(t) +
            \theta_q (L) \tilde \theta_Q (L^s) \epsilon_t\]</span></p>
<p>Notice that the first equation is just a linear regression, and the second equation just describes the process followed by the error component as SARIMA (as was described in example 3). One reason for this specification is that the estimated parameters have their natural interpretations.</p>
<p>This specification nests many simpler specifications. For example, regression with AR(2) errors is:</p>
<p><span class="math display">\[y_t = \beta_t x_t + u_t \\
(1 - \phi_1 L - \phi_2 L^2) u_t = A(t) + \epsilon_t\]</span></p>
<p>The model considered in this example is regression with ARMA(1,1) errors. The process is then written:</p>
<p><span class="math display">\[\text{consump}_t = \beta_0 + \beta_1 \text{m2}_t + u_t \\
(1 - \phi_1 L) u_t = (1 - \theta_1 L) \epsilon_t\]</span></p>
<p>Notice that β0 is, as described in example 1 above, not the same thing as an intercept specified by trend=‘c’. Whereas in the examples above we estimated the intercept of the model via the trend polynomial, here, we demonstrate how to estimate β0 itself by adding a constant to the exogenous dataset. In the output, the beta0 is called const, whereas above the intercept c was called intercept in the output.</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb706-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-1" tabindex="-1"></a><span class="co"># Dataset</span></span>
<span id="cb706-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-2" tabindex="-1"></a>friedman2 <span class="op">=</span> requests.get(<span class="st">'https://www.stata-press.com/data/r12/friedman2.dta'</span>).content</span>
<span id="cb706-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-3" tabindex="-1"></a>data <span class="op">=</span> pd.read_stata(BytesIO(friedman2))</span>
<span id="cb706-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-4" tabindex="-1"></a>data.index <span class="op">=</span> data.time</span>
<span id="cb706-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-5" tabindex="-1"></a></span>
<span id="cb706-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-6" tabindex="-1"></a><span class="co"># Variables</span></span>
<span id="cb706-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-7" tabindex="-1"></a>endog <span class="op">=</span> data.loc[<span class="st">'1959'</span>:<span class="st">'1981'</span>, <span class="st">'consump'</span>]</span>
<span id="cb706-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-8" tabindex="-1"></a>exog <span class="op">=</span> sm.add_constant(data.loc[<span class="st">'1959'</span>:<span class="st">'1981'</span>, <span class="st">'m2'</span>])</span>
<span id="cb706-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-9" tabindex="-1"></a></span>
<span id="cb706-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-10" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb706-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-11" tabindex="-1"></a>mod <span class="op">=</span> sm.tsa.statespace.SARIMAX(endog, exog, order<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb706-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-12" tabindex="-1"></a>res <span class="op">=</span> mod.fit(disp<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb706-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb706-13" tabindex="-1"></a><span class="bu">print</span>(res.summary())</span></code></pre></div>
<pre><code>                           Statespace Model Results                           
==============================================================================
Dep. Variable:                consump   No. Observations:                   92
Model:               SARIMAX(1, 0, 1)   Log Likelihood                -340.508
Date:                Sat, 10 Apr 2021   AIC                            691.015
Time:                        21:25:14   BIC                            703.624
Sample:                    01-01-1959   HQIC                           696.105
                         - 10-01-1981                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const        -36.0620     56.639     -0.637      0.524    -147.073      74.949
m2             1.1220      0.036     30.826      0.000       1.051       1.193
ar.L1          0.9348      0.041     22.717      0.000       0.854       1.015
ma.L1          0.3091      0.089      3.488      0.000       0.135       0.483
sigma2        93.2558     10.889      8.565      0.000      71.915     114.597
===================================================================================
Ljung-Box (Q):                       38.72   Jarque-Bera (JB):                23.49
Prob(Q):                              0.53   Prob(JB):                         0.00
Heteroskedasticity (H):              22.51   Skew:                             0.17
Prob(H) (two-sided):                  0.00   Kurtosis:                         5.45
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).

ARIMA Postestimation: Example 1 - Dynamic Forecasting
Here we describe some of the post-estimation capabilities of Statsmodels' SARIMAX.

First, using the model from example, we estimate the parameters using data that excludes the last few observations (this is a little artificial as an example, but it allows considering performance of out-of-sample forecasting and facilitates comparison to Stata's documentation).</code></pre>
<div class="sourceCode" id="cb708"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb708-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-1" tabindex="-1"></a><span class="co"># Dataset</span></span>
<span id="cb708-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-2" tabindex="-1"></a>raw <span class="op">=</span> pd.read_stata(BytesIO(friedman2))</span>
<span id="cb708-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-3" tabindex="-1"></a>raw.index <span class="op">=</span> raw.time</span>
<span id="cb708-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-4" tabindex="-1"></a>data <span class="op">=</span> raw.loc[:<span class="st">'1981'</span>]</span>
<span id="cb708-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-5" tabindex="-1"></a></span>
<span id="cb708-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-6" tabindex="-1"></a><span class="co"># Variables</span></span>
<span id="cb708-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-7" tabindex="-1"></a>endog <span class="op">=</span> data.loc[<span class="st">'1959'</span>:, <span class="st">'consump'</span>]</span>
<span id="cb708-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-8" tabindex="-1"></a>exog <span class="op">=</span> sm.add_constant(data.loc[<span class="st">'1959'</span>:, <span class="st">'m2'</span>])</span>
<span id="cb708-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-9" tabindex="-1"></a>nobs <span class="op">=</span> endog.shape[<span class="dv">0</span>]</span>
<span id="cb708-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-10" tabindex="-1"></a></span>
<span id="cb708-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-11" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb708-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-12" tabindex="-1"></a>mod <span class="op">=</span> sm.tsa.statespace.SARIMAX(endog.loc[:<span class="st">'1978-01-01'</span>], exog<span class="op">=</span>exog.loc[:<span class="st">'1978-01-01'</span>], order<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb708-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-13" tabindex="-1"></a>fit_res <span class="op">=</span> mod.fit(disp<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb708-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb708-14" tabindex="-1"></a><span class="bu">print</span>(fit_res.summary())</span></code></pre></div>
<pre><code>                           Statespace Model Results                           
==============================================================================
Dep. Variable:                consump   No. Observations:                   77
Model:               SARIMAX(1, 0, 1)   Log Likelihood                -243.316
Date:                Sat, 10 Apr 2021   AIC                            496.633
Time:                        21:25:18   BIC                            508.352
Sample:                    01-01-1959   HQIC                           501.320
                         - 01-01-1978                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.6780     18.492      0.037      0.971     -35.565      36.921
m2             1.0379      0.021     50.329      0.000       0.997       1.078
ar.L1          0.8775      0.059     14.859      0.000       0.762       0.993
ma.L1          0.2771      0.108      2.572      0.010       0.066       0.488
sigma2        31.6978      4.683      6.769      0.000      22.520      40.876
===================================================================================
Ljung-Box (Q):                       46.78   Jarque-Bera (JB):                 6.05
Prob(Q):                              0.21   Prob(JB):                         0.05
Heteroskedasticity (H):               6.09   Skew:                             0.57
Prob(H) (two-sided):                  0.00   Kurtosis:                         3.76
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).</code></pre>
<p>Next, we want to get results for the full dataset but using the estimated parameters (on a subset of the data).</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb710-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb710-1" tabindex="-1"></a>mod <span class="op">=</span> sm.tsa.statespace.SARIMAX(endog, exog<span class="op">=</span>exog, order<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb710-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb710-2" tabindex="-1"></a>res <span class="op">=</span> mod.<span class="bu">filter</span>(fit_res.params)<span class="co">#直接利用参数生成模型</span></span></code></pre></div>
<p>The predict command is first applied here to get in-sample predictions. We use the full_results=True argument to allow us to calculate confidence intervals (the default output of predict is just the predicted values).</p>
<p>可以使用full_results=True使predict预测返回估计值置信区间</p>
<p>With no other arguments, predict returns the one-step-ahead in-sample predictions for the entire sample.#使用样本的真实值一步一步预测</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb711-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb711-1" tabindex="-1"></a>res.predict()</span>
<span id="cb711-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb711-2" tabindex="-1"></a>res.predict(full_results<span class="op">=</span><span class="va">True</span>)<span class="co">#似乎没有什么不同</span></span></code></pre></div>
<pre><code>1959-01-01     300.780573
1959-04-01     314.699703
1959-07-01     318.333788
1959-10-01     322.140570
1960-01-01     324.148871
                 ...     
1980-10-01    1792.130868
1981-01-01    1866.122212
1981-04-01    1907.567799
1981-07-01    1944.034222
1981-10-01    1999.784229
Freq: QS-OCT, Length: 92, dtype: float64

1959-01-01     300.780573
1959-04-01     314.699703
1959-07-01     318.333788
1959-10-01     322.140570
1960-01-01     324.148871
                 ...     
1980-10-01    1792.130868
1981-01-01    1866.122212
1981-04-01    1907.567799
1981-07-01    1944.034222
1981-10-01    1999.784229
Freq: QS-OCT, Length: 92, dtype: float64</code></pre>
<div class="sourceCode" id="cb713"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb713-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb713-1" tabindex="-1"></a><span class="co"># In-sample one-step-ahead predictions</span></span>
<span id="cb713-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb713-2" tabindex="-1"></a>predict <span class="op">=</span> res.get_prediction()</span>
<span id="cb713-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb713-3" tabindex="-1"></a>predict_ci <span class="op">=</span> predict.conf_int()</span></code></pre></div>
<p>We can also get dynamic predictions. One-step-ahead prediction uses the true values of the endogenous values at each step to predict the next in-sample value. Dynamic predictions use one-step-ahead prediction up to some point in the dataset (specified by the dynamic argument); after that, the previous predicted endogenous values are used in place of the true endogenous values for each new predicted element.</p>
<p>The dynamic argument is specified to be an offset relative to the start argument. If start is not specified, it is assumed to be 0.</p>
<p>Here we perform dynamic prediction starting in the first quarter of 1978.</p>
<p>我们也可以设置一个动态时间点，在该时间点之前，使用样本观察值预测，之后的预测使用之前样本的预测值预测。</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb714-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb714-1" tabindex="-1"></a><span class="co"># Dynamic predictions</span></span>
<span id="cb714-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb714-2" tabindex="-1"></a>predict_dy <span class="op">=</span> res.get_prediction(dynamic<span class="op">=</span><span class="st">'1978-01-01'</span>)</span>
<span id="cb714-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb714-3" tabindex="-1"></a>predict_dy_ci <span class="op">=</span> predict_dy.conf_int()</span></code></pre></div>
<p>We can graph the one-step-ahead and dynamic predictions (and the corresponding confidence intervals) to see their relative performance. Notice that up to the point where dynamic prediction begins (1978:Q1), the two are the same.</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb715-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-1" tabindex="-1"></a><span class="co"># Graph</span></span>
<span id="cb715-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-2" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">4</span>))</span>
<span id="cb715-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-3" tabindex="-1"></a>npre <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb715-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-4" tabindex="-1"></a>ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">'Personal consumption'</span>, xlabel<span class="op">=</span><span class="st">'Date'</span>, ylabel<span class="op">=</span><span class="st">'Billions of dollars'</span>)</span>
<span id="cb715-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-5" tabindex="-1"></a></span>
<span id="cb715-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-6" tabindex="-1"></a><span class="co"># Plot data points</span></span>
<span id="cb715-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-7" tabindex="-1"></a>ax.plot(data.loc[<span class="st">'1977-07-01'</span>:, <span class="st">'consump'</span>], color<span class="op">=</span><span class="st">'orange'</span>, label<span class="op">=</span><span class="st">'Observed'</span>)</span>
<span id="cb715-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-8" tabindex="-1"></a></span>
<span id="cb715-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-9" tabindex="-1"></a><span class="co"># Plot predictions</span></span>
<span id="cb715-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-10" tabindex="-1"></a>ax.plot(predict.predicted_mean.loc[<span class="st">'1977-07-01'</span>:], ls<span class="op">=</span><span class="st">'--'</span>,color<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'One-step-ahead forecast'</span>)</span>
<span id="cb715-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-11" tabindex="-1"></a>ci <span class="op">=</span> predict_ci.loc[<span class="st">'1977-07-01'</span>:]</span>
<span id="cb715-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-12" tabindex="-1"></a>ax.fill_between(ci.index, ci.iloc[:,<span class="dv">0</span>], ci.iloc[:,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb715-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-13" tabindex="-1"></a>ax.plot(predict_dy.predicted_mean.loc[<span class="st">'1977-07-01'</span>:], color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="st">'Dynamic forecast (1978)'</span>)</span>
<span id="cb715-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-14" tabindex="-1"></a>ci <span class="op">=</span> predict_dy_ci.loc[<span class="st">'1977-07-01'</span>:]</span>
<span id="cb715-15"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-15" tabindex="-1"></a>ax.fill_between(ci.index, ci.iloc[:,<span class="dv">0</span>], ci.iloc[:,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb715-16"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-16" tabindex="-1"></a>legend <span class="op">=</span> ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span>
<span id="cb715-17"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb715-17" tabindex="-1"></a>plt.show()</span></code></pre></div>
<pre><code>[Text(0, 0.5, 'Billions of dollars'),
 Text(0.5, 0, 'Date'),
 Text(0.5, 1.0, 'Personal consumption')]

[&lt;matplotlib.lines.Line2D at 0x168e340c548&gt;]

[&lt;matplotlib.lines.Line2D at 0x168e143dac8&gt;]

&lt;matplotlib.collections.PolyCollection at 0x168de9f5988&gt;

[&lt;matplotlib.lines.Line2D at 0x168de9f5b48&gt;]

&lt;matplotlib.collections.PolyCollection at 0x168dbd47848&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_174_6.png"></div>
<p>Finally, graph the prediction error. It is obvious that, as one would suspect, one-step-ahead prediction is considerably better.</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb717-1"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-1" tabindex="-1"></a><span class="co"># Prediction error</span></span>
<span id="cb717-2"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-2" tabindex="-1"></a></span>
<span id="cb717-3"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-3" tabindex="-1"></a><span class="co"># Graph</span></span>
<span id="cb717-4"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-4" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">4</span>))</span>
<span id="cb717-5"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-5" tabindex="-1"></a>npre <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb717-6"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-6" tabindex="-1"></a>ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">'Forecast error'</span>, xlabel<span class="op">=</span><span class="st">'Date'</span>, ylabel<span class="op">=</span><span class="st">'Forecast - Actual'</span>)</span>
<span id="cb717-7"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-7" tabindex="-1"></a></span>
<span id="cb717-8"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-8" tabindex="-1"></a><span class="co"># In-sample one-step-ahead predictions and 95% confidence intervals</span></span>
<span id="cb717-9"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-9" tabindex="-1"></a>predict_error <span class="op">=</span> predict.predicted_mean <span class="op">-</span> endog</span>
<span id="cb717-10"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-10" tabindex="-1"></a>ax.plot(predict_error.loc[<span class="st">'1977-10-01'</span>:], label<span class="op">=</span><span class="st">'One-step-ahead forecast'</span>)</span>
<span id="cb717-11"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-11" tabindex="-1"></a>ci <span class="op">=</span> predict_ci.loc[<span class="st">'1977-10-01'</span>:].copy()</span>
<span id="cb717-12"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-12" tabindex="-1"></a>ci.iloc[:,<span class="dv">0</span>] <span class="op">-=</span> endog.loc[<span class="st">'1977-10-01'</span>:]</span>
<span id="cb717-13"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-13" tabindex="-1"></a>ci.iloc[:,<span class="dv">1</span>] <span class="op">-=</span> endog.loc[<span class="st">'1977-10-01'</span>:]</span>
<span id="cb717-14"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-14" tabindex="-1"></a>ax.fill_between(ci.index, ci.iloc[:,<span class="dv">0</span>], ci.iloc[:,<span class="dv">1</span>], alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb717-15"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-15" tabindex="-1"></a></span>
<span id="cb717-16"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-16" tabindex="-1"></a><span class="co"># Dynamic predictions and 95% confidence intervals</span></span>
<span id="cb717-17"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-17" tabindex="-1"></a>predict_dy_error <span class="op">=</span> predict_dy.predicted_mean <span class="op">-</span> endog</span>
<span id="cb717-18"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-18" tabindex="-1"></a>ax.plot(predict_dy_error.loc[<span class="st">'1977-10-01'</span>:], color<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Dynamic forecast (1978)'</span>)</span>
<span id="cb717-19"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-19" tabindex="-1"></a>ci <span class="op">=</span> predict_dy_ci.loc[<span class="st">'1977-10-01'</span>:].copy()</span>
<span id="cb717-20"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-20" tabindex="-1"></a>ci.iloc[:,<span class="dv">0</span>] <span class="op">-=</span> endog.loc[<span class="st">'1977-10-01'</span>:]<span class="co">#这是在减去常数，算error的置信区间</span></span>
<span id="cb717-21"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-21" tabindex="-1"></a>ci.iloc[:,<span class="dv">1</span>] <span class="op">-=</span> endog.loc[<span class="st">'1977-10-01'</span>:]</span>
<span id="cb717-22"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-22" tabindex="-1"></a>ax.fill_between(ci.index, ci.iloc[:,<span class="dv">0</span>], ci.iloc[:,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb717-23"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-23" tabindex="-1"></a></span>
<span id="cb717-24"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-24" tabindex="-1"></a>legend <span class="op">=</span> ax.legend(loc<span class="op">=</span><span class="st">'lower left'</span>)<span class="op">;</span></span>
<span id="cb717-25"><a href="%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B.html#cb717-25" tabindex="-1"></a>legend.get_frame().set_facecolor(<span class="st">'w'</span>)</span></code></pre></div>
<pre><code>[Text(0, 0.5, 'Forecast - Actual'),
 Text(0.5, 0, 'Date'),
 Text(0.5, 1.0, 'Forecast error')]

[&lt;matplotlib.lines.Line2D at 0x168e3417a48&gt;]

&lt;matplotlib.collections.PolyCollection at 0x168dbdba808&gt;

[&lt;matplotlib.lines.Line2D at 0x168dbdba4c8&gt;]

&lt;matplotlib.collections.PolyCollection at 0x168dbdc4888&gt;</code></pre>
<div class="inline-figure"><img src="static/image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/output_176_5.png"></div>

</div>
</div>
</div>
<style>

/* Style the tab */
/* .tab {
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
} */
.tab {
    overflow: hidden;
    display: flex;
    align-items: flex-start;
    flex-direction: row;
    flex-wrap: wrap;
    padding: 0;
    /* margin-bottom: 8px; */
    /* margin-left: -8px; */
    /* margin-right: 0px; */
    /* border-bottom:1px solid #e0e0e0; */
    height: 32px;
    /*flex-basis: 100px;*/
    /* background-color: aliceblue; */
}

/* Style the buttons inside the tab */
/* .tab button {
    background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
    font-size: 17px;
} */

.tab button {
    background-color: inherit;
    margin:0;
    text-align: center;
    font-weight: 500;
    min-width: 100px;
    /*width:fit-content;*/
    height: 100%;
    /* padding:5px,5px; */
    border: none;
    font-size: 1rem;
    font-weight:400;
    line-height: 32px;
    letter-spacing: .5px;
}

/* Change background color of buttons on hover */
/* .tab button:hover {
    background-color: #ddd;
} */
.tab button:hover {
    background-color: aliceblue;
}

/* Create an active/current tablink class */
/* .tab button.active {
    background-color: #ccc;
} */
.tab button.active {
    border-bottom: 2px solid rgb(33,150,243);
    background-color: aliceblue;
    padding-left:0px;
    padding-right:0px;
}

/* Style the tab content */
/* .tabcontent {
    display: none;
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-top: none;
} */
.tabcontent {
    display: none;
    /* border: 1px solid aliceblue; */
    /*background-color: aliceblue;*/
    /* margin-left: -8px; */
    /* margin-top: -8px; */
 }

.tabheader{
    display: none;
}

pre {
  word-break: normal;
  word-wrap: normal;
  margin-left: 0px;
}
</style>
<script>
    var tab = document.getElementsByClassName("tabset");
    for(i=0;i<tab.length;i++){
    var hL = tab[i].children[0].nodeName[1];
    var tabContents = tab[i].getElementsByTagName("h"+String(Number(hL)+1));
    var tabCon = document.createElement("div");
    tabCon.className = "tab";
    tab[i].insertBefore(tabCon,tabContents[0].parentNode);
     for(j=0;j<tabContents.length;j++){
         var tabConDiv = tabContents[j].parentNode;
         var tabId = tabConDiv.getAttribute("id");
         var tabNumber = tabConDiv.getAttribute("number").replaceAll('.','-');
         var newID = tabNumber + '-' + tabId;
         var button = document.createElement("button");
         button.className = "tablinks";
         button.setAttribute("onclick","openTab(event,'"+newID+"')");
         button.innerText = tabId.split('-')[0];
        //  button.innerText = tabContents[j].innerText;
         tabCon.appendChild(button);
         tabConDiv.setAttribute("id",newID);
         tabConDiv.className = "tabcontent";
         tabContents[j].innerHTML = "";
         tabContents[j].className = "tabheader";
     }
     tabContents[0].parentNode.style.display = "block";
     tabCon.children[0].className += " active"
    }

function openTab(evt,tabName){
    var i, tabcontent, tablinks;
//     tabcontent = document.getElementsByClassName("tabcontent");
//     for (i = 0; i < tabcontent.length; i++) {
//         tabcontent[i].style.display = "none";
//   }
//     tablinks = document.getElementsByClassName("tablinks");
//     for (i = 0; i < tablinks.length; i++) {
//     tablinks[i].className = tablinks[i].className.replace(" active", "");
//   }
//   document.getElementById(tabName).style.display = "block";
//   evt.currentTarget.className += " active";
    var container = evt.currentTarget.parentNode;
    tabcontent = container.parentNode.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
  }
    tablinks = container.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script><div class="giscus">
<script src="https://giscus.app/client.js" data-repo="wangchenglong99/wangchenglong99.github.io" data-repo-id="R_kgDOI6UvHg" data-category="Announcements" data-category-id="DIC_kwDOI6UvHs4CUJAN" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light_high_contrast" data-lang="zh-CN" crossorigin="anonymous" async>
</script><div></div>
  

  

</div>
<div class="chapter-nav">
<div class="prev"><a href="introduction-3.html">introduction</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B"><span class="header-section-number">10</span> 时间序列模型</a></li>
<li>
<a class="nav-link" href="#%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86"><span class="header-section-number">10.1</span> 理论知识</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%B7%AE%E5%88%86"><span class="header-section-number">10.1.1</span> 差分</a></li>
<li><a class="nav-link" href="#%E5%BB%B6%E8%BF%9F%E7%AE%97%E5%AD%90"><span class="header-section-number">10.1.2</span> 延迟算子</a></li>
<li><a class="nav-link" href="#%E5%B9%B3%E7%A8%B3%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><span class="header-section-number">10.1.3</span> 平稳时间序列</a></li>
<li><a class="nav-link" href="#ar%E6%A8%A1%E5%9E%8B"><span class="header-section-number">10.1.4</span> AR模型</a></li>
<li><a class="nav-link" href="#ma%E6%A8%A1%E5%9E%8B"><span class="header-section-number">10.1.5</span> MA模型</a></li>
<li><a class="nav-link" href="#arma%E6%A8%A1%E5%9E%8B"><span class="header-section-number">10.1.6</span> ARMA模型</a></li>
<li><a class="nav-link" href="#crammer%E5%88%86%E8%A7%A3%E5%AE%9A%E7%90%86"><span class="header-section-number">10.1.7</span> Crammer分解定理</a></li>
<li><a class="nav-link" href="#arima%E6%A8%A1%E5%9E%8B"><span class="header-section-number">10.1.8</span> ARIMA模型</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E6%93%8D%E4%BD%9C"><span class="header-section-number">10.2</span> 实践操作</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="header-section-number">10.2.1</span> 绘制时序图</a></li>
<li><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E8%AF%86%E5%88%AB"><span class="header-section-number">10.2.2</span> 模型识别</a></li>
<li><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA"><span class="header-section-number">10.2.3</span> 模型构建</a></li>
<li><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93"><span class="header-section-number">10.2.4</span> 模型总结</a></li>
<li><a class="nav-link" href="#%E9%9D%9E%E5%B9%B3%E7%A8%B3%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><span class="header-section-number">10.2.5</span> 非平稳时间序列</a></li>
<li><a class="nav-link" href="#arima-%E9%9D%9E%E5%B9%B3%E7%A8%B3%E6%97%A0%E5%AD%A3%E8%8A%82%E6%95%88%E5%BA%94%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><span class="header-section-number">10.2.6</span> ARIMA 非平稳无季节效应时间序列</a></li>
<li><a class="nav-link" href="#%E6%9C%89%E5%AD%A3%E8%8A%82%E6%95%88%E5%BA%94%E7%9A%84%E9%9D%9E%E5%B9%B3%E7%A8%B3%E6%A8%A1%E5%9E%8B"><span class="header-section-number">10.2.7</span> 有季节效应的非平稳模型</a></li>
<li><a class="nav-link" href="#examples%E5%8F%82%E8%80%83"><span class="header-section-number">10.2.8</span> examples参考</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/wangchenglong99/wangchenglong99.github.io/blob/main/%E6%97%B6%E5%BA%8F%E6%A8%A1%E5%9E%8B.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/wangchenglong99/wangchenglong99.github.io/edit/main/%E6%97%B6%E5%BA%8F%E6%A8%A1%E5%9E%8B.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>wcl</strong>" was written by wcl. It was last built on 2024-04-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</div>
</body>
</html>
